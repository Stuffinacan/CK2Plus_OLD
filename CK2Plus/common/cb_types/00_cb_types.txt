# 0
claim = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_CLAIM
	sprite = 1
	truce_days = 3650
	hostile_against_others = yes
	can_ask_to_join_war = no

	allowed_to_target_tributaries = no

	press_claim = yes

	infamy_modifier = 0.85

	sort_priority = 1000

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use_title = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		# Attacker
		ROOT = {
			attacking_religious_head_trigger = no
			# Adventurers
			trigger_if = {
				limit = { has_character_flag = claimant_adventurer }
				always = yes
			}
			trigger_else = {
				# AI Restrictions
				trigger_if = {
					limit = { ai = yes }
					# AI non-adventurers will only press claims to different religion groups if the title is duke+
					OR = {
						religion_group = FROM
						PREV = { higher_tier_than = COUNT }
					}
					# Disallow females from pressing claims on agnatic nomadic titles
					OR = {
						FROM = { is_nomadic = no }
						ROOT = { is_female = no }
						PREV = { NOT = { has_law = agnatic_succession } }
					}
					#only cynics can press claims on same-faith holy orders unless one is a player
					FROM = {
						OR = {
							ai = no
							NOT = { religion = ROOT }
							higher_tier_than = duke
							holy_order = no
							ROOT = { trait = cynical }
						}
					}
					#AI will not fight for baronies held by a patriarch
					can_attack_patriarch_trigger = yes
				}
				# Rulers can press their claims
				trigger_if = {
					limit = { is_ruler = no }
					# gender requirements
					trigger_if = {
						limit = { is_female = yes }
						NOR = {
							AND = {
								religion_group = muslim
								NOT = { religion = druze }
							}
							has_religion_feature = religion_patriarchal
						}
					}
					trigger_else = {
						NOT = { has_religion_feature = religion_matriarchal }
					}
				}
				# But not if they're too special
				trigger_else = {
					primary_title = {
						OR = {
							is_primary_type_title = no # Static Mercs, the Pope, Holy Orders, etc
							NOT = { lower_tier_than = PREVPREV }
						}
					}
				}
			}
			# What to do if the claim isn't strong
			trigger_if = {
				limit = {
					NOT = { has_strong_claim = PREV }
				}
				has_weak_claim = PREV

				PREV = { # claimed title
					trigger_if = {
						limit = {
							NOR = {
								is_pretender = yes # Checks vs ROOT character
								is_contested = yes # Already being contested in some war
								holder_scope = { has_regent = yes }
							}
						}
						ROOT = { # attacking claimant
							trigger_if = {
								limit = { is_female = yes }
								OR = {
									has_law = status_of_women_4
									has_religion_feature = religion_matriarchal
									has_religion_feature = religion_equal
									has_religion_feature = religion_feature_bon
								}
							}
						}
						holder_scope = { # title holder
							is_female = yes
							NOR = {
								has_religion_feature = religion_matriarchal
								has_religion_feature = religion_equal
								has_religion_feature = religion_feature_bon
								has_law = status_of_women_4
								has_game_rule = {
									name = gender
									value = all
								}
							}
						}
					}
				}
			}
			# Strong claims get a pass
			trigger_else = {
				has_strong_claim = PREV
			}
		}

		holder_scope = {
			OR = {
				character = FROM
				is_liege_or_above = FROM
			}
		}
	}

	is_valid_title = {
		# Attacker
		ROOT = { has_claim = PREV }

		holder_scope = {
			OR = {
				character = FROM
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		fire_haruspicy_event_effect = yes
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their Claim war on the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"

		#decentralize target realm
		title_reduce_CA_effect = yes
		title_reduce_TO_effect = yes
		empty_province_effect = yes
		pf_liege_change_under_title_begin_effect = yes
		pf_liege_change_under_title_end_effect = yes

		usurp_title_plus_barony_if_unlanded = { target = attacker type = claim }

		attacker = {
			show_scope_change = no
			participation_scaled_prestige = 100
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		any_attacker = {
			limit = { NOT = { character = attacker } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		defender = {
			show_scope_change = no
			prestige = -100
		}

		hidden_tooltip = {
			attacker = {
				clr_character_flag = claimant_adventurer
				if = {
					limit = {
						has_nickname = no
						lower_tier_than = PREV
					}
					random = {
						chance = 50
						give_nickname = nick_the_usurper
					}
				}
			}

			defender = {
				landless_pope_effect = yes
			}

			if = {
				limit = {
					higher_tier_than = BARON
					NOT = { culture = ROOT }
				}
				conquest_culture = attacker
			}

			check_war_effect = yes
		}
	}

	on_fail_title = {
		attacker = {
			show_scope_change = no
			prestige = -100
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = claimant_adventurer
			}
		}

		defender = {
			show_scope_change = no
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand = {
		attacker = {
			show_scope_change = no
			prestige = -150
			transfer_scaled_wealth = {
				to = defender
				value = 4.0
			}
			if = {
				limit = { has_character_flag = claimant_adventurer }
				imprison = defender
			}
		}

		defender = {
			show_scope_change = no
			participation_scaled_prestige = 150
		}
		any_defender = {
			limit = { NOT = { character = defender } }
			hidden_tooltip = { participation_scaled_prestige = 150 }
		}

		# China stuff
		hidden_effect = {
			# Attacker
			attacker = {
				if = {
					limit = {
						has_landed_title = e_china_west_governor
					}
					log = "China War Logging: China lost a claim war against [From.GetBestName]"

					if = { #Makes China have a chance of leaving Expanionist policy...
						limit = {
							offmap_china = {
								has_policy = china_expansionist
							}
						}
						random = {
							chance = 50
							offmap_china = {
								set_policy = china_open
								log = "-------------------------------------"
								log = "China Policy Logging:"
								log = "China's new Policy is now OPEN"
								log = "-------------------------------------"
							}
						}
					}
				}
			}
		}
	}

	on_reverse_demand_title = {
		attacker = {
			show_scope_change = no
			remove_claim = PREV
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = claimant_adventurer
			}
		}
	}

	on_attacker_leader_death = {
		if = {
			limit = {
				attacker = { has_character_flag = EoD_prophet_attacker }
			}
			defender = { narrative_event = { id = RIP.15116 } }
		}

		attacker = {
			if = {
				limit = {
					OR = {
						has_character_flag = claimant_adventurer
						has_character_flag = EoD_prophet_attacker
					}
				}
				hidden_tooltip = {
					disband_event_forces = yes
					clr_character_flag = claimant_adventurer
					clr_character_flag = EoD_prophet_attacker
				}
				PREV = { end_war = invalid }
			}
		}
	}

	on_invalidation = {
		log = "CB(claim): INVALIDATED: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		sufficient_treasury_for_war = yes

		modifier = {
			factor = 1.2
			ROOT = {
				realm_levy_diff = { who = FROM value = 5000 }
			}
		}
		modifier = {
			factor = 0
			is_contested = yes
		}
		modifier = { # The AI will never breach a tributary's trust
			factor = 0
			ai_attack_tributary_trigger = yes
		}
		modifier = {
			factor = 0
			ROOT = {
				controls_religion = yes
				NOT = { realm_size = 1 }
			}
		}
	}
}

# 1
other_claim = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_OTHER_CLAIM
	sprite = 2
	truce_days = 3650
	hostile_against_others = yes
	can_ask_to_join_war = yes

	allowed_to_target_tributaries = yes

	infamy_modifier = 0.5

	sort_priority = 900

	press_claim = yes

	can_use = {
		cb_can_use_preamble = yes
		cb_other_no_nap_with_suzerain_trigger = yes
		attacking_religious_head_trigger = no
		ROOT = { mercenary = no }
	}

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use_title = {
		#the AI won't press claims on behalf of characters of a different religion group unless the title's duke+
		OR = {
			FROMFROM = { ai = no }
			higher_tier_than = count
			ROOT = { religion_group = FROMFROM }
		}
		#you can't press claims against someone you installed into that title
		holder_scope = {
			NOT = {
				has_opinion_modifier = {
					who = FROMFROM
					modifier = pressed_my_claim
				}
			}
		}
		ROOT = {
			OR = {
				is_ruler = no
				primary_title = {
					OR = {
						is_primary_type_title = no # Static Mercs, the Pope, Holy Orders, etc
						higher_tier_than = PREVPREV
						tier = PREVPREV
					}
				}
			}
		}
		#the AI will only press a non-muslim woman's claim on an agnatic title if she already has a son or is formidable
		OR = {
			FROMFROM = { ai = no }
			FROMFROM = { is_feminist_trigger = yes }
			NOT = { has_law = agnatic_succession }
			ROOT = { is_female = no }
			ROOT = { has_religion_feature = religion_matriarchal }
			ROOT = {
				is_female = yes
				OR = {
					NOT = { religion_group = muslim }
					religion = druze
				}
				NOT = { age = 40 }
				OR = {
					any_child = {
						is_female = no
						OR = {
							dynasty = PREV
							dynasty = FROMFROM
						}
						NOT = { trait = bastard }
					}
					calc_true_if = {
						amount = 2
						diplomacy = 12
						diplomacy = 20
						intrigue = 12
						prestige = 1000
						is_ruler = yes
					}
				}
			}
		}

		#disallow ai females from pressing claims on agnatic nomadic titles
		OR = {
			FROMFROM = { ai = no }
			FROM = { is_nomadic = no }
			ROOT = { is_female = no }
			NOT = { has_law = agnatic_succession }
		}

		#cannot enforce claims for non-ruler muslim women, period
		ROOT = {
			OR = {
				is_female = no
				is_ruler = yes
				NOT = { religion_group = muslim }
				religion = druze
				has_religion_feature = religion_matriarchal
			}
		}

		#presser is DJL of target title, or presser is a liege of claimant and is either a player or has a higher tier title than target, or is a friend/spouse
		OR = {
			de_jure_liege_or_above = FROMFROM
			ROOT = {
				any_liege = {
					character = FROMFROM
					ai = no
				}
			}
			ROOT = {
				any_liege = {
					character = FROMFROM
					primary_title = { higher_tier_than = PREVPREVPREV }
				}
			}
			ROOT = {
				any_liege = {
					character = FROMFROM
					OR = {
						is_friend = PREV
						is_married = PREV
					}
				}
			}
		}
		#presser is DJL of target title, is player liege of claimant, or the claimant is an antipope, already has a higher tier title, or is a dynasty member/friend/lover/spouse
		OR = {
			de_jure_liege_or_above = FROMFROM
			AND = {
				controls_religion = yes
				holder_scope = {
					OR = {
						religion = catholic
						religion = fraticelli
					}
				}
			}
			ROOT = {
				any_liege = {
					character = FROMFROM
					ai = no
				}
			}
			ROOT = { primary_title = { higher_tier_than = PREVPREV } }
			ROOT = {
				OR = {
					any_dynasty_member = { character = FROMFROM }
					any_lover = { character = FROMFROM }
					any_spouse = { character = FROMFROM }
					any_friend = { character = FROMFROM }
				}
			}
		}
		#the target either has the title or is liege of the title's holder
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		#can not press a claim for someone who's already attacking the target for the title
		NOT = {
			any_war = { # when used in title scope, checks all wars for that title
				attacker = {
					character = ROOT
				}
			}
		}
		#can only press weak claims for a pretender, a contested title, or if the target is uncrowned/has a regent/is female
		is_usable_claim_trigger = yes

		#only cynics can press claims against holy orders of their religion unless they have other kingdoms.
		OR = {
			FROM = { NOT = { religion = FROMFROM } }
			FROMFROM = { trait = cynical }
			FROMFROM = { ai = no }
			FROM = { ai = no }
			FROM = { higher_tier_than = duke }
			FROM = { holy_order = no }
		}
		#AI will not fight for baronies held by a patriarch
		can_attack_patriarch_trigger = yes
		OR = {
			multiplayer = no
			FROMFROM = { ai = yes }
			has_game_rule = {
				name = multiplayer_third_party_claims
				value = on
			}
			AND = {
				has_game_rule = {
					name = multiplayer_third_party_claims
					value = limited
				}
				lower_tier_than = KING
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		ROOT = { has_claim = PREV }
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		FROM = {
			attacked_tributary_cb_effect = yes
		}
		ROOT = {
			set_character_flag = claim_being_pressed
		}
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		hidden_tooltip = {
			ROOT = { add_character_modifier = { name = new_land_timer duration = 1 hidden = yes } }
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			ROOT = {
				opinion = {
					modifier = pressed_my_claim
					who = PREV
					multiplier = 2
				}
				hidden_tooltip = {
					clr_character_flag = claim_being_pressed
				}
			}
		}
		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			show_scope_change = no
			prestige = -200
			pf_glory_minus2_effect = yes
		}
	}

	on_fail = {
		ROOT = {
			hidden_tooltip = {
				clr_character_flag = claim_being_pressed
			}
		}
	}

	on_invalidation = {
		ROOT = {
			hidden_tooltip = {
				clr_character_flag = claim_being_pressed
			}
		}
	}

	on_success_title = {
		log = "[FromFrom.GetBestName] (ID: [FromFrom.GetID]) succeeded with their war for [Root.GetBestName]'s (ID: [Root.GetID]) claim on the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		#decentralize target title
		title_reduce_CA_effect = yes
		title_reduce_TO_effect = yes
		pf_liege_change_under_title_begin_effect = yes
		hidden_tooltip = {
			ROOT = {
				if = {
					limit = {
						has_nickname = no
						lower_tier_than = PREV
					}
					random = {
						chance = 50
						give_nickname = nick_the_usurper
					}
				}
			}
			# Anti-Popes take all the gold of the Vatican
			if = {
				limit = {
					OR = {
						title = k_papal_state
						title = d_fraticelli
					}
				}
				FROM = {
					transfer_scaled_wealth = {
						to = ROOT
						value = all
					}
				}
			}
		}
		if = {
			#antipopes
			limit = {
				controls_religion = yes
				holder_scope = {
					OR = {
						religion = catholic
						religion = fraticelli
					}
				}
			}
			holder_scope = {
				abdicate_to = ROOT
			}
			if = {
				limit = {
					FROMFROM = { higher_tier_than = PREV }
				}
				ROOT = { set_defacto_liege = FROMFROM }
			}
		}

		if = {
			limit = {
				OR = {
					controls_religion = no
					NOT = {
						holder_scope = {
							OR = {
								religion = catholic
								religion = fraticelli
							}
						}
					}
				}
			}

			# check if we qualify for staying in the realm & inform player of result with a tooltip
			if = {
				limit = {
					OR = {
						de_jure_liege_or_above = FROMFROM
						ROOT = {
							any_liege = {
								character = FROMFROM
								primary_title = { higher_tier_than = PREVPREVPREV }
							}
						}
					}
					OR = {
						de_jure_liege_or_above = FROMFROM
						ROOT = { primary_title = { higher_tier_than = PREVPREV } }
						ROOT = { primary_title = { tier = PREVPREV } }
						ROOT = {
							any_dynasty_member = {
								character = FROMFROM
							}
						}
					}
				}
				# mark as staying in the realm
				ROOT = { set_character_flag = stay_in_realm }
				custom_tooltip = { text = CUSTOMTOOLTIP1 }
			}
			if = {
				limit = {
					OR = {
						NOT = {
							OR = {
								de_jure_liege_or_above = FROMFROM
								ROOT = {
									any_liege = {
										character = FROMFROM
										primary_title = { higher_tier_than = PREVPREVPREV }
									}
								}
							}
						}
						NOR = {
							de_jure_liege_or_above = FROMFROM
							ROOT = { primary_title = { higher_tier_than = PREVPREV } }
							ROOT = { primary_title = { tier = PREVPREV } }
							ROOT = {
								any_dynasty_member = {
									character = FROMFROM
								}
							}
						}
					}
				}
				custom_tooltip = { text = CUSTOMTOOLTIP2 }
			}

			#determine who is the liege of loser in the war
			if = {
				limit = {
					ROOT = {
						NOT = { has_character_flag = stay_in_realm }
					}
					FROM = { independent = no }
				}
				FROM = {
					liege = { set_character_flag = from_liege }
				}
				set_global_flag = from_has_liege
			}

			empty_province_effect = yes
			usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }

			# try and vassalise
			hidden_tooltip = {
				# claimant stays in realm
				if = {
					limit = {
						ROOT = { has_character_flag = stay_in_realm }
						NOT = {
						 	ROOT = { is_liege_or_above = FROMFROM }
						}
					}
					ROOT = { set_defacto_liege = FROMFROM }
				}
				#claimant leaves realm - if loser was vassal, vassalize to their liege. If loser was independent, claimant goes independent.
				if = {
					limit = {
						has_global_flag = from_has_liege
						ROOT = {
							NOT = { has_character_flag = stay_in_realm }
						}
					}
					any_playable_ruler = {
						limit = { has_character_flag = from_liege }
						ROOT = { set_defacto_liege = PREV }
						clr_character_flag = from_liege
					}
				}
				if = {
					limit = {
						NOT = { has_global_flag = from_has_liege }
						ROOT = {
							NOT = { has_character_flag = stay_in_realm }
						}
					}
					ROOT = { set_defacto_liege = ROOT }
				}
				clr_global_flag = from_has_liege
				ROOT = { clr_character_flag = stay_in_realm }
			}
		}

		pf_liege_change_under_title_end_effect = yes

		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}

		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail_title = {
		ROOT = {
			show_scope_change = no
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			FROM = {
				show_scope_change = no
				prestige = -100
			}
		}

		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		prestige = -200
		transfer_scaled_wealth = {
			to = FROM
			value = 4.0
		}
		pf_glory_minus2_effect = yes
		ROOT = {
			show_scope_change = no
			prestige = -200
			imprison = FROM
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	on_reverse_demand_title = {
		ROOT = { show_scope_change = no remove_claim = PREV }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 10
			controls_religion = yes
		}
		modifier = {
			factor = 0
			is_contested = yes
		}
		modifier = { # The AI will never breach a tributary's trust
			factor = 0
			ai_attack_tributary_trigger = yes
		}
		sufficient_treasury_for_war = yes
	}
}

# 2 Disabled
claim_on_liege = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_CLAIM_LIEGE
	sprite = 3
	truce_days = 3650
	hostile_against_others = yes

	press_claim = yes
	can_call_vassals = no
	#attacker_can_call_allies = no
	major_revolt = yes
	is_permanent = no

	allowed_to_target_tributaries = no

	infamy_modifier = 0.85

	sort_priority = 910

	can_use = {
		always = no
	}

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = {
			ROOT = { has_strong_claim = PREV }
			ROOT = { has_character_flag = faction_claimant_ultimatum_taken } # Faction war. Ignore claim strength.
			AND = {
				ROOT = { has_weak_claim = PREV }
				OR = {
					is_pretender = yes # Checks vs ROOT character
					holder_scope = { has_regent = yes }
					AND = {
						ROOT = { OR = { is_female = no has_law = status_of_women_4 } }
						holder_scope ={ AND = { is_female = yes NOR = { has_law = status_of_women_4 has_game_rule = { name = gender value = all } } } }
					}
					is_contested = yes # Is already being contested in some form of Claim or Succession War
				}
			}
		}
		is_vice_royalty = no
	}

	is_valid = {
		FROM = {
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}

	is_valid_title = {
		NOT = {
			holder_scope = {
				character = ROOT
			}
		}

		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = {
			has_law = succ_feudal_elective
			has_law = succ_hre_elective
			ROOT = { has_claim = PREV }
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}

		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists }

			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}
		if = {
			limit = {
				ROOT = {
					prisoner = yes
					host = { character = FROM  }
				}
			}
			ROOT = { prisoner = no }
		}
	}

	on_success_title = {
		if = {
			limit = {
				is_primary_holder_title = yes
			}
			FROM = { imprison = ROOT }
		}

		usurp_title_plus_barony_if_unlanded_and_vassals_no_adj = { target = ROOT type = claim }

		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}

		if = {
			limit = {
				higher_tier_than = FROM
			}

			FROM = {
				set_defacto_liege = ROOT
			}
		}

		hidden_tooltip = {
			ROOT = {
				if = {
					limit = {
						has_nickname = no
						PREV = { higher_tier_than = count }
					}
					random = {
						chance = 50
						give_nickname = nick_the_usurper
					}
				}
			}
		}

		hidden_tooltip = {
			check_war_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}

		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				disband_event_forces = faction_revolters
			}
		}

		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -150
		}

		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				if = {
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				disband_event_forces = faction_revolters
				prisoner = FROM
			}
		}

		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 3
claim_on_liege_plot = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_PRETENDER
	sprite = 3
	truce_days = 3650
	hostile_against_others = yes

	can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes

	infamy_modifier = 0.85

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use_title = {
		FROM = {
			has_landed_title = PREV
			reverse_has_opinion_modifier = { who = ROOT modifier = revolting_against }
		}
	}

	is_valid_title = {
		FROM = {
			has_landed_title = PREV
			reverse_has_opinion_modifier = { who = ROOT modifier = revolting_against }
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		log = "CB(claim_on_liege_plot): START: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"
		FROM = { pf_log_state_effect = yes }
		ROOT = { pf_log_state_effect = yes }
		#emf_cb_dynlevy_begin_effect = yes
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		# add victory modifier for the 'Win a War' ambition
		any_attacker = { add_character_modifier = { name = victory_timer duration = 1 hidden = yes } }

		ROOT = {
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			prestige = -500
			imprison = ROOT

			# existing vassals may declare independence
			if = {
			 	limit = { independent = yes }
			 	hidden_tooltip = { any_vassal = { character_event = { id = Plus.430 days = 3 } } }
			}
		}
	}

	on_success_title = {
		log = "CB(claim_on_liege_plot): VICTORY: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"

		# Prevent on_new_holder / on_unlanded edge case handlers from tearing-down any civil war state while the CB
		# completes due to, e.g., liege changes or gained titles.
		set_global_flag = pf_teardown_lock

		# the claimant has the wrong government type, take care of that first.
		if = {
			limit = {
				higher_tier_than = ROOT
				holder_scope = {
					OR = {
						is_feudal = yes
						is_tribal = yes
					}
				}
				ROOT = {
					is_ruler = yes
					OR = {
						is_theocracy = yes
						is_republic = yes
					}
				}
			}
			ROOT = { abdicate = yes }
		}
		# usurp primary titles
		if = {
			limit = {
				is_primary_holder_title = yes
			}
			FROM = {
				# check to see if title will be destroyed
				any_demesne_title = {
					limit = { can_destroy_title_trigger = yes }
					custom_tooltip = { text = TITLE_ENDANGERED_NO_NAME }
					set_title_flag = destroy_title
				}
				# reduce CA & TO
				any_demesne_title = {
					title_reduce_CA_effect = yes
					title_reduce_TO_effect = yes
				}
				# usurp all non-primary titles first
				any_demesne_title = {
					limit = {
						is_primary_holder_title_tier = yes
						is_primary_holder_title = no
					}
					usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
				}
				# usurp primary title
				primary_title = {
					usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
					hidden_tooltip = { make_primary_title = yes }
				}
				# ruler stays within the realm
				set_defacto_liege = ROOT
				# destroy primary title if it has been reduced too much
				hidden_tooltip = {
					if = {
						limit = { primary_title = { has_title_flag = destroy_title } }
						character_event = { id = Plus.1620 days = 4 }
					}
				}
			}
			# check to see if the ruler needs to give the claimant a capital
			hidden_tooltip = {
				if = {
					limit = {
						FROM = {
							ROOT = {
								primary_title = {
									NOR = {
										has_law = succ_feudal_elective
										has_law = succ_hre_elective
										has_law = succ_byzantine_elective
									}
									FROM = {
										capital_scope = {
											de_jure_liege_or_above = PREVPREV
										}
									}
								}
							}
							OR = {
								num_of_count_titles = 2
								primary_title = { higher_tier_than = count }
							}
						}
					}
					FROM = {
						capital_scope = {
							county = {
								usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
							}
						}
					}
				}
			}
			# set proper liege statuses
			hidden_tooltip = {
				FROM = {
					set_defacto_liege = ROOT
					any_vassal = {
						limit = { NOT = { primary_title = { de_jure_liege_or_above = PREVPREV } } }
						set_defacto_liege = ROOT
					}
				}
			}
		}
		# usurp non-primary titles
		if = {
			limit = {
				is_primary_holder_title = no
				holder = FROM
			}
			title_reduce_CA_effect = yes
			title_reduce_TO_effect = yes
			usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
		}

		clr_global_flag = pf_teardown_lock

		# figure out who are the supporters, losers, and neutrals
		hidden_tooltip = {
			ROOT = {
				# clear previous civil war opinions
				pf_civil_war_clear_old_opinions_effect = yes

				# mark rebels as supporters
				FROM = {
					any_opinion_modifier_target = {
						limit = {
							pf_part_of_this_revolt_trigger = yes
							NOT = { character = PREVPREV }
						}
						reverse_opinion = {
							who = PREVPREV
							modifier = opinion_civil_war_supporter
							months = 60
						}
					}
				}

				# mark former liege and loyalists as losers
				any_vassal = {
					limit = {
						has_opinion_modifier = {
							who = FROM
							modifier = pf_loyal_toward
						}
					}
					reverse_opinion = {
						who = LIEGE
						modifier = opinion_civil_war_loser
						months = 60
					}
				}
				FROM = {
					reverse_opinion = {
						who = PREV
						modifier = opinion_civil_war_loser
						months = 60
					}
				}

				# remember those who chose to be neutral
				any_vassal = {
					limit = {
						has_opinion_modifier = {
							who = FROM
							modifier = pf_neutral_toward
						}
					}
					reverse_opinion = {
						who = LIEGE
						modifier = opinion_civil_war_neutral
						months = 60
					}
				}
			}
		}

		# check whether the primary title should be destroyed due to CA loss
		if = {
			limit = { has_title_flag = destroy_title }
			hidden_tooltip = {
				ROOT = { character_event = { id = Plus.1620 days = 4 } } #destroy title
			}
		}

		# clean up remaining TOMs
		pf_civil_war_cleanup_effect = yes

		# post-civil war event to reward allies
		hidden_tooltip = {
			ROOT = {
				#emf_dynlevy_update_effect = yes
				hidden_tooltip = { character_event = { id = PlusFaction.450 } }
			}
		}

		# change faction moods
		FROM = { hidden_tooltip = { character_event = { id = PlusFaction.200 days = 1 } } }
		ROOT = { hidden_tooltip = { character_event = { id = PlusFaction.200 days = 1 } } }

		#emf_cb_dynlevy_end_effect = yes
	}

	on_fail = {
		log = "CB(claim_on_liege_plot): WHITEPEACE: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"

		#emf_cb_dynlevy_end_effect = yes

		# clean up remaining civil war state
		pf_civil_war_cleanup_effect = yes

		ROOT = {
			prestige = -100
			if = {
				limit = {
					NOT = { has_character_flag = no_whitepeace_prison }
				}
				imprison = FROM
			}
			clr_character_flag = no_whitepeace_prison
		}

		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}

		hidden_tooltip = {
			FROM = {
				remove_opinion = {
					who = ROOT
					modifier = declared_war
				}
			}
		}

		hidden_tooltip = {
			check_war_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_reverse_demand = {
		log = "CB(claim_on_liege_plot): DEFEAT: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"

		#emf_cb_obj_win_war_reverse_effect = yes
		#emf_cb_dynlevy_end_effect = yes

		FROM = {
			# the defender loses 1 Imperial Decadence
			imperial_decadence_minus_1_effect = yes
			# add victory modifier for the 'Win a War' ambition
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			# remove any previously-existing loser TOMs
			pf_civil_war_clear_old_opinions_effect = yes
		}

		# apply immediate effects to the revolters
		any_attacker = {
			limit = { has_opinion_modifier = { who = FROM modifier = revolting_against } }
			imprison = FROM
			hidden_tooltip = {
				reverse_opinion = { who = FROM modifier = opinion_civil_war_loser months = 60 }
				opinion = { who = FROM modifier = opinion_coerced_into_leaving_faction months = 60 }
			}
		}

		# mark loyalists and neutrals for the reward event
		hidden_tooltip = {
			FROM = {
				any_vassal = {
					limit = { reverse_has_opinion_modifier = { who = PREV modifier = pf_loyal_to_me } }
					reverse_opinion = { who = PREV modifier = opinion_civil_war_supporter months = 60 }
				}
				any_vassal = {
					limit = { reverse_has_opinion_modifier = { who = PREV modifier = pf_neutral_to_me } }
					reverse_opinion = { who = PREV modifier = opinion_civil_war_neutral months = 60 }
				}
			}
		}

		# clean up remaining TOMs
		pf_civil_war_cleanup_effect = yes

		ROOT = { prestige = -200 }

		FROM = {
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}

		# post-civil war event to reward allies
		FROM = {
			hidden_tooltip = { character_event = { id = PlusFaction.450 } }
		}

		# change faction moods
		hidden_tooltip = {
			FROM = { character_event = { id = PlusFaction.200 days = 1 } }
			ROOT = { character_event = { id = PlusFaction.200 days = 1 } }
		}
	}

	on_reverse_demand_title = {
		remove_claim = ROOT
		ROOT = {
			custom_tooltip = { text = MAY_NOT_BECOME_PRETENDER_AGAIN }
			hidden_tooltip = {
				reverse_opinion = {
					who = FROM
					modifier = failed_to_claim_my_title
					years = 100
				}
			}
		}
	}

	on_attacker_leader_death = {
		end_war = invalid
	}

	on_invalidation = {
		log = "CB(claim_on_liege_plot): INVALIDATED: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"

		#emf_cb_dynlevy_end_effect = yes

		# clean up remaining civil war state
		pf_civil_war_cleanup_effect = yes
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 4 Disabled
claim_on_vassal_plot = {
	name = CB_NAME_CLAIM_VASSAL
	war_name = WAR_NAME_CLAIM_VASSAL
	sprite = 3
	truce_days = 3650
	hostile_against_others = yes
	reflect_titleholder_change = no

	press_claim = yes
	attacker_can_call_allies = no
	can_attack_vassals = yes

	allowed_to_target_tributaries = no

	infamy_modifier = 0.85

	can_use = {
		always = no
	}

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				de_facto_liege = ROOT
			}
		}
	}

	is_valid_title = {
		FROM = {
			has_landed_title = PREV
		}
		ROOT = {
			has_plot = plot_gain_vassal_title
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			prestige = 50
		}
	}

	on_success_title = {
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
		ROOT = { plot_succeeds = yes }

		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
			cancel_plot = plot_gain_vassal_title
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_invalidation = {
		ROOT = {
			cancel_plot = plot_gain_vassal_title
		}

	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			cancel_plot = plot_gain_vassal_title
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}

		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	on_defender_leader_death = {
		ROOT = {
			cancel_plot = plot_gain_vassal_title
		}
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 5 Disabled
other_claim_on_liege = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_OTHER_CLAIM
	sprite = 4
	truce_days = 3650
	hostile_against_others = yes
	can_ask_to_join_war = no

	press_claim = yes
	can_call_vassals = no
	#attacker_can_call_allies = no
	major_revolt = yes


	allowed_to_target_tributaries = no

	infamy_modifier = 0.5

	sort_priority = 850

	can_use = {
		always = no
	}

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use_title = {
		OR = {
			ROOT = { is_female = no }
			NOT = { has_law = agnatic_succession }
			AND = {
				lower_tier_than = KING
				is_primary_holder_title = no
			}
			FROMFROM = { has_character_flag = faction_claimant_ultimatum_taken } # Faction war. Ignore claim strength.
		}

		FROM = {
			has_landed_title = PREV
		}

		OR = {
			ROOT = { has_strong_claim = PREV }
			FROMFROM = { has_character_flag = faction_claimant_ultimatum_taken } # Faction war. Ignore claim strength.
			AND = {
				ROOT = { has_weak_claim = PREV }
				OR = {
					is_pretender = yes # Checks vs ROOT character
					holder_scope = { has_regent = yes }
					AND = {
						ROOT = { OR = { is_female = no has_law = status_of_women_4 } }
						holder_scope ={ AND = { is_female = yes NOR = { has_law = status_of_women_4 has_game_rule = { name = gender value = all } } } }
					}
					is_contested = yes # Is already being contested in some form of Claim or Succession War
				}
			}
		}
		is_vice_royalty = no
	}

	is_valid = {
		FROM = {
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
		OR = {
			liege = {
				character = PREV # either independent
			}
			liege = {
				FROM = {
					is_liege_or_above = PREV # or have shared liege
				}
			}
		}
	}

	is_valid_title = {
		NOT = {
			holder_scope = {
				character = ROOT
			}
		}

		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}

		OR = {
			has_law = succ_feudal_elective
			has_law = succ_hre_elective
			ROOT = { has_claim = PREV }
		}

		NOT = {
			any_war = { # when used in title scope, checks all wars for that title
				attacker = {
					character = ROOT
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			participation_scaled_prestige = 100
			hidden_tooltip = {  disband_event_forces = faction_revolters }
		}
		participation_scaled_prestige = 100
		hidden_tooltip = {  disband_event_forces = faction_revolters }
		any_attacker = {
			limit = {
				NOT = { character = ROOT }
				NOT = { character = PREV }
			}
			hidden_tooltip = {
				participation_scaled_prestige = 100
				disband_event_forces = faction_revolters
			}
		}
		ROOT = {
			opinion = {
				modifier = pressed_my_claim
				who = PREV
			}
		}

		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists }

			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						#is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}

		if = {
			limit = {
				ROOT = {
					prisoner = yes
					host = { character = FROM  }
				}
			}
			ROOT = { prisoner = no }
		}
	}

	on_success_title = {
		if = {
			limit = {
				is_primary_holder_title = yes
			}
			hidden_tooltip = {
				FROM = { set_character_flag = temp_other_claim_on_liege_prison }
			}
		}

		hidden_tooltip = {
			ROOT = {
				if = {
					limit = {
						has_nickname = no
						lower_tier_than = PREV
					}
					random = {
						chance = 50
						give_nickname = nick_the_usurper
					}
				}
			}
		}

		# If the claimant has the wrong government type, take care of that first.
		if = {
			limit = {
				higher_tier_than = ROOT
				holder_scope = {
					is_feudal = yes
				}
				ROOT = {
					is_ruler = yes
					OR = {
						is_theocracy = yes
						is_republic = yes
					}
				}
			}
			ROOT = {
				abdicate = {
					move = no
				}
			}
		}

		usurp_title_plus_barony_if_unlanded_and_vassals_no_adj = { target = ROOT type = claim }

		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}

		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_success_posttitle = {
		hidden_tooltip = {
			if = {
				limit = {
					top_liege = {
						ROOT = {
							NOT = {
								top_liege = {
									character = PREVPREV
								}
							}
						}
					}
				}

				ROOT = {
					set_defacto_liege = PREV
				}
			}

			if = {
				limit = {
					top_liege = {
						ROOT = {
							NOT = {
								top_liege = {
									character = PREVPREV
								}
							}
						}
					}
				}

				ROOT = {
					set_defacto_liege = ROOT
				}
			}

			if = {
				limit = {
					FROM = {
						has_character_flag = temp_other_claim_on_liege_prison
						lower_tier_than = PREV
					}
				}
				FROM = {
					imprison = ROOT
				}
			}
			FROM = { clr_character_flag = temp_other_claim_on_liege_prison }
		}
	}

	on_fail = {
		prestige = -100

		imprison = FROM
		#if = { #Issue CKTWO-233
		#	limit = {
		#		OR = {
		#			is_liege_of = ROOT
		#			ROOT = { is_liege_or_above = FROM }
		#		}
		#	}
		#	ROOT = {
		#		imprison = FROM
		#	}
		#}

		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}

		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
			}
		}

		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		prestige = -200

		imprison = FROM
		#if = { #Issue CKTWO-233
		#	limit = {
		#		OR = {
		#			is_liege_of = ROOT
		#			ROOT = { is_liege_or_above = FROM }
		#		}
		#	}
		#	ROOT = {
		#		imprison = FROM
		#	}
		#}

		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				if = {
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				disband_event_forces = faction_revolters
				prisoner = FROM
			}
		}

		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 6
claim_all = {
	name = CB_NAME_CLAIM_ALL
	war_name = WAR_NAME_CLAIM_ALL
	sprite = 5
	truce_days = 3650
	is_permanent = yes
	can_ask_to_join_war = yes
	is_claim_all = yes

	allowed_to_target_tributaries = yes

	sort_priority = 1100

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			attacking_religious_head_trigger = no
			any_claim = {
				holder_scope = {
					OR = {
						character = FROM
						is_liege_or_above = FROM
					}
				}
				is_usable_claim_trigger = yes
				count = 2
			}
		}
		#only cynics can press claims against same-religion holy orders?
		OR = {
			FROM = { NOT = { religion = ROOT } }
			ROOT = { trait = cynical }
			ROOT = { ai = no }
			FROM = { ai = no }
			FROM = { higher_tier_than = duke }
			FROM = { holy_order = no }
		}
	}

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	is_valid = {
		ROOT = {
			any_claim = {
				holder_scope = {
					OR = {
						character = FROM
						is_liege_or_above = FROM
					}
				}
				is_usable_claim_trigger = yes
			}
		}
	}

	on_add = {
		ROOT = {
			show_scope_change = no
			any_claim = {
				show_scope_change = no
				limit = {
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
					is_usable_claim_trigger = yes
				}
				press_claim = ROOT
			}
		}
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		FROM = {
			attacked_tributary_cb_effect = yes
		}
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their Claim All war against [From.GetBestName] (ID: [From.GetID])"
		FROM = { save_event_target_as = pf_lc_enemy }
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			show_scope_change = no
			any_claim = {
				show_scope_change = no
				limit = {
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
					is_usable_claim_trigger = yes
				}
				title_reduce_CA_effect = yes
				title_reduce_TO_effect = yes
				empty_province_effect = yes
				pf_liege_change_under_title_begin_effect = yes
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
				if = {
					limit = {
						higher_tier_than = BARON
						NOT = { culture = ROOT }
					}
					hidden_tooltip = { conquest_culture = ROOT }
				}
			}
			if = { #China with no land calculates what to do with nomad provinces
				limit = {
					is_offmap_governor = yes
					offmap_power = { is_offmap_tag = offmap_china }
					offmap_china = { has_offmap_tmp_flag = WP_is_not_on_map }
					NOT = { wealth = 2500 } #unless already rich from tributes
				}
				set_variable = { which = "WP_nomad_provinces" value = 0 }
				any_realm_province = {
					limit = {
						has_province_modifier = nomad_agitation
						NOT = { has_settlement_construction = yes }
					}
					province_event = { id = JD.60100 } #increase counter for each nomad province
				}
				character_event = { id = JD.60101 days = 1 } #calculate gold sent from china for building holdings
			}
		}
		pf_liege_change_under_title_end_effect = yes
		hidden_tooltip = {
			ROOT = {
				if = {
					limit = {
						has_dlc = "Legacy of Rome"
						OR = {
							has_landed_title = e_byzantium
							has_landed_title = e_roman_empire
							AND = {
								independent = yes
								higher_tier_than = COUNT
								OR = {
									culture = roman
									religion_group = hellenic_pagan_group
								}
							}
						}
						OR = {
							religion_group = christian
							religion_group = hellenic_pagan_group
						}
					}
					character_event = { id = LoR.30 days = 12 }
				}
			}
		}
		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = { pf_glory_minus2_effect = yes }
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
			if = {
				limit = {
					has_character_flag = is_otto
					FROM = {
						has_character_flag = is_giselbert
					}
				}
				reverse_imprison = FROM
			}
		}
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 75
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 75 }
		}
	}

	on_reverse_demand = {
		FROM = {
			show_scope_change = no
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			show_scope_change = no
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			pf_glory_minus2_effect = yes
			any_claim = {
				show_scope_change = no
				limit = {
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
					is_usable_claim_trigger = yes
				}
				ROOT = { show_scope_change = no remove_claim = PREV }
			}
			hidden_effect = {
				if = { #Makes China have a chance of leaving Expanionist policy...
					limit = {
						has_landed_title = e_china_west_governor
						offmap_china = {
							has_policy = china_expansionist
						}
					}
					random = {
						chance = 50
						offmap_china = {
							set_policy = china_open
							log = "-------------------------------------"
							log = "China Policy Logging:"
							log = "Chinas new Policy is now OPEN"
							log = "-------------------------------------"
						}
					}
					log = "China War Logging: China lost a claim all war against [From.GetBestName]"
				}
			}
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 200
			if = {
				limit = {
					has_dlc = "Legacy of Rome"
					OR = {
						has_landed_title = e_byzantium
						has_landed_title = e_roman_empire
						AND = {
							independent = yes
							higher_tier_than = COUNT
							OR = {
								culture = roman
								religion_group = hellenic_pagan_group
							}
						}
					}
					OR = {
						religion_group = christian
						religion_group = hellenic_pagan_group
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	on_attacker_leader_death = {
		if = {
			limit = { ROOT = { has_character_flag = claimant_adventurer } }
			ROOT = {
				hidden_tooltip = {
					disband_event_forces = claimant_adventure
					clr_character_flag = claimant_adventurer
				}
			}
			end_war = invalid
		}
	}

	on_invalidation = {
		log = "CB(claim_all): INVALIDATED: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 1.2
			ROOT = {
				realm_levy_diff = { who = FROM value = 5000 }
			}
		}
		modifier = { # The AI will never breach a tributary's trust
			factor = 0
			ai_attack_tributary_trigger = yes
		}
		modifier = {
			factor = 0
			ROOT = {
				controls_religion = yes
				NOT = { realm_size = 1 }
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 7 Disabled
change_seniority_succession_law = {
	name = CB_NAME_SENIORITY_SUCCESSION_LAW
	war_name = WAR_NAME_SENIORITY_SUCCESSION_LAW
	sprite = 6
	truce_days = 3650
	attacker_can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes

	can_use = {
		always = no
		ROOT = {
			vassal_of = FROM
		}
	}

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	is_valid = {
		FROM = {
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}

	is_valid_title = {
		NOT = {
			has_law = succ_seniority
		}
		OR = {
			tier = emperor
			tier = king
			is_primary_holder_title = yes
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists }

			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						#is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}
		ROOT = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				disband_event_forces = faction_revolters
			}
		}
	}

	on_success_title = {
		succession_w_cooldown = seniority
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}

		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_seniority_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			prestige = -200
			prisoner = FROM
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 100
			hidden_tooltip = {
				if = {
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_seniority_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}

		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 8 Disabled
change_primogeniture_succession_law = {
	name = CB_NAME_PRIMOGENITURE_SUCCESSION_LAW
	war_name = WAR_NAME_PRIOGENITURE_SUCCESSION_LAW
	sprite = 6
	truce_days = 3650
	attacker_can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes

	can_use = {
		always = no
		ROOT = {
			vassal_of = FROM
		}
	}

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	is_valid = {
		FROM = {
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}

	is_valid_title = {
		NOT = {
			has_law = succ_primogeniture
		}
		OR = {
			tier = emperor
			tier = king
			is_primary_holder_title = yes
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists }

			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						#is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}

		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				disband_event_forces = faction_revolters
			}
		}
	}

	on_success_title = {
		succession_w_cooldown = primogeniture
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}

		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_primogeniture_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}

		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			prestige = -200
			prisoner = FROM
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 100
			hidden_tooltip = {
				if = {
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_primogeniture_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}

		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 9 Disabled
change_feudal_elective_succession_law = {
	name = CB_NAME_FEUDAL_ELECTIVE_SUCCESSION_LAW
	war_name = WAR_NAME_FEUDAL_ELECTIVE_SUCCESSION_LAW
	sprite = 6
	truce_days = 3650
	attacker_can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes

	can_use = {
		always = no
		ROOT = {
			vassal_of = FROM
		}
	}

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	is_valid = {
		FROM = {
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}

	is_valid_title = {
		NOR = {
			has_law = succ_feudal_elective
			has_law = succ_hre_elective
		}
		OR = {
			tier = emperor
			tier = king
			is_primary_holder_title = yes
		}

	}

	on_success = {
		FROM = {

			hidden_tooltip = { disband_event_forces = faction_loyalists }
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}
		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				disband_event_forces = faction_revolters
			}
		}
	}

	on_success_title = {
		if = {
			limit = {
				NOR = {
					title = e_hre
					has_title_flag = alternate_hre
				}
			}
			add_law_w_cooldown = succ_feudal_elective
			#succession_w_cooldown = {
			#	base_type = feudal_elective
			#	voting_rules = feudal_elective
			#}
		}
		if = {
			limit = {
				OR = {
					title = e_hre
					has_title_flag = alternate_hre
				}
			}
			add_law_w_cooldown = succ_hre_elective
			#succession_w_cooldown = {
			#	base_type = feudal_elective
			#	voting_rules = hre_feudal_elective
			#}
		}
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}

		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_feudal_elective_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			prestige = -200
			prisoner = FROM
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 100
			hidden_tooltip = {
				if = {
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_feudal_elective_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}

		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 10
invasion = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_INVASION
	sprite = 7
	truce_days = 3650
	hostile_against_others = yes
	can_ask_to_join_war = yes

	allowed_to_target_tributaries = no

	sort_priority = 2000

	can_use = {
		ROOT = {
			mercenary = no
		}
	}

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use_title = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			show_scope_change = no
			imperial_decadence_minus_1_effect = yes
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			participation_scaled_prestige = 300
		}
		FROM = {
			show_scope_change = no
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 300 }
		}
		ROOT = {
			if = {
				limit = {
					has_nickname = no
				}
				random_list = {
					10 = { give_nickname = nick_the_great }
					10 = { give_nickname = nick_the_victorious }
					10 = { give_nickname = nick_the_bold }
					10 = { give_nickname = nick_the_conqueror }
				}
			}
			if = {
				limit = {
					has_nickname = nick_the_bastard
				}
				give_nickname = nick_the_conqueror
			}
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their Invasion CB of [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		any_de_jure_vassal_title = {
			limit = {
				NOT = { holder = FROM }
				tier = COUNT
				location = { controlled_by = ROOT }
			}
			add_claim = ROOT
			duchy = {
				if = {
					limit = {
						has_holder = yes
						NOT = { holder = FROM }
					}
					add_claim = ROOT
				}
			}
		}
		empty_province_effect = yes
		any_de_jure_vassal_title = {
			limit = {
				holder = FROM
				higher_tier_than = BARON
			}
			usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
		}
		hidden_tooltip = {
			ROOT = {
				if = {
					limit = {
						has_dlc = "Legacy of Rome"
						OR = {
							has_landed_title = e_byzantium
							has_landed_title = e_roman_empire
							AND = {
								independent = yes
								higher_tier_than = COUNT
								OR = {
									culture = roman
									religion_group = hellenic_pagan_group
								}
							}
						}
						OR = {
							religion_group = christian
							religion_group = hellenic_pagan_group
						}
					}
					character_event = { id = LoR.30 days = 12 }
				}
			}
		}
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			prestige = -150
		}
	}

	on_reverse_demand = {
		FROM = {
			show_scope_change = no
			imperial_decadence_minus_1_effect = yes
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			show_scope_change = no
			prestige = -300
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 300
			if = {
				limit = {
					has_dlc = "Legacy of Rome"
					OR = {
						has_landed_title = e_byzantium
						has_landed_title = e_roman_empire

						AND = {
							independent = yes
							higher_tier_than = COUNT
							OR = {
								culture = roman
								religion_group = hellenic_pagan_group
							}
						}
					}
					OR = {
						religion_group = christian
						religion_group = hellenic_pagan_group
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 300 }
		}
	}

	on_reverse_demand_title = {
		ROOT = { show_scope_change = no remove_claim = PREV }
	}

	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}

		end_war = whitepeace
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = { #Focus on Coronation first.
			factor = 0.1
			has_dlc = "Holy Fury"
			ROOT = {
				is_feudal = yes
				OR = {
					religion = catholic
					religion = fraticelli
				}
				is_crowned_trigger = no
			}
		}
		#added to vanilla version in 3.0 - needs testing to evaluate if putting this restriction on the AI is useful in Plus
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_nomadic = no
				NOT = {
					is_tribal = yes
				}
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_tribal = yes
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = tribal
						}
					}
				}
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 11
tribal_invasion = {
	name = CB_NAME_TRIBAL_INVASION
	war_name = WAR_NAME_TRIBAL_INVASION
	sprite = 8
	truce_days = 1825
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes

	allowed_to_target_tributaries = no

	sort_priority = 2000

	can_use_gui = {
		ROOT = {
			prestige = 500
		}
		check_if_crusader_trigger = yes
	}

	on_add = {
		ROOT = { show_scope_change = no prestige = -500 }
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
		if = {
			limit = {
				attacker = {
					any_owned_bloodline = {
						has_bloodline_flag = bloodline_great_conquerors
					}
				}
			}
			attacker = {
				set_character_flag = flag_declared_bloodline_invasion
			}
		}
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			independent = yes
			is_nomadic = no
			NOT = { is_liege_or_above = FROM }
			OR = {
				AND = {
					has_dlc = "Horse Lords"
					higher_tier_than = COUNT
					OR = {
						has_character_flag = horde_invader
						AND = {
							independent = yes
							OR = {
								is_pagan_religion = yes
								AND = {
									NOT = { is_title_active = d_aztec }
									religion = aztec
								}
							}
							is_reformed_pagan_religion = no
							OR = {
								culture_group = altaic
								culture_group = magyar
								culture_group = mesoamerican
							}
							FROM = {
								NOT = { is_pagan_religion = yes } # Should subjugate these instead
							}

						}
					}
				}
				AND = {
					NOT = { has_dlc = "Horse Lords" }
					independent = yes
					higher_tier_than = COUNT
					OR = {
						AND = {
							is_pagan_religion = yes
							is_reformed_pagan_religion = no
						}
						AND = {
							religion = aztec
							NOT = { is_title_active = d_aztec }
						}
						AND = {
							OR = {
								has_horde_culture = yes
								has_character_flag = horde_invader
							}
							NOT = { religion_group = christian }
						}
					}
					OR = {
						culture_group = altaic
						culture_group = magyar
						culture_group = mesoamerican
					}
					OR = {
						has_horde_culture = yes
						has_character_flag = horde_invader
						FROM = {
							NOT = { is_pagan_religion = yes } # Should subjugate these instead
						}
					}
				}
				AND = {
					mercenary = yes
					NOT = { num_of_titles = 2 }
				}
				AND = {
					has_character_flag = is_child_of_destiny
					any_owned_bloodline = {
						has_bloodline_flag = founder_invasions
					}
				}
				AND = {
					NOT = { has_character_flag = flag_declared_bloodline_invasion }
					any_owned_bloodline = {
						has_bloodline_flag = bloodline_great_conquerors
					}
				}
			}
		}
		ROOT = {
			NOT = { same_realm = FROM }
		}
	}

	can_use_title = {
		# The attacker needs at least one county in the target kingdom, or a border
		ROOT = {
			OR = {
				ai = yes
				multiplayer = no
				NOT = {
					has_game_rule = {
						name = multiplayer_invasions
						value = off
					}
				}
			}
			any_realm_province = {
				OR = {
					county = { de_jure_liege_or_above  = PREVPREVPREV }
					any_neighbor_province = {
						county = { de_jure_liege_or_above  = PREVPREVPREVPREV }
					}
				}
			}
			OR = { # This ensures that the AI doesn't declare this type of war against someone who only holds a few counties within the targeted title...
				ROOT = {
					ai = no
				}
				ROOT = {
					OR = {
						has_landed_title = e_mongol_empire
						has_landed_title = e_mexikha
					}
				}
				FROM = {
					num_of_realm_counties = {
						value = 3
						title = PREVPREV
					}
				}
			}
		}
	}

	is_valid_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_success = {
		ROOT = {
			show_scope_change = no
			prestige = 300
			imperial_decadence_minus_1_effect = yes
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			participation_scaled_prestige = 300
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 300 }
		}
		FROM = {
			show_scope_change = no
			prestige = -300
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}
		hidden_tooltip = {
			ROOT = {
				occupy_minors_of_occupied_settlements = FROM
				gain_all_occupied_titles = { who = FROM type = invasion }
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_victorious }
						10 = { give_nickname = nick_the_conqueror }
						10 = { give_nickname = nick_the_brave }
						10 = { give_nickname = nick_the_dragon }
						10 = { give_nickname = nick_the_terrible }
					}
				}
			}
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their Tribal Invasion CB of the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		empty_province_effect = yes
		custom_tooltip = {
			text = tribal_invasion_succ_tip
			hidden_tooltip = {
				pf_liege_change_under_title_begin_effect = yes
				ROOT = {
					vassalize_or_take_under_title_destroy_duchies = {
						title = PREV
						enemy = FROM
						is_crusade = yes # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
						type = invasion
					}
				}
				pf_liege_change_under_title_end_effect = yes
				if = {
					limit = {
						e_mexikha = {
							holder = ROOT
						}
					}
					ROOT = {
						any_realm_province = {
							limit = {
								OR = {
									has_province_flag = aztec_explorers
									has_province_flag = aztec_second_wave
								}
							}
							culture = nahuatl
							religion = aztec
							clr_province_flag = aztec_explorers
							clr_province_flag = aztec_second_wave
						}
					}
				}
			}
		}

		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		FROM = {
			show_scope_change = no
			prestige = 150
			participation_scaled_prestige = 150
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 150 }
		}
		ROOT = {
			show_scope_change = no
			prestige = -150
		}
	}

	on_reverse_demand = {
		FROM = {
			imperial_decadence_minus_1_effect = yes
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			show_scope_change = no
			prestige = -300
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}
		FROM = {
			show_scope_change = no
			prestige = 300
			hidden_tooltip = {
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_hammer }
						10 = { give_nickname = nick_the_avenger }
						10 = { give_nickname = nick_the_lion }
						10 = { give_nickname = nick_the_bold }
					}
				}
			}
			participation_scaled_prestige = 300
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 300 }
		}
		FROM = {
			if = {
				limit = {
					has_dlc = "Legacy of Rome"
					OR = {
						has_landed_title = e_byzantium
						has_landed_title = e_roman_empire
						AND = {
							independent = yes
							higher_tier_than = COUNT
							OR = {
								culture = roman
								religion = roman_pagan
							}
						}
					}
					OR = {
						religion_group = christian
						is_pagan_religion = yes
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = { #Focus on Coronation first.
			factor = 0.1
			has_dlc = "Holy Fury"
			ROOT = {
				is_feudal = yes
				OR = {
					religion = catholic
					religion = fraticelli
				}
				is_crowned_trigger = no
			}
		}
		# Try to guide the Hordes in the right direction
		modifier = {
			factor = 0.1
			ROOT = {
				OR = {
					dynasty = 613 # Seljuks
					dynasty = 800 # Timurids
					primary_title = { title = e_il-khanate }
				}
			}
			OR = {
				capital_scope = {
					OR = {
						region = custom_bulgaria
						region = custom_croatia
						region = custom_serbia
						region = custom_wallachia
						region = custom_crimea
						region = custom_cuman
						region = custom_perm
						region = custom_volga
						region = custom_rus
						region = world_india_bengal
						region = world_india_deccan
						region = world_india_rajastan
					}
				}
				FROM = {
					primary_title = { title = e_golden_horde }
					NOT = { year = 1300 }
				}
				FROM = {
					primary_title = { title = e_chagatai }
					NOT = { year = 1300 }
				}
			}
		}
		modifier = {
			factor = 2.0
			ROOT = {
				OR = {
					dynasty = 613 # Seljuks
					dynasty = 800 # Timurids
					primary_title = { title = e_il-khanate }
				}
			}
			capital_scope = { region = custom_persia }
		}
		modifier = {
			factor = 2.0
			ROOT = { primary_title = { title = e_golden_horde } }
			capital_scope = {
				OR = {
					region = custom_cuman
					region = custom_perm
					region = custom_volga
				}
			}
		}
		modifier = {
			factor = 1.5
			ROOT = {
				primary_title = { title = e_mongol_empire }
				NOT = { any_realm_province = { region = custom_cuman } }
			}
			capital_scope = { region = custom_cuman }
		}
		modifier = {
			factor = 2.0
			ROOT = {
				primary_title = { title = e_mongol_empire }
				NOT = { any_realm_province = { region = custom_persia } }
			}
			capital_scope = { region = custom_persia }
		}
		modifier = {
			factor = 2.0
			ROOT = { primary_title = { title = e_mongol_empire } }
			capital_scope = { region = custom_khwarizm }
		}
		modifier = {
			factor = 0.1
			ROOT = { primary_title = { title = e_golden_horde } }
			OR = {
				capital_scope = {
					OR = {
						region = custom_persia
						region = custom_baluchistan
						region = custom_afghanistan
						region = custom_mesopotamia
						region = custom_azerbaijan
						region = custom_armenia
						region = custom_trebizond
						region = custom_nikaea
						region = custom_byzantium
						region = custom_norway
						region = custom_sweden
						region = custom_syria
						region = custom_arabia
						region = custom_jerusalem
						region = custom_egypt
						region = custom_africa
						region = world_india_bengal
						region = world_india_deccan
						region = world_india_rajastan
					}
				}
				FROM = {
					primary_title = { title = e_il-khanate }
					NOT = { year = 1300 }
				}
				FROM = {
					primary_title = { title = e_chagatai }
					NOT = { year = 1300 }
				}
			}
		}
		modifier = {
			factor = 0.1
			ROOT = {
				primary_title = { title = e_chagatai }
			}
			OR = {
				capital_scope = {
					NOR = {
						region = custom_baluchistan
						region = custom_afghanistan
						region = world_india_bengal
						region = world_india_deccan
						region = world_india_rajastan
					}
				}
				FROM = {
					primary_title = { title = e_il-khanate }
					NOT = { year = 1300 }
				}
				FROM = {
					primary_title = { title = e_chagatai }
					NOT = { year = 1300 }
				}
			}
		}
		modifier = {
			factor = 0.1
			ROOT = { culture = hungarian }
			capital_scope = {
				OR = {
					region = custom_cuman
					region = custom_volga
					region = custom_alania
					region = custom_crimea
					region = custom_novgorod
					region = custom_muscovy
					region = custom_rus
					region = custom_byzantium
				}
			}
		}
		modifier = {
			factor = 0.1
			ROOT = { culture = khazar }
			capital_scope = {
				OR = {
					region = world_steppe_tarim
					region = world_steppe_east
					region = custom_cuman
					region = custom_perm
					region = custom_volga
				}
			}
		}
		modifier = {
			factor = 1.5
			ROOT = { culture = hungarian }
			capital_scope = {
				OR = {
					region = custom_bulgaria
					region = custom_carpathia
					region = custom_croatia
				}
			}
		}
		modifier = {
			factor = 0.1
			ROOT = {
				OR = {
					primary_title = { title = e_mongol_empire }
					primary_title = { title = e_chagatai }
					primary_title = { title = e_golden_horde }
					primary_title = { title = e_il-khanate }
				}
				culture = FROM
			}
		}
		modifier = {
			factor = 0
			ROOT = {
				culture = mongol
				is_pagan_religion = yes
			}
			FROM = {
				culture = mongol
				is_pagan_religion = yes
			}
		}
		modifier = {
			factor = 0
			ROOT = { has_character_flag = no_invasions }
		}
		modifier = {
			factor = 0
			ROOT = {
				has_character_flag = is_temujin
				has_landed_title = e_mongol_empire
				demesne_size = 1
			}
			FROM = {
				has_landed_title = e_china_west_governor
			}
		}
		modifier = { #Prefer bigger targets
			factor = 1.5
			FROM = {
				tier = KING
			}
		}
		modifier = { #Prefer bigger targets
			factor = 2.0
			FROM = {
				tier = EMPEROR
			}
		}
		modifier = {
			factor = 5.0
			ROOT = { trait = bloodlust }
		}
		sufficient_treasury_for_war = yes
	}
}

# 12
crusade = {
	name = CB_NAME_CRUSADE
	war_name = WAR_NAME_CRUSADE
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	battle_warscore_mult = 0.5
	max_defender_occupation_score = 85
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	is_crusade = yes

	allowed_to_target_tributaries = no

	sort_priority = 3000

	can_use_gui = {
		has_game_started = yes
		has_global_flag = plus_rules_applied
		OR = {
			AND = {
				NOT = { has_global_flag = delayed_crusades_1 }
				NOT = { has_global_flag = delayed_crusades_2 }
				NOT = { has_global_flag = delayed_crusades_3 }
				NOT = { has_global_flag = delayed_crusades_4 }
				NOT = { has_global_flag = delayed_crusades_5 }
			}
			had_global_flag = { flag = delayed_crusades_1 days = 365 }
			had_global_flag = { flag = delayed_crusades_2 days = 1095 }
			had_global_flag = { flag = delayed_crusades_3 days = 1825 }
			had_global_flag = { flag = delayed_crusades_4 days = 3650 }
			had_global_flag = { flag = delayed_crusades_5 days = 7300 }
		}
		FROM = { NOT = { has_character_modifier = crusade_block_timer } }
		ROOT = { # The Religious Head
			uses_new_crusade = no
			has_called_crusade = no
			has_secret_religion = no
			religion_authority = 0.4
			NOT = {
				has_character_modifier = crusade_timer
				AND = {
					trait = bad_priest_christian
					NOT = { has_global_flag = fourth_crusade_happened }
				}
			}
			conditional_tooltip = {
				trigger = {
					is_alternate_start = yes
					has_alternate_start_parameter = {
						key = religion_names
						value = random
					}
				}
				custom_tooltip = {
					text = ALT_GHW_STARTED
					has_global_flag = muslim_jihads_unlocked
					has_global_flag = pagan_ghws_unlocked
					has_global_flag = christian_crusades_unlocked
				}
			}
			conditional_tooltip = {
				trigger = {
					NOT = {
						has_alternate_start_parameter = {
							key = religion_names
							value = random
						}
					}
				}
				OR = {
					religion_group = zoroastrian_group
					religion_group = jewish_group
					AND = {
						religion_group = pagan_group
						custom_tooltip = {
							text = CTT_PAGAN_GHWS_UNLOCKED
							has_global_flag = pagan_ghws_unlocked
						}
					}
					AND = {
						religion_group = christian
						custom_tooltip = {
							text = CTT_CHRISTIAN_CRUSADES_UNLOCKED
							has_global_flag = christian_crusades_unlocked
						}
					}
					AND = {
						religion_group = muslim
						custom_tooltip = {
							text = CTT_MUSLIM_JIHADS_UNLOCKED
							has_global_flag = muslim_jihads_unlocked
						}
					}
				}
			}
			mercenary = no
		}
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			uses_new_crusade = no
			can_call_crusade = yes
			any_demesne_title = { NOT = { controls_religion = yes } }
			OR = {
				NOT = { religion = cathar }
				has_global_flag = cathar_war
			}
		}

		FROM = {
			OR = {
				NOT = { religion_group = ROOT }
				is_heresy_of = ROOT
				is_parent_religion = ROOT
				AND = {
					is_pagan_religion = yes
					NOT = { religion = ROOT }
				}
				AND = {
					ROOT = { religion = paulician }
					NOT = { religion = ROOT }
				}
				AND = {
					ROOT = { religion = kharijite }
					NOT = { religion = ROOT }
				}
				AND = {
					ROOT = {
						OR = {
							religion = catholic
							religion = cathar
							religion = fraticelli
							religion = waldensian
							religion = lollard
							religion = adoptionist
						}
						is_heretic = no
					}
					has_global_flag = fourth_crusade_ongoing
				}
			}
		}
	}

	can_use_title = {
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}

			independent = yes
			in_revolt = no # Don't declare Crusades on revolters - chances are high the war will invalidate

			num_of_realm_counties = {
				value = 6
				title = PREV
			}
			#target needs to either hold the target title,
			#be the title's overlord,
			#or the title needs to have no holder/holder of ROOT's religious group
			OR = {
				has_landed_title = PREV
				any_vassal = { has_landed_title = PREVPREV }
				PREV = { has_holder = no }
				PREV = { holder_scope = { religion = ROOT } }
			}
		}

		OR = {
			# religion head is a player
			ROOT = { ai = no }
			# the target owns a holy site within that kingdom title
			FROM = {
				any_realm_title = {
					de_jure_liege_or_above = PREVPREV
					is_holy_site = ROOT
				}
			}
			# the target owns a province of the religion within that kingdom title
			FROM = {
				any_realm_title = {
					tier = COUNT
					de_jure_liege_or_above = PREVPREV
					location = { religion = ROOT }
				}
			}
			# a ruler of the religion either owns a province in that kingdom or is neighboring
			any_direct_de_jure_vassal_title = {
				any_direct_de_jure_vassal_title = {
					location = {
						OR = {
							owner = { religion = ROOT }
							any_neighbor_province = { owner = { religion = ROOT } }
						}
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		ROOT = {
			add_character_modifier = {
				name = "crusade_timer"
				duration = 14600
				hidden = no
				inherit = yes
			}
		}
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	is_valid = {
		ROOT = {
			can_call_crusade = yes
		}
		FROM = {
			OR = {
				NOT = { religion_group = ROOT }
				is_heresy_of = ROOT
				is_parent_religion = ROOT
				AND = {
					is_pagan_religion = yes
					NOT = { religion = ROOT }
				}
				AND = {
					ROOT = { religion = paulician }
					NOT = { religion = ROOT }
				}
				AND = {
					ROOT = { religion = kharijite }
					NOT = { religion = ROOT }
				}
				AND = {
					ROOT = {
						OR = {
							religion = catholic
							religion = cathar
							religion = fraticelli
							religion = waldensian
							religion = lollard
							religion = adoptionist
						}
						is_heretic = no
					}
					has_global_flag = fourth_crusade_ongoing
				}
			}
		}
	}

	is_valid_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their crusade for the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		#change imperial decadence
		ROOT = { imperial_decadence_minus_2_effect = yes }
		FROM = { imperial_decadence_plus_2_effect = yes }

		hidden_tooltip = {
			any_attacker = {
				add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			}
			ROOT = {
				if = {
					limit = {
						OR = {
							religion = catholic
							religion = cathar
							religion = fraticelli
							religion = waldensian
							religion = lollard
							religion = adoptionist
						}
						is_heretic = no
						OR = {
							has_global_flag = catholic_crusade_failed
							has_global_flag = fourth_crusade_ongoing
						}
					}
					clr_global_flag = catholic_crusade_failed
					clr_global_flag = fourth_crusade_ongoing
				}
			}
		}

		hidden_tooltip = { destroy_tradeposts_effect = yes }
		pf_liege_change_under_title_begin_effect = yes

		#first give the target kingdom to its current holder, if the holder is the same religion
		if = {
			limit = {
				has_holder = yes
				holder_scope = {
					religion = ROOT
					NOT = { same_realm = FROM }
				}
			}
			holder_scope = {
				add_character_modifier = { name = new_land_timer duration = 1 hidden = yes }
				gain_settlements_under_title = {
					title = PREV
					enemy = FROM
					is_crusade = yes # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
					type = holy_war
				}
			}
		}
		#then give the target kingdom to its de jure liege, if the holder is the same religion
		if = {
			limit = {
				OR = {
					has_holder = no
					holder_scope = { NOT = { religion = ROOT } }
					holder_scope = { same_realm = FROM }
				}
				dejure_liege_title = {
					has_holder = yes
					holder_scope = {
						religion = ROOT
						NOT = { same_realm = FROM }
					}
				}
			}
			dejure_liege_title = {
				holder_scope = {
					add_character_modifier = { name = new_land_timer duration = 1 hidden = yes }
					gain_settlements_under_title = {
						title = PREVPREV
						enemy = FROM
						is_crusade = yes # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
						type = holy_war
					}
				}
			}
		}
		#then give the target kingdom to the most participating attacker
		if = {
			limit = {
				OR = {
					has_holder = no
					holder_scope = { NOT = { religion = ROOT } }
					holder_scope = { same_realm = FROM }
				}
				NOT = {
					dejure_liege_title = {
						has_holder = yes
						holder_scope = {
							religion = ROOT
							NOT = { same_realm = FROM }
						}
					}
				}
			}
			hidden_tooltip = {
				most_participating_crusader = {
					set_character_flag = crusade_victor
				}
				#other crusaders will request fiefs
				any_attacker = {
					limit = {
						NOT = { has_character_flag = crusade_victor }
						is_feudal = yes
						higher_tier_than = BARON
						demesne_size = 1
						NOT = { religion_group = muslim }
					}
					character_event = { id = Plus.401 }
				}
				#add a strong claim to the best_crusade_claimant if not also the most_participating_attacker
				if = {
					limit = {
						best_crusade_claimant = {
							NOT = { has_character_flag = crusade_victor }
							is_alive = yes
						}
					}
					best_crusade_claimant = { PREV = { add_pressed_claim = PREV } }
				}
				most_participating_crusader = {
					clr_character_flag = crusade_victor
				}
			}
			most_participating_crusader = {
				# Clear original flags first
 				any_landed_title = { clr_title_flag = previous_holding }
 				any_character = { clr_character_flag = previous_vassal }

				any_demesne_title = { set_title_flag = previous_holding }
				any_vassal = { set_character_flag = previous_vassal }
				primary_title = { save_event_target_as = current_title }
				PREV = {
					any_de_jure_vassal_title = {
						limit = {
							tier = COUNT
							holder_scope = { same_realm = FROM }
							location = {
								NOT = { any_province_holding = { NOT = { holding_type = nomad } } }
								NOT = { culture = PREVPREVPREV }
							}
						}
						location = {
							build_holding = { type = tribal }
							any_province_holding = {
								limit = { NOT = { holding_type = nomad } }
								make_capital_holding = yes
							}
						}
					}
				}
				gain_settlements_under_title = {
					title = PREV
					enemy = FROM
					is_crusade = yes # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
					type = holy_war
				}
				#who to give crusade gains to?
				hidden_tooltip = {
					character_event = { id = Plus.400 }
				}
				if = {
					limit = { NOT = { culture = PREV } }
					hidden_tooltip = {
						save_event_target_as = winning_crusader
						PREV = { conquest_culture = event_target:winning_crusader }
					}
				}
				hidden_tooltip = {
					if = {
						limit = {
							OR = {
								this_has_lame_nickname_trigger = yes
								has_nickname = no
							}
						}
						random_list = {
							10 = {
								modifier = {
									factor = 0
									NOT = { religion_group = christian }
								}
								give_nickname = nick_the_crusader
							}
							10 = { give_nickname = nick_the_holy }
							10 = { give_nickname = nick_the_glorious }
							10 = { give_nickname = nick_the_lionheart }
							10 = { give_nickname = nick_the_great }
							10 = { give_nickname = nick_the_hammer }
							10 = { give_nickname = nick_the_pilgrim }
							40 = {
								modifier = {
									factor = 0
									religion_group = christian
								}
								give_nickname = nick_the_sword_of_god
							}
						}
					}
				}
			}
		}

		pf_liege_change_under_title_end_effect = yes

		ROOT = {
			show_scope_change = no
			participation_scaled_piety = 1000
			participation_scaled_prestige = 500
			dynasty_head = {
				if = {
					limit = { uses_decadence = yes }
					participation_scaled_decadence = -100
				}
			}
			#faction mood boost
			pf_tradition_plus4_effect = yes
			pf_glory_plus2_effect = yes
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_piety = 1000
				participation_scaled_prestige = 500
				dynasty_head = {
					if = {
						limit = { uses_decadence = yes }
						participation_scaled_decadence = -100
					}
				}
				pf_tradition_plus4_effect = yes
				pf_glory_plus2_effect = yes
			}
		}

		FROM = {
			prestige = -500
			pf_glory_minus2_effect = yes
			pf_tradition_minus4_effect = yes
		}
		hidden_tooltip = {
			any_defender = {
				limit = { NOT = { character = FROM } }
				prestige = -250
			}
		}
		if = {
			limit = {
				ROOT = { is_heretic = no }
			}
			ROOT = {
				religion_authority = {
					modifier = won_crusade
					years = 20
				}
			}
		}
		if = {
			limit = {
				FROM = { is_heretic = no }
			}
			FROM = {
				religion_authority = {
					modifier = lost_crusade
					years = 20
				}
			}
		}
		#maintenance - shatter FROM empire if it's become too small (NYR)
		hidden_tooltip = { FROM = { character_event = { id = realmPlus.100 } } }
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		hidden_tooltip = {
			if = {
				limit = {
					ROOT = {
						OR = {
							religion = chalcedonian
							religion = catholic
							religion = cathar
							religion = fraticelli
							religion = waldensian
							religion = lollard
							religion = adoptionist
						}
						is_heretic = no
					}
				}
				set_global_flag = catholic_crusade_failed
			}
			if = {
				limit = {
					ROOT = {
						OR = {
							religion = catholic
							religion = cathar
							religion = fraticelli
							religion = waldensian
							religion = lollard
							religion = adoptionist
						}
						is_heretic = no
					}
					has_global_flag = fourth_crusade_ongoing
				}
				clr_global_flag = fourth_crusade_ongoing
			}
		}
		ROOT = {
			show_scope_change = no
			prestige = -200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 100
			participation_scaled_piety = 200
			dynasty_head = {
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -50
				}
			}
			pf_tradition_minus4_effect = yes
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				participation_scaled_piety = 200
				dynasty_head = {
					if = {
						limit = {
							uses_decadence = yes
						}
						participation_scaled_decadence = -50
					}
				}
			}
			pf_tradition_minus2_effect = yes
		}
	}

	on_reverse_demand = {
		#change imperial decadence
		FROM = { imperial_decadence_minus_2_effect = yes }
		ROOT = { imperial_decadence_plus_2_effect = yes }

		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			pf_tradition_plus4_effect = yes
		}
		hidden_tooltip = {
			if = {
				limit = {
					ROOT = {
						OR = {
							religion = chalcedonian
							religion = catholic
							religion = cathar
							religion = fraticelli
							religion = waldensian
							religion = lollard
							religion = adoptionist
						}
						is_heretic = no
					}
				}
				set_global_flag = catholic_crusade_failed
			}
			if = {
				limit = {
					ROOT = {
						OR = {
							religion = catholic
							religion = cathar
							religion = fraticelli
							religion = waldensian
							religion = lollard
							religion = adoptionist
						}
						is_heretic = no
					}
					has_global_flag = fourth_crusade_ongoing
				}
				clr_global_flag = fourth_crusade_ongoing
			}
		}
		ROOT = {
			prestige = -500
			pf_glory_minus2_effect = yes
			pf_tradition_minus4_effect = yes
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			participation_scaled_prestige = 1000
			participation_scaled_piety = 500
			dynasty_head = {
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -100
				}
			}
			hidden_tooltip = {
				if = {
					limit = {
						OR = {
							this_has_lame_nickname_trigger = yes
							has_nickname = no
						}
					}
					hidden_effect = {
						random_list = {
							10 = { give_nickname = nick_the_holy }
							10 = { give_nickname = nick_the_glorious }
							10 = { give_nickname = nick_the_lionheart }
							10 = { give_nickname = nick_the_great }
							10 = { give_nickname = nick_the_hammer }
							20 = {
								modifier = {
									factor = 0
									religion_group = christian
								}
								give_nickname = nick_the_sword_of_god
							}
						}
					}
				}
			}
		}
		hidden_tooltip = {
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				prestige = -250
			}
			any_defender = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = {
					pf_glory_plus2_effect = yes
					pf_tradition_plus4_effect = yes
					participation_scaled_prestige = 1000
					participation_scaled_piety = 500
					dynasty_head = {
						if = {
							limit = {
								uses_decadence = yes
							}
							participation_scaled_decadence = -100
						}
					}
				}
			}
			any_attacker = {
				limit = {
					character = ROOT
					uses_decadence = yes
				}
				participation_scaled_decadence = 35
			}
			any_attacker = {
				limit = {
					NOT = { character = ROOT }
					uses_decadence = yes
				}
				hidden_tooltip = {
					participation_scaled_decadence = 35
				}
			}
		}
		if = {
			limit = {
				FROM = { is_heretic = no }
			}
			FROM = {
				religion_authority = {
					modifier = won_crusade
					years = 20
				}
			}
		}
		if = {
			limit = {
				ROOT = { is_heretic = no }
			}
			ROOT = {
				religion_authority = {
					modifier = lost_crusade
					years = 20
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 0.1
			ROOT = {
				religion_group = muslim
				NOT = { religion = kharijite }
			}
			FROM = { religion = ibadi }
		}
		modifier = {
			factor = 0.1
			FROM = {
				religion_group = muslim
				NOT = { religion = kharijite }
			}
			ROOT = { religion = ibadi }
		}
		modifier = {
			factor = 0
			ROOT = {
				religion = ibadi
				NOT = { trait = zealous }
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 13
new_crusade = {
	name = CB_NAME_CRUSADE
	war_name = WAR_NAME_CRUSADE
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	battle_warscore_mult = 0.5
	max_defender_occupation_score = 85
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	is_crusade = yes
	allow_whitepeace = no

	allowed_to_target_tributaries = no
	can_ask_to_join_war = no # People join via script instead

	sort_priority = 3000

	can_use_gui = {
		has_game_started = yes
		has_global_flag = plus_rules_applied
		OR = {
			AND = {
				NOT = { has_global_flag = delayed_crusades_1 }
				NOT = { has_global_flag = delayed_crusades_2 }
				NOT = { has_global_flag = delayed_crusades_3 }
				NOT = { has_global_flag = delayed_crusades_4 }
				NOT = { has_global_flag = delayed_crusades_5 }
			}
			had_global_flag = { flag = delayed_crusades_1 days = 365 }
			had_global_flag = { flag = delayed_crusades_2 days = 1095 }
			had_global_flag = { flag = delayed_crusades_3 days = 1825 }
			had_global_flag = { flag = delayed_crusades_4 days = 3650 }
			had_global_flag = { flag = delayed_crusades_5 days = 7300 }
		}
		FROM = { NOT = { has_character_modifier = crusade_block_timer } }
		ROOT = { # The Religious Head
			uses_new_crusade = yes
			has_called_crusade = no
			has_secret_religion = no
			religion_authority = 0.4
			NOT = {
				has_character_modifier = crusade_timer
				AND = {
					trait = bad_priest_christian
					NOT = { has_global_flag = fourth_crusade_happened }
				}
			}
			conditional_tooltip = {
				trigger = {
					is_alternate_start = yes
					has_alternate_start_parameter = {
						key = religion_names
						value = random
					}
				}
				custom_tooltip = {
					text = ALT_GHW_STARTED
					has_global_flag = muslim_jihads_unlocked
					has_global_flag = pagan_ghws_unlocked
					has_global_flag = christian_crusades_unlocked
				}
			}
			conditional_tooltip = {
				trigger = {
					NOT = {
						has_alternate_start_parameter = {
							key = religion_names
							value = random
						}
					}
				}
				religion_group = christian
				custom_tooltip = {
					text = CTT_CHRISTIAN_CRUSADES_UNLOCKED
					has_global_flag = christian_crusades_unlocked
				}
			}
			mercenary = no
		}
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			uses_new_crusade = yes
			can_call_crusade = yes
			hidden_tooltip = {
				NOT = { has_character_modifier = cancel_crusade_cooldown }
			}
			any_demesne_title = { NOT = { controls_religion = yes } }
			OR = {
				NOT = { religion = cathar }
				has_global_flag = cathar_war
			}
		}

		FROM = {
			NOT = { religion = ROOT}
			OR = {
				NOT = { religion_group = ROOT }
				is_heresy_of = ROOT
				is_parent_religion = ROOT
				AND = {
					is_pagan_religion = yes
					NOT = { religion = ROOT }
				}
				AND = {
					ROOT = { religion = paulician }
					NOT = { religion = ROOT }
				}
				AND = {
					has_character_flag = fourth_crusade_target
					NOR = {
						has_character_flag = fourth_crusade_recipient
						religion = ROOT
					}
				}
				AND = {
					has_global_flag = 4th_crusade_official
					has_landed_title = e_byzantium
					NOT = { religion = ROOT }
				}
			}
		}
	}

	can_use_title = {
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}

			independent = yes
			in_revolt = no # Don't declare Crusades on revolters - chances are high the war will invalidate

			OR = {
				num_of_realm_counties = {
					value = 6
					title = PREV
				}
				PREV = {
					title = k_thrace
					FROM = {
						has_landed_title = e_byzantium
						religion_group = christian
					}
				}
			}
			#target needs to either hold the target title,
			#be the title's overlord,
			#or the title needs to have no holder/holder of ROOT's religious group
			OR = {
				has_landed_title = PREV
				any_vassal = { has_landed_title = PREVPREV }
				PREV = { has_holder = no }
				PREV = { holder_scope = { religion = ROOT } }
			}
		}

		OR = {
			# the target owns a holy site within that kingdom title
			FROM = {
				any_realm_title = {
					de_jure_liege_or_above = PREVPREV
					is_holy_site = ROOT
				}
			}
			# the target owns a province of the religion within that kingdom title
			FROM = {
				any_realm_title = {
					tier = COUNT
					de_jure_liege_or_above = PREVPREV
					location = { religion = ROOT }
				}
			}
			# a ruler of the religion either owns a province in that kingdom or is neighboring
			any_direct_de_jure_vassal_title = {
				any_direct_de_jure_vassal_title = {
					location = {
						OR = {
							owner = { religion = ROOT }
							any_neighbor_province = { owner = { religion = ROOT } }
						}
					}
				}
			}
		}
	}


	is_valid = {
		ROOT = {
			can_call_crusade = yes
		}
		FROM = {
			NOT = { religion = ROOT}
			OR = {
				NOT = { religion_group = ROOT }
				is_heresy_of = ROOT
				is_parent_religion = ROOT
				AND = {
					is_pagan_religion = yes
					NOT = { religion = ROOT }
				}
				AND = {
					ROOT = { religion = paulician }
					NOT = { religion = ROOT }
				}
				AND = {
					has_character_flag = fourth_crusade_target
					NOR = {
						has_character_flag = fourth_crusade_recipient
						religion = ROOT
					}
				}
				AND = {
					has_global_flag = 4th_crusade_official
					has_landed_title = e_byzantium
					NOT = { religion = ROOT }
				}
			}
		}
	}

	is_valid_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		ROOT = {
			add_character_modifier = {
				name = "crusade_timer"
				duration = 14600
				hidden = no
				inherit = yes
			}
		}
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}
	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their Holy Fury crusade for the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"

		#set event targets
		ROOT = {
			crusade_target_title = {
				save_event_target_as = new_crusade_title
			}
		}

		ROOT = {
			official_crusade_recipient = {
				save_event_target_as = new_crusade_recipient
			}
		}

		most_participating_crusader = {
			save_event_target_as = new_crusade_most_participating_member
		}

		ROOT = {
			crusade_target_char = {
				save_event_target_as = new_crusade_target_char
			}
		}

		custom_tooltip = {
			text = new_crusade_win_TT
		}

		#change imperial decadence
		ROOT = { imperial_decadence_minus_2_effect = yes }
		FROM = { imperial_decadence_plus_2_effect = yes }

		hidden_tooltip = {
			any_attacker = {
				add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			}
			ROOT = {
				if = {
					limit = {
						OR = {
							religion = catholic
							religion = cathar
							religion = fraticelli
							religion = waldensian
							religion = lollard
							religion = adoptionist
						}
						is_heretic = no
						OR = {
							has_global_flag = catholic_crusade_failed
							has_global_flag = fourth_crusade_ongoing
						}
					}
					clr_global_flag = catholic_crusade_failed
					clr_global_flag = fourth_crusade_ongoing
				}
			}
			if = {
				limit = {
					ai = yes
					NOT = {
						crusade_beneficiary = {
							always = yes
						}
					}
				}
				character_event = { id = HFP.41007 }
			}
		}

		# Is the Official Crusade Recipient available/suitable to receive the seized lands?
		if = {
			limit = {
				most_participating_crusader = {
					NOT = {
						has_character_flag = crusade_selfish_stance
						has_character_flag = crusade_beneficiary_stance
					}
					official_crusade_recipient = {
						is_alive = yes
						religion = ROOT
					}
				}
			}
			most_participating_crusader = {
				official_crusade_recipient = {
					set_crusader_king = this
				}
			}
		}

		# If not, select the main contributor of the Crusade or his/her Beneficiary if they are suitable
		else_if = {
			limit = {
				most_participating_crusader = {
					holy_order = no
					mercenary = no
					NOR = {
						has_landed_title = k_papal_state
						has_landed_title = d_fraticelli
					}
					OR = {
						AND = {
							ai = yes
							crusade_beneficiary = {
								is_alive = yes
							}
						}
						ai = no
					}
				}
			}
			most_participating_crusader = {
				# Give the title to your Beneficiary
				if = {
					limit = {
						crusade_beneficiary = {
							is_alive = yes
							is_landed = no
							NOT = {
								any_heir_title = {
									always = yes
								}
							}
							mercenary = no
							holy_order = no
						}
						NOT = {
							has_character_flag = crusade_selfish_stance
						}
					}
					crusade_beneficiary = {
						set_crusader_king = THIS
						set_character_flag = crusader_king_flag
					}
				}
				# Find an appropriate replacement Beneficiary if there is none selected, or the currently selected one is improper in one way or another
				else_if = {
					limit = {
						ai = yes
						any_dynasty_member = {
							age = 16
							NOT = {
								any_heir_title = {
									always = yes
								}
							}
							is_landed = no
							mercenary = no
							holy_order = no
							religion = PREV
						}
						NOT = {
							has_character_flag = crusade_selfish_stance
						}
					}
					random_dynasty_member = {
						limit = {
							age = 16
							NOT = {
								any_heir_title = {
									always = yes
								}
							}
							is_landed = no
							mercenary = no
							holy_order = no
							religion = PREV
						}
						preferred_limit = {
							is_child_of = PREV
							culture = PREV
							NOT = {
								age = 45
							}
							preferred_gender_based_on_laws_trigger = yes
						}
						preferred_limit = {
							is_child_of = PREV
							NOT = {
								age = 45
							}
							preferred_gender_based_on_laws_trigger = yes
						}
						preferred_limit = {
							is_child_of = PREV
							preferred_gender_based_on_laws_trigger = yes
						}
						preferred_limit = {
							is_liege_or_above = PREV
							culture = PREV
							NOT = {
								age = 45
							}
							preferred_gender_based_on_laws_trigger = yes
						}
						preferred_limit = {
							is_liege_or_above = PREV
							NOT = {
								age = 45
							}
							preferred_gender_based_on_laws_trigger = yes
						}
						preferred_limit = {
							is_liege_or_above = PREV
							preferred_gender_based_on_laws_trigger = yes
						}
						preferred_limit = {
							is_child_of = PREV
							culture = PREV
							NOT = {
								age = 45
							}
						}
						preferred_limit = {
							is_child_of = PREV
							NOT = {
								age = 45
							}
						}
						preferred_limit = {
							is_child_of = PREV
						}
						preferred_limit = {
							is_liege_or_above = PREV
							culture = PREV
							NOT = {
								age = 45
							}
						}
						preferred_limit = {
							is_liege_or_above = PREV
							NOT = {
								age = 45
							}
						}
						preferred_limit = {
							is_liege_or_above = PREV
						}
						preferred_limit = {
							culture = PREV
							NOT = {
								age = 45
							}
						}
						preferred_limit = {
							NOT = {
								age = 45
							}
						}
						preferred_limit = {
							culture = PREV
						}
						set_crusader_king = THIS
						set_character_flag = crusader_king_flag
					}
				}
				# Take the titles yourself
				else = {
					if = {
						limit = {
							any_owned_bloodline = {
								has_bloodline_flag = grand_crusader_bloodline
								bloodline_is_active_for = PREV
							}
						}
						set_crusade_pot_multiplier = 0.2
					}
					else = {
						set_crusade_pot_multiplier = 0
					}
					set_crusader_king = THIS
					set_character_flag = crusader_king_flag
				}
			}
		}

		# If not, find someone else to take the title
		else = {
			# Find a random Beneficiary within certain limits
			if = {
				limit = {
					most_participating_crusader = {
						any_crusade_participant = {
							is_alive = yes
							is_landed = yes
							holy_order = no
							mercenary = no
							crusade_beneficiary = {
								is_alive = yes
								is_landed = no
								holy_order = no
								NOT = {
									any_heir_title = {
										always = yes
									}
								}
								age = 12
							}
						}
					}
				}
				most_participating_crusader = {
					random_crusade_participant = {
						limit = {
							is_alive = yes
							is_landed = yes
							holy_order = no
							mercenary = no
							crusade_beneficiary = {
								is_alive = yes
								is_landed = no
								holy_order = no
								NOT = {
									any_heir_title = {
										always = yes
									}
								}
								age = 12
							}
						}
						preferred_limit = {
							tier = EMPEROR
						}
						preferred_limit = {
							tier = KING
						}
						crusade_beneficiary = {
							set_crusader_king = THIS
							set_character_flag = crusader_king_flag
						}
					}
				}
			}
			# Find any random Beneficiary, if possible
			else_if = {
				limit = {
					most_participating_crusader = {
						any_crusade_participant = {
							crusade_beneficiary = {
								is_alive = yes
								is_landed = no
								holy_order = no
								NOT = {
									any_heir_title = {
										always = yes
									}
								}
							}
						}
					}
				}
				most_participating_crusader = {
					random_crusade_participant = {
						limit = {
							crusade_beneficiary = {
								is_alive = yes
								is_landed = no
								holy_order = no
								NOT = {
									any_heir_title = {
										always = yes
									}
								}
							}
						}
						crusade_beneficiary = {
							set_crusader_king = THIS
							set_character_flag = crusader_king_flag
						}
					}
				}
			}
			# Find a logical "Beneficiary" from any playable Catholic/Fraticelli ruler, if all else fails
			else = {
				most_participating_crusader = {
					# Try to find a Catholic/Fraticelli ruler
					if = {
						limit = {
							any_playable_ruler = {
								religion = PREV
								any_dynasty_member = {
									is_alive = yes
									is_dying = no
									mercenary = no
									holy_order = no
									age = 12
									NOT = {
										any_heir_title = {
											always = yes
										}
									}
								}
							}
						}
						random_playable_ruler = {
							limit = {
								religion = PREV
								any_dynasty_member = {
									is_alive = yes
									is_dying = no
									mercenary = no
									holy_order = no
									age = 12
									NOT = {
										any_heir_title = {
											always = yes
										}
									}
								}
							}
							preferred_limit = {
								tier = EMPEROR
								culture = PREV
							}
							preferred_limit = {
								tier = EMPEROR
							}
							preferred_limit = {
								tier = KING
								culture = PREV
							}
							preferred_limit = {
								tier = KING
							}
							preferred_limit = {
								tier = DUKE
								culture = PREV
							}
							preferred_limit = {
								tier = DUKE
							}
							preferred_limit = {
								culture = PREV
							}
							random_dynasty_member = {
								limit = {
									religion = PREV
									is_alive = yes
									is_dying = no
									mercenary = no
									holy_order = no
									age = 12
									NOT = {
										any_heir_title = {
											always = yes
										}
									}
								}
								set_crusader_king = THIS
							}
						}
					}
					# If every other option fails, make the Holy Order Grandmaster the Crusader King
					else = {
						set_crusader_king = THIS
					}
				}
			}
		}

		#Distribution prep:
		# Find a backup beneficiary for the other Crusaders, if they don't have one already selected
		any_attacker = {
			limit = {
				NOT = {
					most_participating_crusader = {
						character = PREV
					}
				}
				ai = yes
				OR = {
					crusade_beneficiary = {
						OR = {
							is_alive = no
							is_landed = yes
							NOT = {
								any_heir_title = {
									always = yes
								}
							}
							mercenary = yes
							holy_order = yes
						}
					}
					NOT = {
						crusade_beneficiary = {
							always = yes
						}
					}
				}
			}
			save_event_target_as = crusade_attacker
			character_event = { id = HFP.41007 }
		}

		# Make sure selfish Crusaders get as little as possible (reduce the pot for Selfish Crusaders)
		any_attacker = {
			limit = {
				has_character_flag = crusade_selfish_stance
			}
			set_crusade_pot_multiplier = 0
		}

		# Distribute the Pot and Titles
		ROOT = {
			set_global_flag = distributing_crusade
			any_crusade_participant = {
				limit = {
					ai = no
					most_participating_crusader = {
						NOT = {
							character = PREV
						}
					}
				}
				character_event = { id = HFP.41060 }
			}
			distribute_crusade_pot = {
				amount = 1
			}
			any_crusade_participant = {
				crusade_beneficiary = {
					add_character_modifier = { name = new_land_timer duration = 1 hidden = yes }
					set_character_flag = beneficiary_who_received_titles
				}
			}
			# If the winner is a selfish Nomad
			if = {
				limit = {
					most_participating_crusader = {
						is_nomadic = yes
						OR = {
							has_character_flag = crusade_selfish_stance
							crusader_king = {
								character = PREV
							}
						}
					}
				}
				most_participating_crusader = {
					add_character_modifier = { name = new_land_timer duration = 1 hidden = yes }
					gain_settlements_under_title = {
						title = PREVPREV
						enemy = FROM
						type = holy_war
					}
				}
				any_playable_ruler = {
					narrative_event = { id = HFP.41160 }
				}
			}
			# If it is a Fourth Crusade
			else_if = {
				limit = {
					has_global_flag = 4th_crusade_official
					crusade_target_title = {
						title = k_byzantium
					}
					FROM = {
						religion_group = ROOT
					}
					FROM = {
						NOT = {
							religion = ROOT
						}
					}
					crusade_target_char = {
						e_byzantium = {
							owner = {
								character = PREVPREV
							}
						}
					}
				}
				#SLIGHTLY less railroading here please and thank you (removed Cyprus and Trebizond changes from vanilla)
				PREV = { #scope to the target title, prep for distribution
					hidden_tooltip = { destroy_tradeposts_effect = yes }
					pf_liege_change_under_title_begin_effect = yes
				}
				#Actually distribute the titles
				distribute_crusade_target_title = yes
				#The Crusader King becomes an Emperor and gets a bloodline
				crusader_king = {
					grant_title_no_opinion = e_latin_empire
				}
				e_latin_empire = {
					copy_title_laws = PREVPREV
					add_law = crown_authority_3
				}
				# Find random Byzantine duke and make a king out of them
				e_byzantium = {
					owner = {
						random_vassal = {
							limit = {
								tier = DUKE
								ai = yes
							}
							preferred_limit = {
								de_jure_liege = k_byzantium
							}
							preferred_limit = {
								de_jure_liege = k_nikaea
							}
							preferred_limit = {
								de_jure_liege = k_sicily
							}
							primary_title = {
								create_title = {
									tier = KING
									landless = no
									temporary = no
									name = "fourth_crusade_greek_kingdom_name"
									holder = PREV
									culture = PREV
									custom_created = yes
									base_title = THIS
									copy_title_laws = yes
								}
							}
						}
					}
				}
				# All Byzantine vassals go independent except those neighboring the old Emperor, and he/she gets an inferior Empire title while the Byzantine title is broken
				e_byzantium = {
					owner = {
						any_vassal = {
							limit = {
								higher_tier_than = BARON
							}
							set_defacto_liege = this
						}
						if = {
							limit = {
								primary_title = {
									title = e_byzantium
								}
							}
							capital_scope = {
								create_title = {
									tier = EMPEROR
									landless = no
									temporary = no
									name = "fourth_crusade_greek_empire_name"
									holder = PREV
									culture = PREV
									custom_created = yes
									base_title = THIS
								}
							}
							any_demesne_title = {
								limit = {
									tier = EMPEROR
									is_titular = no
								}
								destroy_landed_title = THIS
							}
						}
						any_neighbor_independent_ruler = {
							limit = {
								ai = yes
								culture = PREV
								religion = PREV
								lower_tier_than = KING
							}
							set_defacto_liege = PREV
						}
					}
				}
				# Crete is taken by a Merchant Lord
				if = {
					limit = {
						c_kaneia = {
							owner = {
								ai = yes
							}
						}
						c_chandax = {
							owner = {
								ai = yes
							}
						}
						any_crusade_participant = {
							is_patrician = yes
							higher_tier_than = COUNT
						}
					}
					random_crusade_participant = {
						limit = {
							is_patrician = yes
							higher_tier_than = COUNT
						}
						preferred_limit = {
							has_landed_title = k_venice
						}
						preferred_limit = {
							has_landed_title = d_venice
						}
						preferred_limit = {
							tier = EMPEROR
						}
						preferred_limit = {
							tier = KING
						}
						grant_title_no_opinion = d_krete
						grant_title_no_opinion = c_kaneia
						grant_title_no_opinion = c_chandax
					}
				}

				if = {
					limit = {
						official_crusade_recipient = {
							has_character_flag = fourth_crusade_recipient
						}
					}
					official_crusade_recipient = {
						save_event_target_as = byzantine_refugee
					}
				}
				# Narrative event explaining that Byzantium has been taken out
				any_character = {
					narrative_event = { id = HF.49008 }
				}
				event_target:byzantine_refugee = {
					death = {
						death_reason = death_battle
						killer = FROM
					}
				}
				# Making sure the Byzantine Empire is destroyed
				e_byzantium = {
					unsafe_destroy_landed_title = THIS
				}
			}
			# Otherwise
			else = {
				FROM = {
					any_realm_character = {
						limit = {
							religion = ROOT
							ai = no
							higher_tier_than = BARON
						}
						set_defacto_liege = THIS
					}
				}
				PREV = { #scope to the target title, prep for distribution
					hidden_tooltip = { destroy_tradeposts_effect = yes }
					pf_liege_change_under_title_begin_effect = yes
				}
				distribute_crusade_target_title = yes
				crusader_king = {
					save_event_target_as = crusade_king_recipient
				}
				any_playable_ruler = {
					narrative_event = { id = HFP.41160 }
				}
			}
			crusader_king = {
				if = {
					limit = {
						has_character_flag = beneficiary_who_received_titles
						NOT = { has_dynasty_modifier = ruling_in_crusader_kingdom }
					}
					add_dynasty_modifier = ruling_in_crusader_kingdom
				}
				any_realm_character = {
					limit = {
						has_character_flag = beneficiary_who_received_titles
						NOT = { has_dynasty_modifier = ruling_in_crusader_kingdom }
					}
					add_dynasty_modifier = ruling_in_crusader_kingdom
				}
			}
			clr_global_flag = distributing_crusade
		}

		pf_liege_change_under_title_end_effect = yes

		# If the CK has too much gold
		crusader_king = {
			if = {
				limit = {
					wealth = 2000
					ai = yes
					any_vassal = {
						always = yes
					}
				}
				set_variable = { which = count value = 20 }
				while = {
					limit = {
						AND = {
							wealth = 2000
							check_variable = { which = count value = 1 }
						}
					}
					random_vassal = {
						limit = {
							NOT = {
								wealth = 1000
							}
						}
						wealth = 350
						crusader_king = {
							wealth = -350
						}
					}
					subtract_variable = { which = count value = 1 }
				}
			}
		}

		ROOT = {
			show_scope_change = no
			participation_scaled_piety = 1000
			participation_scaled_prestige = 500
			dynasty_head = {
				if = {
					limit = { uses_decadence = yes }
					participation_scaled_decadence = -100
				}
			}
			#faction mood boost
			pf_tradition_plus4_effect = yes
			pf_glory_plus2_effect = yes
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_piety = 1000
				participation_scaled_prestige = 500
				dynasty_head = {
					if = {
						limit = { uses_decadence = yes }
						participation_scaled_decadence = -100
					}
				}
				pf_tradition_plus4_effect = yes
				pf_glory_plus2_effect = yes
			}
		}

		FROM = {
			prestige = -500
			pf_glory_minus2_effect = yes
			pf_tradition_minus4_effect = yes
		}
		hidden_tooltip = {
			any_defender = {
				limit = { NOT = { character = FROM } }
				prestige = -250
			}
		}
		if = {
			limit = {
				ROOT = { is_heretic = no }
			}
			ROOT = {
				religion_authority = {
					modifier = won_crusade
					years = 20
				}
			}
		}
		if = {
			limit = {
				FROM = { is_heretic = no }
			}
			FROM = {
				religion_authority = {
					modifier = lost_crusade
					years = 20
				}
			}
		}

		# Nickname for the most participating Crusader
		most_participating_crusader = {
			if = {
				limit = {
					can_apply_average_nickname_trigger = yes
				}
				random_list = {
					10 = { give_nickname = nick_the_crusader }
					10 = { give_nickname = nick_the_glorious }
					10 = { give_nickname = nick_the_lionheart }
					10 = { give_nickname = nick_the_great }
					10 = { give_nickname = nick_the_hammer }
					40 = { give_nickname = nick_the_sword_of_god }
				}
			}
		}

		# Nickname and effects for the new Crusader King, if it is a Beneficiary or the Official Crusade Recipient (not for Selfish Crusaders)
		crusader_king = {
			hidden_tooltip = {
				if = {
					limit = {
						OR = {
							most_participating_crusader = {
								NOT = {
									character = PREV
								}
							}
							ROOT = {
								official_crusade_recipient = {
									character = PREV
								}
							}
						}
					}
					opinion = {
						who = most_participating_crusader
						modifier = opinion_granted_crusader_kingdom
						years = 15
					}
					crusader_king = {
						setting_up_the_crusader_kingdom_effect = yes
						create_crusader_king_crown_effect = yes
					}
				}
			}
		}

		crusader_king = {
			save_event_target_as = new_crusader_king
			if = {
				limit = { NOT = { culture = PREV } }
				hidden_tooltip = {
					PREV = { conquest_culture = event_target:new_crusader_king }
				}
			}
		}

		# If the player is the most participating Crusader, and gave away the Kingdom to a Beneficiary, trigger event to let them start playing as Beneficiary
		if = {
			limit = {
				most_participating_crusader = {
					ai = no
					NOT = {
						character = event_target:new_crusader_king
					}
					event_target:new_crusader_king = {
						dynasty = PREV
					}
				}
			}
			most_participating_crusader = {
				narrative_event = { id = HFP.41054 days = 3 }
			}
		}

		# Check most participating Crusader if they are potential Crusader material
		most_participating_crusader = {
			if = {
				limit = {
					NOR = {
						has_character_flag = grandCrusader
						trait = crusader_king
					}
				}
				set_character_flag = grandCrusader
			}
			else_if = {
				limit = {
					OR = {
						has_character_flag = grandCrusader
						trait = crusader_king
					}
				}
				narrative_event = { id = HF.49020 }
			}
		}

		# Release the CK if they are in jail
		crusader_king = {
			imprison = no
		}

		# Special bloodline for the recipient of the first Crusade
		if = {
			limit = {
				NOT = {
					has_global_flag = first_crusade_complete
				}
				most_participating_crusader = {
					NOT = {
						crusader_king = {
							character = PREV
						}
					}
				}
			}
			if = {
				limit = {
					has_dlc = "Holy Fury"
				}
				if = {
					limit = {
						crusader_king = {
							is_female = yes
						}
					}
					crusader_king = {
						create_bloodline = {
							type = crusade_lord
							religion = THIS
							inheritance = matrilineal
						}
						set_bloodline_founder_religion_flag_effect = yes
					}
				}
				else = {
					crusader_king = {
						create_bloodline = {
							type = crusade_lord
							religion = THIS
							inheritance = patrilineal
						}
						set_bloodline_founder_religion_flag_effect = yes
					}
				}
			}
		}

		# Checks if First Crusade
		if = {
			limit = {
				NOT = {
					has_global_flag = first_crusade_complete
				}
			}
			set_global_flag = first_crusade_complete
		}

		# Adds a negative opinion modifier for selfish Crusaders
		any_crusade_participant = {
			limit = {
				OR = {
					has_character_flag = crusade_selfish_stance
					most_participating_crusader = {
						crusader_king = {
							character = PREV
							character = PREVPREV
						}
					}
				}
			}
			if = {
				limit = {
					NOT = {
						ROOT = {
							has_opinion_modifier = {
								who = PREVPREV
								modifier = opinion_selfish_crusader
							}
						}
					}
				}
				ROOT = {
					opinion = {
						who = PREVPREV
						modifier = opinion_selfish_crusader
						years = 20
					}
				}
			}
		}

		ROOT = {
			character_event = { id = HFP.41199 }
		}

		#maintenance - shatter FROM empire if it's become too small (NYR)
		hidden_tooltip = { FROM = { character_event = { id = realmPlus.100 } } }
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		#this shouldn't even be possible? But whatever I'll leave it in anyway
		hidden_tooltip = {
			if = {
				limit = {
					ROOT = {
						OR = {
							religion = chalcedonian
							religion = catholic
							religion = cathar
							religion = fraticelli
							religion = waldensian
							religion = lollard
							religion = adoptionist
						}
						is_heretic = no
					}
				}
				set_global_flag = catholic_crusade_failed
			}
			if = {
				limit = {
					ROOT = {
						OR = {
							religion = catholic
							religion = cathar
							religion = fraticelli
							religion = waldensian
							religion = lollard
							religion = adoptionist
						}
						is_heretic = no
					}
					has_global_flag = fourth_crusade_ongoing
				}
				clr_global_flag = fourth_crusade_ongoing
			}
		}
		ROOT = {
			show_scope_change = no
			prestige = -200
			piety = -100
			character_event = { id = HFP.41199}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 100
			participation_scaled_piety = 200
			dynasty_head = {
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -50
				}
			}
			pf_tradition_minus4_effect = yes
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				participation_scaled_piety = 200
				dynasty_head = {
					if = {
						limit = {
							uses_decadence = yes
						}
						participation_scaled_decadence = -50
					}
				}
			}
			pf_tradition_minus2_effect = yes
		}
	}

	on_reverse_demand = {
		ROOT = {
			character_event = { id = HFP.41199 }
		}
		#change imperial decadence
		FROM = { imperial_decadence_minus_2_effect = yes }
		ROOT = { imperial_decadence_plus_2_effect = yes }

		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			pf_tradition_plus4_effect = yes
		}
		hidden_tooltip = {
			if = {
				limit = {
					ROOT = {
						OR = {
							religion = chalcedonian
							religion = catholic
							religion = cathar
							religion = fraticelli
							religion = waldensian
							religion = lollard
							religion = adoptionist
						}
						is_heretic = no
					}
				}
				set_global_flag = catholic_crusade_failed
			}
			if = {
				limit = {
					ROOT = {
						OR = {
							religion = catholic
							religion = cathar
							religion = fraticelli
							religion = waldensian
							religion = lollard
							religion = adoptionist
						}
						is_heretic = no
					}
					has_global_flag = fourth_crusade_ongoing
				}
				clr_global_flag = fourth_crusade_ongoing
			}
		}
		ROOT = {
			prestige = -500
			pf_glory_minus2_effect = yes
			pf_tradition_minus4_effect = yes
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			participation_scaled_prestige = 1000
			participation_scaled_piety = 500
			dynasty_head = {
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -100
				}
			}
			hidden_tooltip = {
				if = {
					limit = {
						OR = {
							this_has_lame_nickname_trigger = yes
							has_nickname = no
						}
					}
					hidden_effect = {
						random_list = {
							10 = { give_nickname = nick_the_holy }
							10 = { give_nickname = nick_the_glorious }
							10 = { give_nickname = nick_the_lionheart }
							10 = { give_nickname = nick_the_great }
							10 = { give_nickname = nick_the_hammer }
							20 = {
								modifier = {
									factor = 0
									religion_group = christian
								}
								give_nickname = nick_the_sword_of_god
							}
						}
					}
				}
			}
		}
		hidden_tooltip = {
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				prestige = -250
			}
			any_defender = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = {
					pf_glory_plus2_effect = yes
					pf_tradition_plus4_effect = yes
					participation_scaled_prestige = 1000
					participation_scaled_piety = 500
					dynasty_head = {
						if = {
							limit = {
								uses_decadence = yes
							}
							participation_scaled_decadence = -100
						}
					}
				}
			}
			any_attacker = {
				limit = {
					character = ROOT
					uses_decadence = yes
				}
				participation_scaled_decadence = 35
			}
			any_attacker = {
				limit = {
					NOT = { character = ROOT }
					uses_decadence = yes
				}
				hidden_tooltip = {
					participation_scaled_decadence = 35
				}
			}
		}
		if = {
			limit = {
				FROM = { is_heretic = no }
			}
			FROM = {
				religion_authority = {
					modifier = won_crusade
					years = 20
				}
			}
		}
		if = {
			limit = {
				ROOT = { is_heretic = no }
			}
			ROOT = {
				religion_authority = {
					modifier = lost_crusade
					years = 20
				}
			}
		}
		# Checks if First Crusade
		if = {
			limit = {
				NOT = {
					has_global_flag = first_crusade_complete
				}
			}
			set_global_flag = first_crusade_complete
		}
		# Chance to start a Shepherd's Crusade
		random = {
			chance = 15
			if = {
				limit = {
					has_game_rule = {
						name = shepherds_crusade
						value = on
					}
					ROOT = {
						religion = catholic
					}
				}
				set_global_flag = catholic_shepherds_crusade
			}
			else_if = {
				limit = {
					has_game_rule = {
						name = shepherds_crusade
						value = on
					}
					ROOT = {
						religion = fraticelli
					}
				}
				set_global_flag = fraticelli_shepherds_crusade
			}
			ROOT = {
				character_event = { id = HFP.42300 days = 3}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 14 Disabled
religious = {
	name = CB_NAME_RELIGIOUS
	war_name = WAR_NAME_RELIGIOUS
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes

	allowed_to_target_tributaries = no

	sort_priority = 800

	can_use_gui = {
		ROOT = {
			OR = {
				NOT = { religion = buddhist }
				piety = 250
			}
		}
	}

	on_add = {
		ROOT = {
			show_scope_change = no
			if = {
				limit = {
					religion = buddhist
				}
				piety = -250
			}
		}
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	can_use = {
		always = no
		ROOT = {
			is_nomadic = no
			NOT = { religion_group = pagan_group }
			NOT = { pacifist = yes }
			NOT = { religion = taoist }
			NAND = {
				OR = {
					has_landed_title = k_teutonic_state
					has_landed_title = d_teutonic_order
				}
				has_global_flag = northern_crusades_active
			}
			NOR = {
				has_character_flag = currently_reconquering_iberia
				reconquista_check_trigger = yes
			}
			OR = {
				NOT = { religion = hindu }
				FROM = { NOT = { has_dharmic_religion_trigger = yes } }
				AND = {
					religion_group = FROM
					FROM = {
						has_character_modifier = known_satanist
					}
					NOT = {
						has_character_modifier = known_satanist
					}
				}
			}
			NOT = { same_realm = FROM }
			OR = {
				NOT = { religion_group = FROM }
				is_heresy_of = FROM
				is_parent_religion = FROM
				AND = {
					has_dharmic_religion_trigger = yes
					FROM = { religion = taoist }
				}
				AND = {
					religion_group = muslim
					NOT = { religion = FROM }
					FROM = {
						NOT = {
							any_current_enemy = {
								NOT = {
									religion_group = muslim
								}
							}
						}
					}
				}
				AND = {
					religion_group = FROM
					FROM = {
						has_character_modifier = known_satanist
					}
					NOT = {
						has_character_modifier = known_satanist
					}
				}
			}
			top_liege = {
				religion_group = ROOT
				OR = {
					NOT = { religion = FROM }
					AND = {
						religion = FROM
						FROM = {
							has_character_modifier = known_satanist
						}
						NOT = {
							has_character_modifier = known_satanist
						}
						ROOT = {
							NOT = {
								has_character_modifier = known_satanist
							}
						}
					}
				}
				OR = {
					religion = ROOT
					AND = {
						is_heretic = no
						ROOT = { is_heretic = no }
					}
				}
			}
			mercenary = no
		}
	}

	can_use_title = {
		# The attacker needs at least one county in the target kingdom, or a border, or be only two sea zones away from one of your counties
		any_direct_de_jure_vassal_title = {
			OR = {
				holder_scope = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
				location = {
					any_neighbor_province = {
						OR = {
							AND = {
								has_owner = yes
								owner = {
									OR = {
										character = ROOT
										is_liege_or_above = ROOT
									}
								}
							}
							AND = {
								is_land = no
								OR = {
									ROOT = { religion_group = muslim }
									FROM = { religion_group = muslim }
									AND = {
										ROOT = { religion_group = pagan_group }
										has_global_flag = pagan_ghws_unlocked
									}
									AND = {
										ROOT = { religion_group = christian }
										has_global_flag = christian_crusades_unlocked
									}
									AND = {
										ROOT = { religion_group = muslim }
										has_global_flag = muslim_jihads_unlocked
									}
								}
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													character = ROOT
													is_liege_or_above = ROOT
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												owner = {
													OR = {
														character = ROOT
														is_liege_or_above = ROOT
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			NOT = { religion_group = pagan_group }
			NOT = { pacifist = yes }
			NOT = { same_realm = FROM }
			OR = {
				NOT = { religion_group = FROM }
				is_heresy_of = FROM
				is_parent_religion = FROM
				AND = {
					has_dharmic_religion_trigger = yes
					FROM = { religion = taoist }
				}
				AND = {
					religion_group = FROM
					FROM = {
						has_character_modifier = known_satanist
					}
					ROOT = {
						NOT = {
							has_character_modifier = known_satanist
						}
					}
				}
				AND = {
					religion_group = muslim
					NOT = { religion = FROM }
				}
			}
			top_liege = {
				OR = {
					NOT = { religion = FROM }
					AND = {
						religion = FROM
						FROM = {
							has_character_modifier = known_satanist
						}
						NOT = {
							has_character_modifier = known_satanist
						}
						ROOT = {
							NOT = {
								has_character_modifier = known_satanist
							}
						}
					}
				}
			}
		}
	}

	on_success = {
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_piety = 100
				participation_scaled_prestige = 50
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
				hidden_tooltip = {
					if = {
						limit = {
							has_ambition = obj_strengthen_religion
						}
						change_variable = { which = strengthen_religion value = 1 }
					}
				}
			}
		}

		ROOT = {
			participation_scaled_piety = 100
			participation_scaled_prestige = 50
			if = {
				limit = {
					uses_decadence = yes
				}
				participation_scaled_decadence = -10
			}
			religion_authority = {
				modifier = won_holy_war
				years = 20
			}
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
		}
		FROM = {
			if = {
				limit = {
					NOT = {
						has_character_modifier = known_satanist
					}
				}
				religion_authority = {
					modifier = lost_holy_war
					years = 20
				}
			}
		}
		FROM = { show_scope_change = no piety = -100 }
		FROM = { show_scope_change = no prestige = -50 }
	}

	on_success_title = {
		if = { # Standard Holy War behaviour for Non-Muslims and Muslims fighting other Muslims
			show_scope_change = no
			limit = {
				OR = {
					ROOT = {
						NOT = {
							religion_group = muslim
						}
					}
					AND = {
						ROOT = {
							religion_group = muslim
						}
						FROM = {
							religion_group = muslim
						}
					}
				}
			}
			custom_tooltip = {
				text = religious_cb_succ_tip
				hidden_tooltip = {
					ROOT = {
						vassalize_or_take_under_title = {
							title = PREV
							enemy = FROM
							same_religion = yes # Only vassalize rulers of my religion
							is_religious = yes
							type = holy_war
						}
					}
				}
			}
		}
		if = { # Muslims fighting Non-Muslims preserve vassals
			show_scope_change = no
			limit = {
				ROOT = {
					religion_group = muslim
				}
				FROM = {
					NOT = {
						religion_group = muslim
					}
				}
			}
			custom_tooltip = {
				text = religious_cb_succ_muslim_tip
				hidden_tooltip = {
					ROOT = {
						vassalize_or_take_under_title = {
							title = PREV
							enemy = FROM
							is_religious = yes
							type = holy_war
						}
					}
				}
			}
		}

		hidden_tooltip = {
			check_war_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			piety = -50
			prestige = -100
		}
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			piety = -75
			prestige = -150
		}
		FROM = {
			participation_scaled_piety = 200
			participation_scaled_prestige = 100
			if = {
				limit = {
					uses_decadence = yes
				}
				participation_scaled_decadence = -10
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_piety = 200
				participation_scaled_prestige = 100
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
				hidden_tooltip = {
					if = {
						limit = {
							has_ambition = obj_strengthen_religion
						}
						change_variable = { which = strengthen_religion value = 1 }
					}
				}
			}
		}
		any_attacker = {
			limit = {
				character = ROOT
				uses_decadence = yes
				NOT = {
					any_liege = {
						dynasty = PREV
					}
				}
			}
			participation_scaled_decadence = 20
		}
		any_attacker = {
			limit = {
				NOT = { character = ROOT }
				uses_decadence = yes
				NOT = {
					any_liege = {
						dynasty = PREV
					}
				}
			}
			hidden_tooltip = {
				participation_scaled_decadence = 20
			}
		}
		ROOT = {
			religion_authority = {
				modifier = lost_holy_war
				years = 20
			}
		}
		FROM = {
			religion_authority = {
				modifier = won_holy_war
				years = 20
			}
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		modifier = { #Focus on Coronation first.
			factor = 0.1
			has_dlc = "Holy Fury"
			ROOT = {
				is_feudal = yes
				OR = {
					religion = catholic
					religion = fraticelli
				}
				NOR = {
					trait = crowned_by_priest
					trait = crowned_by_bishop
					trait = crowned_by_pope
					trait = crowned_by_myself
				}
			}
		}

		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_nomadic = no
				NOT = {
					is_tribal = yes
				}
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_tribal = yes
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = tribal
						}
					}
				}
			}
		}

		# Try to guide the Hordes in the right direction
		modifier = {
			factor = 0.1
			ROOT = {
				OR = {
					dynasty = 613 # Seljuks
					dynasty = 800 # Timurids
					primary_title = { title = e_il-khanate }
				}
			}
			OR = {
				empire = {
					NOT = {
						OR = {
							title = e_persia
							title = e_byzantium
							title = e_arabia
						}
					}
				}
				FROM = {
					primary_title = { title = e_golden_horde }
					NOT = { year = 1300 }
				}
			}
		}
		modifier = {
			factor = 0.1
			ROOT = {
				primary_title = { title = e_golden_horde }
			}
			OR = {
				empire = {
					OR = {
						title = e_persia
						title = e_byzantium
						title = e_arabia
					}
				}
				FROM = {
					primary_title = { title = e_il-khanate }
					NOT = { year = 1300 }
				}
			}
		}
		modifier = {
			factor = 2.0
			OR = {
				culture = persian
				culture = baloch
				culture = afghan
				culture = turkish
			}
			empire = {
				OR = {
					title = e_persia
					title = e_rajastan
				}
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 15
excommunicated_ruler = {
	name = CB_NAME_EXCOMMUNICATED_RULER
	war_name = WAR_NAME_EXCOMMUNICATED_RULER
	sprite = 11
	truce_days = 3650
	can_ask_to_join_war = yes
	is_permanent = yes
	apply_short_occ_mod = no

	allowed_to_target_tributaries = no

	sort_priority = 750

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			NOT = {
				is_liege_or_above = FROM
			}
		}
		FROM = {
			excommunicated_for = ROOT
		}
		FROM = {
			OR = {
				ai = no
				NOT = { trait = cynical }
			}
			OR = {
				ai = no
				trait = zealous
				piety = 250
				NOT = { opinion = { who = ROOT value = -50 } }
			}
		}
		ROOT = {
			NOT = { excommunicated_for = ROOT }
			mercenary = no
		}
	}

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	is_valid = {
		FROM = {
			custom_tooltip = {
				text = tooltip_is_excommunicated_for
				hidden_tooltip = {
					excommunicated_for = ROOT
				}
			}
		}
		OR = {
			ROOT = { has_character_flag = flag_excommunicated_for_coronation }
			ROOT = { NOT = { excommunicated_for = ROOT } }
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}
	on_invalidation = {
		# Coronation request locks cleared on invalidation or loss, to avoid locking the player in the middle of the negotiation forever.
		#FIXME: This shouldn't trigger while HF coronations are disabled so I'm leaving the code in as a hook - if we integrate the Papal Extortion stuff we'll need to redirect these to whatever event we use
		hidden_tooltip = {
			if = {
				limit = {
					ROOT = { has_character_flag = flag_excommunicated_for_coronation }
				}
				ROOT = {
					character_event = { id = HF.20220 } #Papal Coronation may proceed.
				}
			}
		}
	}

	on_success = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their excommunication war against [From.GetBestName] (ID: [From.GetID])"
		hidden_tooltip = {
			if = {
				limit = {
					ROOT = { has_character_flag = flag_excommunicated_for_coronation }
					}
				ROOT = {
					character_event = { id = HF.20220 } #Papal Coronation may proceed.
				}
			}
			any_attacker = {
				opinion = { modifier = overthrown_ruler who = FROM }
				reverse_opinion = { modifier = overthrew_me who = FROM }
			}
		}
		#possible independence for the defender's weakly held vassals
		if = {
			limit = {
				FROM = { independent = yes }
			}
			hidden_tooltip = {
				FROM = {
					any_vassal = {
						character_event = { id = Plus.430 days = 3 }
					}
				}
			}
		}

		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			pf_tradition_plus2_effect = yes
		}
		if = {
			limit = {
				FROM = {
					primary_title = {
						tier = BARON
					}
				}
			}
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 25
				participation_scaled_piety = 25
			}
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				hidden_tooltip = {
					participation_scaled_prestige = 25
					participation_scaled_piety = 25
				}
			}
		}
		if = {
			limit = {
				FROM = {
					primary_title = {
						tier = COUNT
					}
				}
			}
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 50
				participation_scaled_piety = 50
			}
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				hidden_tooltip = {
					participation_scaled_prestige = 50
					participation_scaled_piety = 50
				}
			}
		}
		if = {
			limit = {
				FROM = {
					primary_title = {
						tier = DUKE
					}
				}
			}
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 100
				participation_scaled_piety = 100
			}
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				hidden_tooltip = {
					participation_scaled_prestige = 100
					participation_scaled_piety = 100
				}
			}
		}
		if = {
			limit = {
				FROM = {
					primary_title = {
						tier = KING
					}
				}
			}
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 200
				participation_scaled_piety = 200
			}
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				hidden_tooltip = {
					participation_scaled_prestige = 200
					participation_scaled_piety = 200
				}
			}
		}
		if = {
			limit = {
				FROM = {
					primary_title = {
						tier = EMPEROR
					}
				}
			}
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 300
				participation_scaled_piety = 300
			}
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				hidden_tooltip = {
					participation_scaled_prestige = 300
					participation_scaled_piety = 300
				}
			}
		}

		FROM = {
			excommunicate = no
			prestige = -500
			rightful_religious_head_scope = {
				opinion = {
					who = PREV
					modifier = opinion_repented_sins
				}
			}
			any_demesne_title = {
				title_reduce_CA_effect = yes
				title_reduce_TO_effect = yes
			}
			#pass on dishonorable/tyrant traits to new ruler
			hidden_tooltip = { character_event = { id = Plus.306 } }
			abdicate = yes
		}
	}

	on_fail = {
		ROOT = {
			piety = -50
			prestige = -100
		}
		# Coronation request locks cleared on invalidation or loss, to avoid locking the player in the middle of the negotiation forever.
		hidden_tooltip = {
			ROOT = {
				clr_character_flag = flag_excommunicated_for_coronation
			}
		}
	}

	on_reverse_demand = {
		# Coronation request locks cleared on invalidation or loss, to avoid locking the player in the middle of the negotiation forever.
		hidden_tooltip = {
			ROOT = {
				clr_character_flag = flag_excommunicated_for_coronation
			}
		}
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			piety = -100
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			pf_glory_minus2_effect = yes
			pf_tradition_minus2_effect = yes
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}


	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 16
bid_for_independence = {
	name = CB_NAME_INDEPENDENCE
	war_name = WAR_NAME_INDEPENDENCE
	sprite = 12
	truce_days = 3650

	is_permanent = yes
	is_independence = yes
	can_ask_to_join_war = no

	sort_priority = 1500

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		ROOT = {
			de_facto_liege = FROM
			mercenary = no
			OR = {
				is_nomadic = no
				NOT = {
					clan_opinion = { who = FROM value = 0 }
				}
			}
		}

		FROM = {
			NOT = {
				any_war = {
					attacker = {
						character = PREVPREV
					}
					OR = {
						using_cb = bid_for_independence
						using_cb = depose_liege
					}
				}
			}
			any_demesne_title = {
				NOT = { lower_tier_than = ROOT }
				temporary = no
			}
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}

			# No independence factions in merchant republics
			NOT = {
				AND = {
					is_merchant_republic = yes
					liege = {
						is_merchant_republic = yes
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		FROM = {
			any_demesne_title = {
				NOT = { lower_tier_than = ROOT }
				temporary = no
			}
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
			# No independence factions in merchant republics
			NOT = {
				AND = {
					is_merchant_republic = yes
					liege_before_war = {
						is_merchant_republic = yes
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their bid for independence against [From.GetBestName] (ID: [From.GetID])"
		if = {
			limit = {
				FROM = { independent = no }
			}
			FROM = {
				liege = {
					ROOT = {
						set_defacto_liege = PREV
						pf_liege_change_effect = yes
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { independent = yes }
			}
			ROOT = {
				set_defacto_liege = ROOT
				pf_liege_change_effect = yes
			}

			#weakly held territories may declare independence
			hidden_tooltip = {
				FROM = {
					any_vassal = {
						character_event = { id = Plus.430 days = 3 }
					}
				}
			}
		}

		hidden_tooltip = {
			ROOT = {
				prestige = 100
				add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
				pf_glory_plus2_effect = yes
				set_character_flag = ai_flag_never_transfer
			}
			FROM = {
				opinion = {
					who = ROOT
					modifier = opinion_independent
					years = 50
				}
				pf_glory_minus2_effect = yes
			}
		}

		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		FROM = {
			any_demesne_title = {
				limit = { can_destroy_title_trigger = yes }
				custom_tooltip = { text = TITLE_ENDANGERED_NO_NAME }
				set_title_flag = destroy_title
			}
			any_demesne_title = {
				title_reduce_CA_effect = yes
				title_reduce_TO_effect = yes
			}
			hidden_tooltip = {
				# destroy primary title if it has been reduced too much
				if = {
					limit = { primary_title = { has_title_flag = destroy_title } }
					character_event = { id = Plus.1620 days = 4 }
				}
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -50
			participation_scaled_prestige = -50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = -50 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -100
			prisoner = FROM
			pf_glory_minus2_effect = yes
		}
		ROOT = {
			participation_scaled_prestige = -100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = -100 }
		}
		FROM = {
			prestige = 50
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
	}

	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}

		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 17
depose_liege = {
	name = CB_NAME_DEPOSE_LIEGE
	war_name = WAR_NAME_DEPOSE_LIEGE
	sprite = 12
	truce_days = 3650

	is_permanent = yes
	can_call_vassals = yes

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		always = no # v2.21 - Disabled - not working well
		ROOT = {
			de_facto_liege = FROM
		}

		FROM = {
			OR = {
				is_feudal = yes
				is_tribal = yes
			}
			NOT = {
				any_war = {
					OR = {
						AND = { # Cannot depose liege when our liege is currently involved in such a war
							attacker = {
								character = PREVPREV
							}
							OR = {
								using_cb = bid_for_independence
								using_cb = depose_liege
							}
						}
						AND = { # Cannot depose liege if someone else is already deposing liege
							defender = {
								character = PREVPREV
							}
							using_cb = depose_liege
						}
					}
				}
			}
		}
	}

	can_use_title = {
		is_vice_royalty = no
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		FROM = {
			any_demesne_title = {
				NOT = { lower_tier_than = ROOT }
				temporary = no
			}
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their depose_liege cb against [From.GetBestName] (ID: [From.GetID])"
		hidden_tooltip = {
			any_attacker = {
				opinion = { modifier = overthrown_ruler who = FROM }
				reverse_opinion = { modifier = overthrew_me who = FROM }
			}
		}
		FROM = {
			prestige = -500
			any_demesne_title = {
				limit = { can_destroy_title_trigger = yes }
				custom_tooltip = { text = TITLE_ENDANGERED_NO_NAME }
				save_event_target_as = former_primary_title
				set_title_flag = destroy_title
			}
			any_demesne_title = {
				title_reduce_CA_effect = yes
				title_reduce_TO_effect = yes
			}
			if = {
				limit = { has_dlc = "Zeus" }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = duke
							tier = king
							tier = emperor
						}
						NOT = { has_law = revoke_title_law_0 }
					}
					if = {
						limit = { has_law = revoke_title_law_1 }
						add_law = revoke_title_law_0
					}
					if = {
						limit = { has_law = revoke_title_law_2 }
						add_law = revoke_title_law_0
					}
				}
			}
			abdicate_to_most_liked_by = ROOT
			hidden_tooltip = {
				event_target:former_primary_title = {
					holder_scope = {
						# destroy primary title if it has been reduced too much
						if = {
							limit = { primary_title = { has_title_flag = destroy_title } }
							character_event = { id = Plus.1620 days = 4 }
						}
					}
				}
			}
		}
		ROOT = {
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 250 }
		}

		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			prisoner = FROM
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 18
overthrow_ruler = {
	name = CB_NAME_OVERTHROWRULER
	war_name = WAR_NAME_OVERTHROWRULER
	sprite = 12
	truce_days = 3650

	is_revolt_cb = yes
	can_call_vassals = yes
	attacker_can_call_allies = no
	major_revolt = yes
	is_tyranny_cb = yes

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		FROM = {
			primary_title = {
				is_vice_royalty = no
			}
		}
		ROOT = {
			de_facto_liege = FROM
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		FROM = {
			any_demesne_title = {
				NOT = { lower_tier_than = ROOT }
				temporary = no
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their overthrow_ruler CB against [From.GetBestName] (ID: [From.GetID])"
		hidden_tooltip = {
			any_attacker = {
				opinion = { modifier = overthrown_ruler who = FROM }
				reverse_opinion = { modifier = overthrew_me who = FROM }
			}
		}
		ROOT = {
			primary_title = {
				add_pressed_claim = FROM
			}
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		FROM = {
			prestige = -500
			remove_opinion = {
				who = ROOT
				modifier = declared_war
			}
			any_demesne_title = {
				limit = { can_destroy_title_trigger = yes }
				custom_tooltip = { text = TITLE_ENDANGERED_NO_NAME }
				set_title_flag = destroy_title
			}
			any_demesne_title = {
				title_reduce_CA_effect = yes
				title_reduce_TO_effect = yes
			}
			hidden_tooltip = {
				# destroy primary title if it has been reduced too much
				if = {
					limit = { primary_title = { has_title_flag = destroy_title } }
					current_heir = { character_event = { id = Plus.1620 days = 4 } }
				}
			}
			abdicate = yes
		}
		ROOT = {
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 250 }
		}
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			remove_opinion = {
				who = ROOT
				modifier = declared_war
			}
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			prestige = -200
			prisoner = FROM
			pf_glory_minus2_effect = yes
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_council_power_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
	}

	on_defender_leader_death = {
		hidden_tooltip = {
			any_attacker = {
				letter_event = {
					id = 251
				}
			}
		}

		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 19
overthrow_ruler_no_calls = {
	name = CB_NAME_OVERTHROWRULER_NC
	war_name = WAR_NAME_OVERTHROWRULER_NC
	sprite = 12
	truce_days = 3650

	is_revolt_cb = yes
	can_call_vassals = no
	can_ask_to_join_war = no


	can_use_gui = {
		check_if_crusader_trigger = yes
	}
	can_use = {
		FROM = {
			primary_title = {
				is_vice_royalty = no
			}
		}
		ROOT = {
			de_facto_liege = FROM
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		FROM = {
			higher_tier_than = ROOT
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their overthrow_ruler_no_calls CB against [From.GetBestName] (ID: [From.GetID])"
		hidden_tooltip = {
			any_attacker = {
				opinion = { modifier = overthrown_ruler who = FROM }
				reverse_opinion = { modifier = overthrew_me who = FROM }
			}
		}
		ROOT = {
			primary_title = {
				add_pressed_claim = FROM
			}
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		FROM = {
			prestige = -500
			remove_opinion = {
				who = ROOT
				modifier = declared_war
			}
			any_demesne_title = {
				limit = { can_destroy_title_trigger = yes }
				custom_tooltip = { text = TITLE_ENDANGERED_NO_NAME }
				set_title_flag = destroy_title
			}
			any_demesne_title = {
				title_reduce_CA_effect = yes
				title_reduce_TO_effect = yes
			}
			hidden_tooltip = {
				# destroy primary title if it has been reduced too much
				if = {
					limit = { primary_title = { has_title_flag = destroy_title } }
					current_heir = { character_event = { id = Plus.1620 days = 4 } }
				}
			}
			abdicate = yes
		}
		ROOT = {
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 250 }
		}
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			remove_opinion = {
				who = ROOT
				modifier = declared_war
			}
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			prestige = -200
			prisoner = FROM
			pf_glory_minus2_effect = yes
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 20 Disabled
change_gavelkind_succession_law = {
	name = CB_NAME_GAVELKIND_SUCCESSION_LAW
	war_name = WAR_NAME_GAVELKIND_SUCCESSION_LAW
	sprite = 6
	truce_days = 3650
	attacker_can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		always = no
		ROOT = {
			vassal_of = FROM
		}
	}

	is_valid = {
		FROM = {
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}

	is_valid_title = {
		NOT = {
			has_law = succ_gavelkind
		}
		OR = {
			tier = emperor
			tier = king
			is_primary_holder_title = yes
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = { detract_grace_super_huge_effect = yes }
		}
	}

	on_success = {
		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					if = {
						limit = {
							OR = {
								tier = king
								tier = emperor
							}
		#					is_titular = no
							NOT = { has_law = crown_authority_0 }
						}
						if = {
							limit = { has_law = crown_authority_1 }
							add_law = crown_authority_0
						}
						if = {
							limit = { has_law = crown_authority_2 }
							add_law = crown_authority_1
						}
						if = {
							limit = { has_law = crown_authority_3 }
							add_law = crown_authority_2
						}
						if = {
							limit = { has_law = crown_authority_4 }
							add_law = crown_authority_3
						}
					}
				}
			}
		}

		ROOT = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				disband_event_forces = faction_revolters
			}
		}
	}

	on_success_title = {
		succession_w_cooldown = gavelkind
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}

		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_gavelkind_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			prisoner = FROM
		}
		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				if = {
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_gavelkind_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}

		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 21 Disabled
lower_crown_authority_law = {
	name = CB_NAME_LOWER_CROWN_AUTHORITY_LAW
	war_name = WAR_NAME_LOWER_CROWN_AUTHORITY_LAW
	sprite = 6
	truce_days = 3650
	can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		always = no
		ROOT = {
			vassal_of = FROM
		}
		NOT = { has_dlc = "Zeus" }
	}

	can_use_title = {
		holder_scope = { independent = yes }
		OR = {
			tier = king
			tier = emperor
		}
		OR = {
			has_law = crown_authority_1
			has_law = crown_authority_2
			has_law = crown_authority_3
			has_law = crown_authority_4
		}
	}

	is_valid = {
		FROM = {
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			opinion = {
				modifier = opinion_lowered_crown_authority
				who = FROM
				months = 12
			}
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_success_title = {
		if = {
			limit = { has_law = crown_authority_1 }
			add_law_w_cooldown = crown_authority_0
		}
		if = {
			limit = { has_law = crown_authority_2 }
			add_law_w_cooldown = crown_authority_1
		}
		if = {
			limit = { has_law = crown_authority_3 }
			add_law_w_cooldown = crown_authority_2
		}
		if = {
			limit = { has_law = crown_authority_4 }
			add_law_w_cooldown = crown_authority_3
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}

		FROM = {
			participation_scaled_prestige = 50
			hidden_tooltip = { disband_event_forces = faction_loyalists }
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}

		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_lower_CA_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			prisoner = FROM
		}

		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			hidden_tooltip = {
				if = {
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_lower_CA_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 22 Disabled
lower_tribal_organization_law = {
	name = CB_NAME_LOWER_TRIBAL_ORGANIZATION_LAW
	war_name = WAR_NAME_LOWER_TRIBAL_ORGANIZATION_LAW
	sprite = 6
	truce_days = 3650
	can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		always = no
		ROOT = {
			vassal_of = FROM
		}
	}

	can_use_title = {
		holder_scope = { independent = yes }
		OR = {
			tier = duke
			tier = king
			tier = emperor
		}
		OR = {
			has_law = tribal_organization_1
			has_law = tribal_organization_2
			has_law = tribal_organization_3
			has_law = tribal_organization_4
		}
	}

	is_valid = {
		FROM = {
			is_tribal = yes
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			opinion = {
				modifier = opinion_lowered_tribal_organization
				who = FROM
				months = 12
			}
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_success_title = {
		if = {
			limit = { has_law = tribal_organization_1 }
			add_law_w_cooldown = tribal_organization_0
		}
		if = {
			limit = { has_law = tribal_organization_2 }
			add_law_w_cooldown = tribal_organization_1
		}
		if = {
			limit = { has_law = tribal_organization_3 }
			add_law_w_cooldown = tribal_organization_2
		}
		if = {
			limit = { has_law = tribal_organization_4 }
			add_law_w_cooldown = tribal_organization_3
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}

		FROM = {
			participation_scaled_prestige = 50
			hidden_tooltip = { disband_event_forces = faction_loyalists }
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}

		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_lower_TO_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			prisoner = FROM
		}

		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			hidden_tooltip = {
				if = {
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_lower_TO_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 23
coastal_republic = {
	name = CB_NAME_COASTAL_REPUBLIC
	war_name = WAR_NAME_COASTAL_REPUBLIC
	sprite = 1
	truce_days = 3650
	is_permanent = yes
	check_all_titles = yes
	can_ask_to_join_war = yes

	allow_distant = yes # AI parameter

	allowed_to_target_tributaries = no

	sort_priority = 700

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			attacking_religious_head_trigger = no
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
			NOR = {
				is_liege_or_above = FROM
				is_vassal_or_below = FROM
				same_liege = FROM
				has_character_modifier = rep_cb_cd
			}
			mercenary = no
		}
	}

	can_use_title = {
		tier = COUNT

		location = {
			port = yes
			has_trade_post = yes
			trade_post_owner = {
				character = ROOT
			}

			county = { # Attacker, or a vassal of the attacker, owns a city in the county
				any_direct_de_jure_vassal_title = {
					tier = baron
					is_republic = yes
					holder_scope = {
						OR = {
							character = ROOT
							is_liege_or_above = ROOT
						}
					}
				}
			}

			# Not allowed to use this CB to take cities in the capital province of a rival merchant republic
			FROM = {
				OR = {
					is_merchant_republic = no
					capital_scope = {
						NOT = { province_id = PREVPREV }
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		ROOT = {
			add_character_modifier = {
				name = rep_cb_cd
				duration = 1825
				hidden = no
				inherit = yes
			}
		}
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		FROM = {
			pf_glory_minus2_effect = yes
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their coastal county republic war for the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		if = {
			limit = {
				location = {
					port = yes
					ROOT = {
						capital_scope = {
							NOT = {
								distance = {
									where = PREVPREV # Comparing the distance between ROOT's capital and the title in question
									value = 650	#  From  aprox.Venice to East Cyprus and from Venice to Gibraltar
								}
							}
						}
					}
				}
			}
			custom_tooltip = {
				text = CTT_REP_IN_RANGE
			}
		}
		else = {
			custom_tooltip = {
				text = CTT_REP_OUT_RANGE
			}
		}
		if = {
			limit = {
				location = {
					trade_post_owner = {
						is_liege_or_above = ROOT
					}
				}
			}
			location = {
				trade_post_owner = {
					usurp_title = PREVPREV
				}
			}
		}
		else = {
			usurp_title = ROOT
		}

		hidden_tooltip = {
			ROOT = {
				remove_character_modifier = rep_cb_cd
				add_character_modifier = {
					name = rep_cb_cd
					duration = 1825
					hidden = no
					inherit = yes
				}
			}
		}

		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}

		hidden_tooltip = {
			ROOT = { remove_character_modifier = rep_cb_cd }
		}

	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			pf_glory_minus2_effect = yes
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		hidden_tooltip = {
			ROOT = { remove_character_modifier = rep_cb_cd }
		}

	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 50
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 50
	}

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 0
			ROOT = {
				NOR = {
					trait = cynical
					trait = ambitious
				}
				rightful_religious_head_scope = { character = FROM }
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 24 Disabled
coastal_county_republic = {
	name = CB_NAME_COASTAL_COUNTY_REPUBLIC
	war_name = WAR_NAME_COASTAL_COUNTY_REPUBLIC
	sprite = 1
	truce_days = 3650
	is_permanent = yes
	check_all_titles = yes
	can_ask_to_join_war = no

	allow_distant = yes # AI parameter

	allowed_to_target_tributaries = no

	sort_priority = 700

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		always = no
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
			NOT = { is_liege_or_above = FROM }
			NOT = { is_vassal_or_below = FROM }
			NOT = { same_liege = FROM }
			mercenary = no
		}
	}

	can_use_title = {
		tier = COUNT
		location = {
			port = yes
			county = {
				any_direct_de_jure_vassal_title = {
					holder_scope = {
						OR = {
							character = ROOT
							is_liege_or_above = ROOT
						}
					}
				}
			}
			any_neighbor_province = {
				OR = {
					AND = {
						has_owner = yes
						owner = {
							OR = {
								character = ROOT
								is_liege_or_above = ROOT
							}
						}
					}
					AND = {
						is_land = no
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											character = ROOT
											is_liege_or_above = ROOT
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										owner = {
											OR = {
												character = ROOT
												is_liege_or_above = ROOT
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
		}
	}

	is_valid_title = {
		tier = COUNT
		location = {
			port = yes
			county = {
				any_direct_de_jure_vassal_title = {
					holder_scope = {
						OR = {
							character = ROOT
							is_liege_or_above = ROOT
						}
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success_title = {
		if = {
			limit = {
				any_direct_de_jure_vassal_title = {
					holder_scope = {
						character = ROOT
					}
				}
			}
			usurp_title = ROOT
		}

		if = {
			limit = {
				NOT = {
					any_direct_de_jure_vassal_title = {
						holder_scope = {
							character = ROOT
						}
					}
				}
			}
			any_de_jure_vassal_title = {
				limit = {
					holder_scope = {
						is_liege_or_above = ROOT
					}
				}
				holder_scope = {
					usurp_title = PREVPREV
					set_defacto_liege = ROOT
				}
			}
		}

		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 25
weaken_vassal_plot = {
	name = CB_NAME_WEAKEN_VASSAL
	war_name = WAR_NAME_WEAKEN_VASSAL
	sprite = 3
	truce_days = 3650
	hostile_against_others = yes

	press_claim = yes
	can_call_allies = no
	can_ask_to_join_war = no

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		FROM = {
			pf_glory_minus2_effect = yes
		}
	}

	on_success_title = {
		title_reduce_CA_effect = yes
		title_reduce_TO_effect = yes

		FROM = {
			random_vassal = {
				limit = {
					is_primary_heir = no
					tier = count
					any_demesne_title = {
						tier = count
						dejure_liege_title = {
							ROOT = {
								plot_target_title = {
									title = PREVPREV
								}
							}
						}
					}
				}
				grant_title = PREVPREV
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
			cancel_plot = plot_weaken_fellow_vassal
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_invalidation = {
		ROOT = {
			cancel_plot = plot_weaken_fellow_vassal
		}

	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			participation_scaled_prestige = 100
		}
		ROOT = {
			prestige = -200
			imprison = FROM
			cancel_plot = plot_weaken_fellow_vassal
			pf_glory_minus2_effect = yes
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_attacker_leader_death = {
		any_defender = {
			letter_event = {
				id = 251
			}
		}
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 26 Disabled
decadence_invasion = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_DEC_INVASION
	sprite = 7
	truce_days = 3650
	hostile_against_others = yes
	can_ask_to_join_war = no

	can_use = {
		always = no
		ROOT = {
			has_character_flag = decadence_invader
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		any_playable_ruler = {
			limit = {
				ai = no
				NOT = { character = FROM }
				NOT = { dynasty = FROM }
				NOT = {
					any_liege = {
						character = FROM
					}
				}
				OR = {
					FROM = { higher_tier_than = DUKE }
					any_realm_province = {
						any_neighbor_province = {
							owner = {
								any_liege = {
									character = FROM
								}
							}
						}
					}
				}
			}
			narrative_event = { id = 91241 }
		}

		FROM = {
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					if = {
						limit = {
							OR = {
								tier = king
								tier = emperor
							}
							NOT = { has_law = crown_authority_0 }
						}
						add_law = crown_authority_0
					}
				}
			}
		}

		ROOT = {
			prestige = 200
			piety = 100
			occupy_minors_of_occupied_settlements = FROM
			gain_all_occupied_titles = { who = FROM type = revolt }
			give_nickname = nick_the_conqueror
			participation_scaled_prestige = 200
			participation_scaled_piety = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 200
				participation_scaled_piety = 100
			}
		}

		FROM = {
			prestige = -200
			primary_title = {
				holder_scope = {
					any_demesne_title = {
						limit = {
							higher_tier_than = COUNT
							NOT = {
								tier = PREVPREV
							}
						}
						usurp_title_plus_barony_if_unlanded = { target = ROOT type = revolt }

						if = {
							limit = {
								NOT = { culture = ROOT }
							}
							hidden_tooltip = { conquest_culture = ROOT }
						}
					}
					any_demesne_title = {
						limit = {
							tier = PREVPREV
						}
						destroy_landed_title = THIS
					}
				}
			}

			set_defacto_liege = ROOT
			imprison = ROOT

			hidden_tooltip = {
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_decadent }
						10 = { give_nickname = nick_the_unready }
						10 = { give_nickname = nick_the_ill_ruler }
					}
				}
			}
		}

		hidden_tooltip = {
			ROOT = {
				disband_event_forces = decadence_revolters

				# Powerful vassals can choose independence
				#any_vassal = {
				#	limit = {
				#		NOT = { character = FROM }
				#		higher_tier_than = COUNT
				#		prisoner = no
				#	}
				#	character_event = { id = 91240 }
				#}
			}
		}

		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -200
		}
		FROM = {
			prestige = 100
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		hidden_tooltip = {
			ROOT = { disband_event_forces = decadence_revolters }
		}
	}

	on_reverse_demand = {
		ROOT = { set_defacto_liege = FROM }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 8.0
			}
		}
		FROM = {
			prestige = 200
		}
		ROOT = {
			imprison = FROM
			disband_event_forces = decadence_revolters
		}
		if = {
			limit = {
				FROM = {
					ai = no
					NOT = { has_character_flag = achievement_decadent_warrior }
				}
			}
			FROM = { set_character_flag = achievement_decadent_warrior }
		}
	}

	on_reverse_demand_title = {
		ROOT = { show_scope_change = no remove_claim = PREV }
	}

	attacker_ai_victory_worth = {
		factor = 100
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 150
	}
}

# 27 Disabled
muslim_invasion = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_INVASION
	sprite = 8
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	is_holy_war = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes

	allowed_to_target_tributaries = no

	sort_priority = 2000

	can_use_gui = {
		ROOT = {
			piety = 1000
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		ROOT = { piety = -1000 }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	can_use = {
		always = no
		ROOT = {
			OR = {
				ai = yes
				multiplayer = no
				NOT = {
					has_game_rule = {
						name = multiplayer_invasions
						value = off
					}
				}
			}
			religion_group = muslim

			# These use 'tribal_invasion' instead:
			NOR = {
				is_nomadic = yes
				AND = {
					primary_title = { is_tribal_type_title = yes }
					has_horde_culture = yes
				}
				AND = {
					mercenary = yes
					NOT = {
						num_of_titles = 2
					}
				}
			}
		}

		FROM = { NOT = { religion = ROOT } }

		ROOT = {
			NOT = { is_liege_or_above = FROM }
			mercenary = no
		}
	}

	can_use_title = {
		# Muslims require the target to have at least 6 counties within the target kingdom
		FROM = {
			num_of_realm_counties = {
				value = 6
				title = PREV
			}
		}
		# The attacker needs at least one county in the target kingdom, or a border
		any_direct_de_jure_vassal_title = {
			any_direct_de_jure_vassal_title = {
				OR = {
					holder_scope = {
						OR = {
							character = ROOT
							is_liege_or_above = ROOT
						}
					}
					location = {
						any_neighbor_province = {
							owner = {
								OR = {
									character = ROOT
									is_liege_or_above = ROOT
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			religion_group = muslim
		}
		FROM = { NOT = { religion = ROOT } }
	}

	is_valid_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_success = {
		ROOT = {
			show_scope_change = no
			prestige = 200
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
			participation_scaled_prestige = 200
			if = {
				limit = {
					uses_decadence = yes
					FROM = { NOT = { uses_decadence = yes } }
				}
				participation_scaled_decadence = -20
			}
		}

		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 200
				if = {
					limit = {
						uses_decadence = yes
						FROM = { NOT = { uses_decadence = yes } }
					}
					participation_scaled_decadence = -20
				}
				hidden_tooltip = {
					if = {
						limit = {
							has_ambition = obj_strengthen_religion
						}
						change_variable = { which = strengthen_religion value = 1 }
					}
				}
			}
		}
		FROM = {
			show_scope_change = no
			prestige = -200
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = other_invasion_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title_destroy_duchies = {
						title = PREV
						enemy = FROM
						is_crusade = no # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
						type = invasion
					}
					if = {
						limit = {
							OR = {
								this_has_lame_nickname_trigger = yes
								has_nickname = no
							}
						}
						random_list = {
							10 = { give_nickname = nick_the_holy }
							10 = { give_nickname = nick_the_glorious }
							10 = { give_nickname = nick_the_lionheart }
							10 = { give_nickname = nick_the_great }
							10 = { give_nickname = nick_the_hammer }
							10 = { give_nickname = nick_the_magnificent }
						}
					}
				}
			}
		}
	}

	on_fail = {
		FROM = {
			show_scope_change = no
			prestige = 100
		}
		FROM = {
			show_scope_change = no
			if = {
				limit = {
					has_dlc = "Legacy of Rome"
					OR = {
						has_landed_title = e_byzantium
						has_landed_title = e_roman_empire
					}
						OR = {
							religion_group = christian
							religion = hellenic_pagan
							religion = hellenic_pagan_reformed
						}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
			hidden_effect = {
				if = {
					limit = {
						OR = {
							this_has_lame_nickname_trigger = yes
							has_nickname = no
						}
					}
					random_list = {
						10 = { give_nickname = nick_the_holy }
						10 = { give_nickname = nick_the_glorious }
						10 = { give_nickname = nick_the_lionheart }
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_hammer }
						10 = { give_nickname = nick_the_magnificent }
						10 = { give_nickname = nick_the_avenger }
					}
				}
			}
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		ROOT = {
			show_scope_change = no
			prestige = -200
		}
	}

	on_invalidation = {
		ROOT = {
			show_scope_change = no
			piety = 1000
		}
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			if = {
				limit = {
					NOT = {
						any_liege = {
							dynasty = PREV
						}
					}
				}
				decadence = 10
			}
		}
		FROM = {
			show_scope_change = no
			prestige = 200
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
			if = {
				limit = {
					has_dlc = "Legacy of Rome"
					OR = {
						has_landed_title = e_byzantium
						has_landed_title = e_roman_empire
					}
						OR = {
							religion_group = christian
							religion = hellenic_pagan
							religion = hellenic_pagan_reformed
						}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
			hidden_effect = {
				if = {
					limit = {
						OR = {
							this_has_lame_nickname_trigger = yes
							has_nickname = no
						}
					}
					random_list = {
						10 = { give_nickname = nick_the_holy }
						10 = { give_nickname = nick_the_glorious }
						10 = { give_nickname = nick_the_lionheart }
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_hammer }
						10 = { give_nickname = nick_the_magnificent }
						10 = { give_nickname = nick_the_avenger }
					}
				}
			}
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = 100
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 150
	}

	ai_will_do = {
		factor = 1

		modifier = {
			factor = 0.9 # Prefer using CB's without on_add costs
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_nomadic = no
				NOT = {
					is_tribal = yes
				}
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_tribal = yes
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = tribal
						}
					}
				}
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 28
cb_faction_independence = {
	name = CB_NAME_INDEPENDENCE
	war_name = WAR_NAME_FACTION_INDEPENDENCE
	sprite = 12
	truce_days = 3650
	major_revolt = yes

	attacker_can_call_allies = no
	can_ask_to_join_war = no

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		ROOT = {
			vassal_of = FROM
			has_opinion_modifier = { who = FROM modifier = revolting_against }
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
			has_opinion_modifier = { who = FROM modifier = revolting_against }
		}
		FROM = {
			any_demesne_title = {
				NOT = { lower_tier_than = ROOT }
				temporary = no
			}
			independent = yes
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		log = "CB(cb_faction_independence): START: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"
		FROM = { pf_log_state_effect = yes }
		ROOT = { pf_log_state_effect = yes }
		#emf_cb_dynlevy_begin_effect = yes
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		log = "CB(cb_faction_independence): VICTORY: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"

		# add victory modifier for the 'Win a War' ambition
		any_attacker = { add_character_modifier = { name = victory_timer duration = 1 hidden = yes } }

		# apply immediate effects to the revolters
		hidden_tooltip = {
			any_attacker = {
				limit = { has_opinion_modifier = { who = FROM modifier = revolting_against } }

				# get Glory faction boost
				pf_glory_plus2_effect = yes

				# and also are grateful to each other for their victory
				FROM = {
					any_opinion_modifier_target = {
						limit = {
							reverse_has_opinion_modifier = {
								who = PREV
								modifier = revolting_against_me
							}
							NOT = { character = PREVPREV }
						}
						reverse_opinion = {
							who = PREVPREV
							modifier = opinion_very_grateful
							years = 10
						}
					}
				}
			}
		}

		# revolters will become independent
		if = {
			limit = { FROM = { independent = yes } }
			FROM = {
				any_opinion_modifier_target = {
					limit = { pf_part_of_this_revolt_trigger = yes }
					set_defacto_liege = THIS
					hidden_tooltip = {
						prestige = 100
						reverse_opinion = { who = PREV modifier = opinion_independent years = 50 }
						#weakly held territories may declare independence
						any_vassal = { character_event = { id = Plus.430 days = 3 } }
					}
				}
				#weakly held territories may declare independence
				hidden_tooltip = {
					any_vassal = {
						limit = { pf_part_of_this_revolt_trigger = no }
						character_event = { id = Plus.430 days = 3 }
					}
				}
			}
		}

		hidden_tooltip = {
			any_attacker = {
				limit = {
					leads_faction = faction_separatist
					independent = yes
				}
				set_character_flag = former_faction_leader
				pf_clear_war_flags_effect = yes
			}
			any_attacker = {
				limit = {
					in_faction = faction_separatist
					independent = yes
				}
				pf_clear_supporter_flags_effect = yes
				pf_clear_war_flags_effect = yes
			}
		}

		# clean up remaining TOMs
		pf_civil_war_cleanup_effect = yes

		ROOT = {
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 200
			}
		}

		FROM = {
			prestige = -500
			pf_glory_minus2_effect = yes

			# increase imperial decadence
			imperial_decadence_plus_1_effect = yes

			# check whether title will be destroyed (CK2Plus only)
			any_demesne_title = {
				limit = { can_destroy_title_trigger = yes }
				custom_tooltip = { text = TITLE_ENDANGERED_NO_NAME }
				log = "[This.GetFullName] should be destroyed as a result of the revolt"
				set_title_flag = destroy_title
			}

			# always lower CA/TO, even if it wasn't a revolt demand
			pf_lower_CA_effect = yes # lower Crown Authority
			pf_lower_TO_effect = yes # lower Tribal Organization

			# check whether the primary title should be destroyed due to CA loss
			if = {
				limit = { primary_title = { has_title_flag = destroy_title } }
				hidden_tooltip = { character_event = { id = Plus.1620 days = 4 } } #destroy title
			}
		}

		# change faction moods
		FROM = { hidden_tooltip = { character_event = { id = PlusFaction.200 days = 1 } } }
		ROOT = { hidden_tooltip = { character_event = { id = PlusFaction.200 days = 1 } } }

		# reset contiguous territory province flags
		hidden_tooltip = { d_miaphysite = { holder_scope = { character_event = { id = Plus.307 days = 1 } } } }

		#emf_cb_dynlevy_end_effect = yes
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		log = "CB(cb_faction_independence): WHITEPEACE: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"

		#emf_cb_dynlevy_end_effect = yes

		# clean up remaining TOMs
		pf_civil_war_cleanup_effect = yes

		hidden_tooltip = {
			FROM = {
				remove_opinion = {
					who = ROOT
					modifier = declared_war
				}
			}
		}

		ROOT = {
			prestige = -100
			prisoner = FROM
			add_character_modifier = {
				name = faction_independence_ultimatum_timer
				hidden = yes
				duration = 3650
			}
		}

		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = -100 }
			add_character_modifier = {
				name = faction_independence_ultimatum_timer
				hidden = yes
				duration = 3650
			}
		}
	}

	on_reverse_demand = {
		log = "CB(cb_faction_independence): DEFEAT: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"

		#emf_cb_obj_win_war_reverse_effect = yes
		#emf_cb_dynlevy_end_effect = yes

		FROM = {
			prestige = 200
			# the defender loses 1 Imperial Decadence
			imperial_decadence_minus_1_effect = yes
			# receive Glory faction boost
			pf_glory_plus2_effect = yes
			# add victory modifier for the 'Win a War' ambition
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			# remove any previously-existing loser TOMs
			pf_civil_war_clear_old_opinions_effect = yes
		}

		# apply immediate effects to the revolters
		any_attacker = {
			limit = { has_opinion_modifier = { who = FROM modifier = revolting_against } }
			imprison = FROM
			hidden_tooltip = {
				reverse_opinion = { who = FROM modifier = opinion_civil_war_loser months = 60 }
				opinion = { who = FROM modifier = opinion_coerced_into_leaving_faction months = 60 }
			}
		}

		# mark loyalists and neutrals for the reward event
		hidden_tooltip = {
			FROM = {
				any_vassal = {
					limit = { reverse_has_opinion_modifier = { who = PREV modifier = pf_loyal_to_me } }
					reverse_opinion = { who = PREV modifier = opinion_civil_war_supporter months = 60 }
				}
				any_vassal = {
					limit = { reverse_has_opinion_modifier = { who = PREV modifier = pf_neutral_to_me } }
					reverse_opinion = { who = PREV modifier = opinion_civil_war_neutral months = 60 }
				}
			}
		}

		# clean up remaining civil war state
		pf_civil_war_cleanup_effect = yes

		ROOT = {
			prestige = -200
			pf_glory_minus2_effect = yes
			add_character_modifier = {
				name = faction_independence_ultimatum_timer
				hidden = yes
				duration = 3650
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			participation_scaled_prestige = -200
			hidden_tooltip = {
				add_character_modifier = {
					name = faction_independence_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}

		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		# post-civil war event to reward allies
		FROM = {
			hidden_tooltip = { character_event = { id = PlusFaction.450 } }
		}

		# change faction moods
		hidden_tooltip = {
			FROM = { character_event = { id = PlusFaction.200 days = 1 } }
			ROOT = { character_event = { id = PlusFaction.200 days = 1 } }
		}
	}

	on_invalidation = {
		log = "CB(cb_faction_independence): INVALIDATED: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"

		#emf_cb_dynlevy_end_effect = yes

		# clean up remaining civil war state
		pf_civil_war_cleanup_effect = yes
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 29
imperial_reconquest = {
	name = CB_NAME_IMPERIAL
	war_name = WAR_NAME_IMPERIAL
	sprite = 17
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes

	allowed_to_target_tributaries = no

	sort_priority = 1900

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			has_landed_title = e_roman_empire
			independent = yes
			OR = {
				religion_group = christian
				religion_group = hellenic_pagan_group
			}
			NOT = { same_realm = FROM }
			mercenary = no
		}
	}

	can_use_title = {
		capital_scope = {
			OR = {
				region = custom_byzantium
				region = custom_nikaea
				region = custom_trebizond
				region = custom_armenia
				region = custom_bulgaria
				region = custom_serbia
				region = custom_croatia
				region = custom_italy
				region = custom_sicily
				region = custom_germany
				region = custom_burgundy
				region = custom_france
				region = custom_aquitaine
				region = custom_brittany
				region = custom_england
				region = custom_wales
				region = custom_frisia
				region = custom_lotharingia
				region = world_europe_west_iberia
				region = custom_syria
				region = custom_jerusalem
				region = custom_egypt
				region = custom_africa
			}
		}
		FROM = {
			#neighbours or close
			OR = {
				any_realm_province = {
					duchy = { title = PREVPREVPREV }
					any_neighbor_province = {
						owner = { same_realm = ROOT }
					}
				}
				any_realm_province = {
					duchy = { title = PREVPREVPREV }
					ROOT = {
						any_realm_province = {
							NOT = { distance = { where = PREVPREV value = 150 } }
							owner = { same_realm = ROOT }
						}
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			independent = yes
			OR = {
				religion_group = christian
				is_pagan_religion = yes
			}
			NOT = { same_realm = FROM }
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			imperial_decadence_minus_1_effect = yes
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 200
			}
		}
		FROM = {
			prestige = -200
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their imperial reconquest of the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		empty_province_effect = yes

		pf_liege_change_under_title_begin_effect = yes

		custom_tooltip = {
			text = other_invasion_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						type = invasion
					}
				}
			}
		}
		if = {
			limit = {
				holder_scope = { character = FROM }
			}
			usurp_title_only = { target = ROOT type = invasion }
		}

		pf_liege_change_under_title_end_effect = yes
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = { prestige = -100 }
	}

	on_reverse_demand = {
		FROM = {
			imperial_decadence_minus_1_effect = yes
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			imperial_decadence_plus_1_effect = yes
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			prestige = -200
			pf_glory_minus2_effect = yes
		}
		FROM = {
			participation_scaled_piety = 100
			participation_scaled_prestige = 200
			dynasty_head = {
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_piety = 100
				participation_scaled_prestige = 200
				dynasty_head = {
					if = {
						limit = {
							uses_decadence = yes
						}
						participation_scaled_decadence = -10
					}
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 30
embargo_cb = {
	name = CB_NAME_EMBARGO
	war_name = WAR_NAME_EMBARGO
	sprite = 11
	truce_days = 3650

	is_permanent = yes
	can_ask_to_join_war = no

	allowed_to_target_tributaries = no

	sort_priority = 2000

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			independent = yes
			NOT = { has_embargo = FROM }
			mercenary = no
			OR = {
				ai = no
				NOR = {
					trait = charitable
					opinion = { who = FROM value = 0 }
					AND = {
						NOR = {
							trait = greedy
							trait = envious
						}
						opinion = { who = FROM value = -25 }
					}
				}
			}
		}
		FROM = {
			OR = {
				AND = {
					is_merchant_republic = yes
					any_trade_post = {
						owner = {
							OR = {
								character = ROOT
								is_liege_or_above = ROOT
							}
						}
					}
				}
				AND = {
					OR = {
						is_merchant_republic = yes
						higher_tier_than = DUKE
					}
					any_realm_lord = {
						is_patrician = yes
						any_trade_post = {
							owner = {
								OR = {
									character = ROOT
									is_liege_or_above = ROOT
								}
							}
						}
					}
				}
			}
		}
		#the AI needs at least three trade posts to attack
		OR = {
			ROOT = { ai = no }
			FROM = {
				OR = {
					AND = {
						is_merchant_republic = yes
						any_trade_post = {
							count = 3
							owner = { same_realm = ROOT }
						}
					}
					AND = {
						higher_tier_than = DUKE
						any_realm_lord = {
							is_merchant_republic = yes
							any_trade_post = {
								count = 3
								owner = { same_realm = ROOT }
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			independent = yes
			NOT = { has_embargo = FROM }
		}
		FROM = {
			OR = {
				is_merchant_republic = yes
				AND = {
					higher_tier_than = DUKE
					any_realm_lord = {
						is_merchant_republic = yes
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their embargo war against [From.GetBestName] (ID: [From.GetID])"
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			embargo = FROM
		}
		FROM = {
			pf_glory_minus2_effect = yes
		}
	}

	on_fail = {
		if = {
			limit = {
				NOT = {
					any_attacker = {
						NOT = { character = ROOT }
						is_merchant_republic = yes
					}
				}
			}
			ROOT = {
				prestige = -100
			}
		}

		if = {
			limit = {
				any_attacker = {
					NOT = { character = ROOT }
					is_merchant_republic = yes
				}
			}
			any_attacker = {
				limit = {
					NOT = { character = ROOT }
					is_merchant_republic = yes
				}
				prestige = -100
			}
		}

		FROM = {
			prestige = 50
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		if = {
			limit = {
				NOT = {
					any_attacker = {
						NOT = { character = ROOT }
						is_merchant_republic = yes
					}
				}
			}

			ROOT = {
				prestige = -200
				transfer_scaled_wealth = {
					to = FROM
					value = 4.0
				}
			}
		}
		if = {
			limit = {
				any_attacker = {
					NOT = { character = ROOT }
					is_merchant_republic = yes
				}
			}
			any_attacker = {
				limit = {
					NOT = { character = ROOT }
					is_merchant_republic = yes
				}
				prestige = -200
				transfer_scaled_wealth = {
					to = FROM
					value = 4.0
				}
			}
		}
		ROOT = {
			pf_glory_minus2_effect = yes
		}
		FROM = {
			prestige = 100
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 50
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 50
	}

	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = {
		factor = 1
		modifier = { #Focus on Coronation first.
			factor = 0.1
			has_dlc = "Holy Fury"
			ROOT = {
				is_feudal = yes
				OR = {
					religion = catholic
					religion = fraticelli
				}
				is_crowned_trigger = no
			}
		}
		modifier = {
			factor = 0.9
			always = yes
		}
		modifier = {
			factor = 0.5
			ROOT = {
				opinion = { who = FROM value = -25 }
			}
		}
		modifier = {
			factor = 0
			ROOT = {
				opinion = { who = FROM value = 0 }
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 31
seize_trade_post = {
	name = CB_NAME_SEIZE_TRADE_POST
	war_name = WAR_NAME_SEIZE_TRADE_POST
	sprite = 1
	truce_days = 3650
	is_permanent = yes
#	check_all_titles = yes
	check_all_trade_posts = yes
	can_ask_to_join_war = yes
	att_ticking_war_score_multiplier = 5.0
	def_ticking_war_score_multiplier = 5.0
	allow_distant = yes

	allowed_to_target_tributaries = no

	sort_priority = 1900

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
			NOR = {
				is_liege_or_above = FROM
				has_character_modifier = rep_tp_cd
			}

			OR = {
				NOT = { same_realm = FROM }

				# We cannot overtly attack much weaker Patricians in the same republic
				NOT = {
					num_of_trade_post_diff = {
						character = FROM
						value = 3
					}
				}
			}
			mercenary = no
		}
		FROM = {
			NOT = { is_liege_or_above = ROOT }
		}
	}

	can_use_title = {
		tier = COUNT
		location = {
			port = yes

			# Within range of the capital
			ROOT = {
				capital_scope = {
					NOT = {
						distance = {
							where = PREVPREV # Comparing the distance between ROOT's capital and the title in question
							value = 650	#  From  aprox.Venice to East Cyprus and from Venice to Gibraltar
						}
					}
				}
			}
		}
		has_trade_post = yes
		trade_post_owner = {
			OR = {
				character = FROM
				is_liege_or_above = FROM
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
			NOT = { is_liege_or_above = FROM }
		}
		FROM = {
			NOT = { is_liege_or_above = ROOT }
		}
	}

	is_valid_title = {
		has_trade_post = yes
		trade_post_owner = {
			OR = {
				character = FROM
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		ROOT = {
			add_character_modifier = {
				name = rep_tp_cd
				duration = 1825
				hidden = no
				inherit = yes
			}
		}
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			pf_prosperity_plus2_effect = yes
		}
		FROM = {
			pf_glory_minus2_effect = yes
			pf_prosperity_minus2_effect = yes
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their seize_trade_post CB against [From.GetBestName] (ID: [From.GetID])"
		seize_trade_post = ROOT

		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		hidden_tooltip = {
			ROOT = {
				remove_character_modifier = rep_tp_cd
				add_character_modifier = {
					name = rep_tp_cd
					duration = 1825
					hidden = no
					inherit = yes
				}
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -50
			hidden_tooltip = {
				remove_character_modifier = rep_tp_cd
			}
		}
		FROM = {
			participation_scaled_prestige = -50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = -50 }
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			prestige = -100
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
			pf_glory_minus2_effect = yes
			hidden_tooltip = {
				remove_character_modifier = rep_tp_cd
			}
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 25
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 25
	}

	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = {
		factor = 1
		modifier = { #Focus on Coronation first.
			factor = 0.1
			has_dlc = "Holy Fury"
			ROOT = {
				is_feudal = yes
				OR = {
					religion = catholic
					religion = fraticelli
				}
				is_crowned_trigger = no
			}
		}
		modifier = {
			factor = 0.25
			ROOT = {
				NOT = { same_realm = FROM }
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 32
viking_invasion = {
	name = CB_NAME_VIKING_INVASION
	war_name = WAR_NAME_VIKING_INVASION
	sprite = 20
	truce_days = 365
	hostile_against_others = no # Vikings share in the spoils...
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	apply_short_occ_mod = no # Do not apply the 'recently_conquered' modifier to Holdings

	allowed_to_target_tributaries = no

	sort_priority = 3000

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			has_opinion_modifier = { who = FROM modifier = preparing_to_invade }
			NOT = { is_liege_or_above = FROM }
			mercenary = no
		}
	}

	can_use_title = {
		is_valid_viking_invasion_target = FROM # Checks that FROM holds the right amount of territory in the kingdom
	}

	is_valid_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			imperial_decadence_minus_1_effect = yes
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			prestige = 500
			piety = 250
			religion_authority = {
				modifier = won_viking_invasion
			}
			hidden_tooltip = {
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_victorious }
						10 = { give_nickname = nick_the_fearless }
						10 = { give_nickname = nick_the_brave }
						10 = { give_nickname = nick_haardraade }
						10 = { give_nickname = nick_the_viking }
						10 = { give_nickname = nick_the_dragon }
						10 = { give_nickname = nick_the_ironside }
					}
				}
			}
			participation_scaled_prestige = 300
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 300 }
		}
		FROM = {
			prestige = -500
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their viking invasion for the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		empty_province_effect = yes
		pf_liege_change_under_title_begin_effect = yes

		custom_tooltip = {
			text = tribal_invasion_succ_tip
			hidden_tooltip = {
				#attacker gains one province belonging to the target for certain
				if = {
					limit = { NOT = { capital_scope = { owner = { character = FROM } } } }
					FROM = {
						random_demesne_province = {
							limit = { county = { de_jure_liege_or_above = PREVPREVPREV } }
							culture = ROOT
							religion = ROOT
						}
					}
				}
				if = {
					limit = { capital_scope = { owner = { character = FROM } } }
					capital_scope = {
						culture = ROOT
						religion = ROOT
					}
				}
				ROOT = {
					occupy_minors_of_occupied_settlements = FROM
					gain_all_occupied_titles = { who = FROM type = invasion }
					vassalize_or_take_under_title_destroy_duchies = {
						title = PREV
						enemy = FROM
						is_crusade = yes
						type = invasion
					}
					# Settle the special invasion forces
					disband_event_forces = prepared_invasion
					any_demesne_title = {
						limit = { tier = BARON }
						remove_holding_modifier = recently_conquered
						refill_holding_levy = yes
					}
				}
				if = {
					limit = { FROM = { is_liege_or_above = ROOT } }
					FROM = { imprison = ROOT }
				}
			}
		}

		pf_liege_change_under_title_end_effect = yes
	}

	on_fail = {
		FROM = {
			prestige = 200
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		ROOT = {
			prestige = -300
			piety = -100
			hidden_tooltip = {
				disband_event_forces = prepared_invasion
			}
			religion_authority = {
				modifier = lost_viking_invasion
			}
		}
	}

	on_reverse_demand = {
		FROM = {
			imperial_decadence_minus_1_effect = yes
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			prestige = -500
			piety = -250
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
			hidden_tooltip = {
				disband_event_forces = prepared_invasion
			}
			religion_authority = {
				modifier = lost_viking_invasion
			}
		}
		FROM = {
			prestige = 300
		}
		FROM = {
			if = {
				limit = {
					has_dlc = "Legacy of Rome"
					OR = {
						has_landed_title = e_byzantium
						has_landed_title = e_roman_empire
					}
						OR = {
							religion_group = christian
							religion_group = hellenic_pagan_group
						}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
			participation_scaled_prestige = 250
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 250 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = {
		factor = 1
		modifier = {
			factor = 0.9
			NOT = {
				capital_scope = {
					OR = {
						region = custom_north_sea
						region = custom_england
						region = custom_scotland
						region = custom_ireland
						region = custom_wales
						region = custom_livonia
						region = custom_muscovy
						region = custom_novgorod
						region = custom_rus
						region = custom_volga
					}
				}
			}
		}
		modifier = {
			factor = 0
			ROOT = { has_character_flag = no_invasions }
		}
		sufficient_treasury_for_war = yes
	}
}

# 33
pagan_subjugation = {
	name = CB_NAME_PAGAN_SUBJUGATION
	war_name = WAR_NAME_PAGAN_SUBJUGATION
	sprite = 8
	truce_days = 365
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes

	allowed_to_target_tributaries = no
	defender_unoccupied_warscore = yes

	sort_priority = 2000

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			mercenary = no
			lower_tier_than = EMPEROR
			OR = {
				AND = {
					is_pagan_religion = yes
					is_reformed_pagan_religion = no
				}
				AND = {
					has_dharmic_religion_trigger = yes
					OR = {
						culture_group = indo_aryan_group
						culture_group = dravidian_group
					}
				}
			}
			NOT = { same_realm = FROM }
			NOT = { is_liege_or_above = FROM }
			has_horde_culture = no # Should use tribal invasion instead
			OR = {
				NOT = { has_character_modifier = launched_subjugation }
				has_ambition = obj_become_king
			}
		}
		FROM = {
			#is either an unreformed pagan or is a reformed version of the attacker's religion
			#Alternatively ROOT and FROM must both be an Indian religion and culture
			in_revolt = no
			is_nomadic = no
			OR = {
				AND = {
					is_pagan_religion = yes
					OR = {
						is_reformed_pagan_religion = no
						ROOT = { is_reformed_pagan_religion = yes }
					}
				}
				AND = {
					has_dharmic_religion_trigger = yes
					OR = {
						culture_group = indo_aryan_group
						culture_group = dravidian_group
					}
				}
			}
			NOT = { is_offmap_governor = yes }
			#not already a defender in a subjugation war
			NOT = {
				any_war = {
					defender = { character = PREVPREV }
					OR = {
						using_cb = pagan_subjugation
						using_cb = nomad_subjugation
					}
				}
			}
		}
	}

	can_use_title = {
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}
		}
		ROOT = {
			capital_scope = {
				kingdom = { title = PREVPREVPREV }
			}
		}
		OR = {
			holder = ROOT
			ROOT = { lower_tier_than = KING }
		}
		#the ai will only attack neighbors (or those very close)
		OR = {
			ROOT = { ai = no }
			FROM = {
				OR = {
					any_realm_province = {
						kingdom = { title = PREVPREVPREV }
						any_neighbor_province = {
							owner = {
								OR = {
									is_liege_or_above = ROOT
									character = ROOT
								}
							}
						}
					}
					any_realm_province = {
						kingdom = { title = PREVPREVPREV }
						ROOT = {
							any_realm_province = {
								NOT = { distance = { where = PREVPREV value = 75 } }
								owner = {
									OR = {
										is_liege_or_above = PREVPREV
										character = PREVPREV
									}
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid_title = {
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_add = {
		if = {
			limit = {
				ROOT = { has_ambition = obj_become_king }
			}
			ROOT = {
				custom_tooltip = { text = PAGAN_SUBJ_NO_MODIFIER }
			}
		}
		if = {
			limit = {
				ROOT = { NOT = { has_ambition = obj_become_king } }
			}
			ROOT = {
				custom_tooltip = { text = PAGAN_SUBJ_ADD_MODIFIER }
				hidden_tooltip = {
					add_character_modifier = {
						name = launched_subjugation
						years = 100
						hidden = yes
					}
				}
			}
		}
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			piety = 100
		}
		ROOT = {
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			piety = -100
			prestige = -200
			pf_glory_minus2_effect = yes
			hidden_tooltip = {
				opinion = {
					modifier = opinion_subjugated
					who = ROOT
				}
				any_vassal = {
					opinion = {
						modifier = opinion_subjugated
						who = ROOT
					}
				}
			}
			if = {
				limit = {
					ROOT = { is_reformed_pagan_religion = yes }
					controls_religion = no
				}
				religion = ROOT # Reformed pagans are forced to convert back
			}
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their pagan subjugation of the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		empty_province_effect = yes
		pf_liege_change_under_title_begin_effect = yes

		# Usurp the target kingdom itself, if the enemy holds it
		if = {
			limit = {
				holder_scope = {
					character = FROM
				}
				NOT = { ROOT = { tier = EMPEROR } }
			}
			ROOT = { usurp_title = { target = PREV type = invasion } }
		}

		if = {
			# Take the enemy's duchies within the target kingdom, if we are the same or lower tier
			limit = {
				ROOT = {
					NOT = { higher_tier_than = FROM }
				}
			}
			FROM = {
				any_demesne_title = {
					limit = {
						tier = DUKE
						OR = {
							title = PREVPREV
							de_jure_liege_or_above = PREVPREV
						}
					}
					ROOT = { usurp_title = { target = PREV type = invasion } }
				}
			}
		}

		# Have I become the vassal of the loser due to taking a duchy or kingdom?
		if = {
			limit = {
				ROOT = {
					is_liege_or_above = FROM
				}
			}
			ROOT = {
				set_defacto_liege = ROOT
				pf_liege_change_effect = yes
			}
		}

		# Vassalize the rest
		custom_tooltip = {
			text = pagan_subjugation_tip
			hidden_tooltip = {
				ROOT = {
					subjugate_or_take_under_title = { # If the target only has territory within the kingdom, he is simply vassalized
						title = PREV
						enemy = FROM
					}
				}
			}
		}

		pf_liege_change_under_title_end_effect = yes
	}

	on_invalidation = {
		ROOT = {
			remove_character_modifier = launched_subjugation
		}
	}

	on_fail = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			piety = 50
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		ROOT = {
			piety = -100
		}
	}

	on_reverse_demand = {
		ROOT = {
			piety = -100
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
			pf_glory_minus2_effect = yes
		}
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			piety = 100
			pf_glory_plus2_effect = yes
		}
		FROM = {
			if = {
				limit = {
					has_dlc = "Legacy of Rome"
					OR = {
						has_landed_title = e_byzantium
						has_landed_title = e_roman_empire
					}
						OR = {
							religion_group = christian
							religion_group = hellenic_pagan_group

						}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = { #Focus on Coronation first.
			factor = 0.1
			has_dlc = "Holy Fury"
			ROOT = {
				is_feudal = yes
				OR = {
					religion = catholic
					religion = fraticelli
				}
				is_crowned_trigger = no
			}
		}
		modifier = {
			factor = 0
			FROM = {
				NOT = {
					any_realm_province = {
						kingdom = { title = PREVPREVPREV }
						any_neighbor_province = { owner = { same_realm = ROOT } }
					}
				}
			}
			ROOT = {
				NOT = {
					any_realm_province = {
						TECH_NAVAL = 1
						port = yes
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				culture = hungarian
				has_global_flag = magyar_1066_invasion
			}
		}
		# Try to guide the Hordes in the right direction
		modifier = {
			factor = 0.1
			ROOT = {
				OR = {
					dynasty = 613 # Seljuks
					dynasty = 800 # Timurids
					primary_title = { title = e_il-khanate }
				}
			}
			OR = {
				location = {
					NOR = {
						region = world_europe_south_east
						region = world_asia_minor
						region = world_middle_east
						region = world_persia
					}
				}
				FROM = {
					primary_title = { title = e_golden_horde }
					NOT = { year = 1300 }
				}
			}
		}
		modifier = {
			factor = 0.1
			ROOT = { culture = hungarian }
			capital_scope = {
				OR = {
					region = custom_cuman
					region = custom_volga
					region = custom_alania
					region = custom_novgorod
					region = custom_muscovy
					region = custom_rus
				}
			}
		}
		modifier = {
			factor = 0.1
			ROOT = { culture = khazar }
			capital_scope = {
				OR = {
					region = world_steppe_tarim
					region = world_steppe_east
					region = custom_cuman
					region = custom_perm
					region = custom_volga
				}
			}
		}
		modifier = {
			factor = 2.0
			ROOT = { culture = hungarian }
			capital_scope = {
				OR = {
					region = custom_bulgaria
					region = custom_carpathia
				}
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 34
peasant_revolt = {
	name = CB_NAME_PEASANT_CONQUEST
	war_name = WAR_NAME_PEASANT_CONQUEST
	sprite = 16
	truce_days = 365
	hostile_against_others = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	is_independence = yes

	can_use = {
		ROOT = { NOT = { has_character_modifier = holy_truce_timer } }
		FROM = { NOT = { has_character_modifier = holy_truce_timer } }
		ROOT = {
			primary_title = { temporary = yes } # Revolter or adventurer trigger
			war = no
			NOT = { is_liege_or_above = FROM }
			mercenary = no
		}
	}

	can_use_title = {
		tier = count
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their peasant revolt for the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			hidden_tooltip = {
				wealth = 100
				if = {
					limit = { dynasty = none }
					dynasty = father_bastard
				}
			}
		}
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = revolt }
		ROOT = { set_defacto_liege = ROOT }
		FROM = {
			prestige = -100
			clr_character_flag = has_current_revolt
		}
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail_title = {
		FROM = {
			clr_character_flag = has_current_revolt
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = {
			imprison = FROM
			hidden_tooltip = {
				add_character_modifier = {
					name = broken_spirit
					days = 3650
				}
			}
		}
	}

	on_reverse_demand = {
		FROM = { add_character_modifier = { name = victory_timer duration = 1 hidden = yes } }
		FROM = {
			prestige = 100
			clr_character_flag = has_current_revolt
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor
					who = ROOT
					months = 1200
				}
				add_character_modifier = {
					name = crushed_major_revolt
					days = 3650
				}
			}
		}
		ROOT = {
			imprison = FROM
			hidden_tooltip = {
				add_character_modifier = {
					name = broken_spirit
					days = 3650
				}
			}
		}
	}

	on_invalidation = {
		log = "CB(peasant_revolt): INVALIDATED: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 35
heretic_revolt = {
	name = CB_NAME_HERETIC_UPRISING
	war_name = WAR_NAME_HERETIC_UPRISING
	sprite = 7
	truce_days = 365
	hostile_against_others = yes
	attacker_can_call_allies = no
	defender_can_call_allies = no
	can_ask_to_join_war = no
	check_de_jure_tier = DUKE

	can_use = {
		ROOT = { NOT = { has_character_modifier = holy_truce_timer } }
		FROM = { NOT = { has_character_modifier = holy_truce_timer } }
		ROOT = { has_character_flag = heretic_revolter }
	}

	can_use_title = {
		tier = DUKE
	}

	is_valid_title = {
		FROM = {
			NOT = { religion = ROOT }
			any_realm_province = {
				religion = ROOT
				duchy = {
					title = PREVPREVPREV
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}


	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their heretic revolt for the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			hidden_tooltip = {
				wealth = 100
				if = {
					limit = { dynasty = none }
					dynasty = father_bastard
				}
			}
			prestige = 200
			piety = 100
			occupy_minors_of_occupied_settlements = FROM
			gain_all_occupied_titles = { who = FROM type = revolt }
			clr_character_flag = heretic_revolter
		}

		dejure_liege_title  = {
			any_direct_de_jure_vassal_title = {
				limit = {
					tier = COUNT
					location = { religion = ROOT }
					holder_scope = { same_realm = FROM }
				}
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = revolt }
			}
		}

		FROM = {
			prestige = -500
			piety = -500
			clr_character_flag = has_current_revolt
			religion_authority = {
				modifier = lost_heretic_revolt
			}
		}
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = {
			imprison = FROM
			clr_character_flag = heretic_revolter
			hidden_tooltip = {
				add_character_modifier = {
					name = broken_spirit
					days = 3650
				}
			}
		}
		FROM = {
			prestige = 50
			piety = 100
			clr_character_flag = has_current_revolt
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor
					who = ROOT
					months = 1200
				}
			}
			religion_authority = {
				modifier = won_heretic_revolt
			}
		}
	}

	on_reverse_demand = {
		FROM = { add_character_modifier = { name = victory_timer duration = 1 hidden = yes } }
		ROOT = {
			imprison = FROM
			clr_character_flag = heretic_revolter
			hidden_tooltip = {
				add_character_modifier = {
					name = broken_spirit
					days = 3650
				}
			}
		}
		FROM = {
			prestige = 100
			piety = 200
			clr_character_flag = has_current_revolt
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor
					who = ROOT
					months = 1200
				}
				add_character_modifier = {
					name = crushed_major_revolt
					days = 3650
				}
			}
			religion_authority = {
				modifier = won_heretic_revolt
			}
		}
	}

	on_reverse_demand_title = {
		hidden_tooltip = {
			location = {
				add_province_modifier = {
					name = rebellion_heretic_province
					duration = 5
				}
				province_event = { id = TOG.1032 days = 1 }
			}
		}
	}

	on_invalidation = {
		log = "CB(heretic_revolt): INVALIDATED: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 150
	}
}

# 36
religious_revolt = {
	name = CB_NAME_HERETIC_UPRISING
	war_name = WAR_NAME_HERETIC_UPRISING
	sprite = 7
	truce_days = 365
	hostile_against_others = yes
	attacker_can_call_allies = no
	defender_can_call_allies = no
	can_ask_to_join_war = no
	check_de_jure_tier = DUKE

	can_use = {
		ROOT = { has_character_flag = religious_revolter }
	}

	can_use_title = {
		tier = DUKE
	}

	is_valid_title = {
		FROM = {
			NOT = { religion = ROOT }
			any_realm_province = {
				religion = ROOT
				duchy = {
					title = PREVPREVPREV
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their [Root.Religion.GetName] religious revolt for the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			hidden_tooltip = {
				if = {
					limit = { dynasty = none }
					dynasty = father_bastard
				}
				wealth = 100
			}
			prestige = 200
			piety = 100
			occupy_minors_of_occupied_settlements = FROM
			gain_all_occupied_titles = { who = FROM type = revolt }
			clr_character_flag = religious_revolter
		}

		dejure_liege_title  = {
			any_direct_de_jure_vassal_title = {
				limit = {
					tier = COUNT
					location = { religion = ROOT }
					holder_scope = { same_realm = FROM }
				}
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = revolt }
			}
		}

		FROM = {
			prestige = -500
			piety = -500
			clr_character_flag = has_current_revolt
			religion_authority = {
				modifier = lost_religious_revolt
			}
		}
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = {
			imprison = FROM
			clr_character_flag = religious_revolter
			hidden_tooltip = {
				add_character_modifier = {
					name = broken_spirit
					days = 3650
				}
			}
		}
		FROM = {
			prestige = 50
			piety = 100
			clr_character_flag = has_current_revolt
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor
					who = ROOT
					months = 1200
				}
			}
			religion_authority = {
				modifier = won_religious_revolt
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			imprison = FROM
			clr_character_flag = religious_revolter
			hidden_tooltip = {
				add_character_modifier = {
					name = broken_spirit
					days = 3650
				}
			}
		}
		FROM = {
			prestige = 100
			piety = 200
			clr_character_flag = has_current_revolt
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor
					who = ROOT
					months = 1200
				}
				add_character_modifier = {
					name = crushed_revolt
					days = 3650
				}
			}
			religion_authority = {
				modifier = won_religious_revolt
			}
		}
	}

	on_reverse_demand_title = {
		hidden_tooltip = {
			location = {
				add_province_modifier = {
					name = rebellion_religion_province
					duration = 5
				}
				province_event = { id = TOG.1072 days = 1 }
			}
		}
	}

	on_invalidation = {
		log = "CB(religious_revolt): INVALIDATED: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 150
	}
}

# 37
liberation_revolt = {
	name = CB_NAME_LIBERATION_REVOLT
	war_name = WAR_NAME_LIBERATION_REVOLT
	sprite = 16
	truce_days = 365
	hostile_against_others = yes
	check_de_jure_tier = KING # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character.
	press_claim = yes
	can_ask_to_join_war = no
	is_independence = yes
	apply_short_occ_mod = no

	can_use = {
		ROOT = { NOT = { has_character_modifier = holy_truce_timer } }
		FROM = { NOT = { has_character_modifier = holy_truce_timer } }
		ROOT = { has_character_flag = nationalist_rebel }
	}

	can_use_title = {
		tier = king
		culture = ROOT
	}

	is_valid = {
		ROOT = {
			NOT = { culture = FROM }
			has_character_flag = nationalist_rebel
		}
	}

	is_valid_title = {
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		log = "CB(liberation_revolt): VICTORY: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"

		# add victory modifier for the 'Win a War' ambition
		any_attacker = { add_character_modifier = { name = victory_timer duration = 1 hidden = yes } }

		ROOT = {
			# create new dynasty if the revolter is lowborn
			hidden_tooltip = {
				if = {
					limit = { dynasty = none }
					dynasty = father_bastard
				}
				if = {
					limit = { has_character_flag = began_revolt }
					wealth = 100
				}
			}
			# give liberator nickname
			if = {
				limit = { has_nickname = no }
				give_nickname = nick_the_liberator
			}
			prestige = 500
			hidden_tooltip = { disband_event_forces = nationalist_rebels }
		}
		FROM = {
			prestige = -500
			imperial_decadence_plus_1_effect = yes
			clr_character_flag = has_current_revolt
		}
		hidden_tooltip = {
			any_attacker = {
				limit = {
					has_character_flag = nationalist_rebel
					NOT = { character = ROOT }
					NOT = { is_liege_or_above = ROOT }
				}
				clr_character_flag = nationalist_rebel
				if = {
					limit = { has_any_opinion_modifier = liberation_revolt_against }
					random_opinion_modifier_target = {
						limit = { reverse_has_opinion_modifier = { who = PREV modifier = liberation_revolt_against } }
						log = "----> [Prev.GetBestName] is a rebel who has won against [This.GetBestName] (Liberation Revolt)"
						reverse_remove_opinion = { who = PREV modifier = liberation_revolt_against }
					}
				}
				set_character_flag = will_vassalize
			}
			ROOT = {
				any_realm_lord = {
					limit = {
						has_character_flag = nationalist_rebel
						NOT = { character = PREV }
					}
					clr_character_flag = nationalist_rebel
					if = {
						limit = { has_any_opinion_modifier = liberation_revolt_against }
						random_opinion_modifier_target = {
							limit = { reverse_has_opinion_modifier = { who = PREV modifier = liberation_revolt_against } }
							log = "----> [Prev.GetBestName] is a rebel who has won against [This.GetBestName] (Liberation Revolt)"
							reverse_remove_opinion = { who = PREV modifier = liberation_revolt_against }
						}
					}
					set_character_flag = will_vassalize
				}
			}
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				participation_scaled_prestige = 250
			}
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their [Root.Culture.GetName] liberation revolt of [This.GetName] against [From.GetBestName] (ID: [From.GetID])"
		#tooltips for the CB results
		ROOT = { custom_tooltip = { text = LIBERATION_TOOLTIP } }
		if = {
			limit = {
				has_holder = no
				any_previous_holder = { always = yes }
				ROOT = { NOT = { num_of_count_titles = 5 } }
			}
			ROOT = { custom_tooltip = { text = LIBERATION_TOOLTIP2 } }
		}
		any_attacker = {
			limit = {
				has_character_flag = nationalist_rebel
				NOT = { character = ROOT }
				NOT = { is_liege_or_above = ROOT }
			}
			custom_tooltip = { text = LIBERATION_TOOLTIP4 }
		}
		ROOT = {
			any_realm_lord = {
				limit = {
					has_character_flag = nationalist_rebel
					NOT = { character = PREV }
				}
				custom_tooltip = { text = LIBERATION_TOOLTIP4 }
			}
		}

		pf_liege_change_under_title_begin_effect = yes

		hidden_tooltip = {
			#usurp any titles in the kingdom held by the top liege or any vassal who is
			#his culture, not the attacker's culture group, or their capital is elsewhere
			any_de_jure_vassal_title = {
				limit = {
					tier = DUKE
					holder_scope = {
						same_realm = FROM
						OR = {
							character = FROM
							culture = FROM
							NOT = { culture_group = ROOT }
							NOT = { capital_scope = { kingdom = { title = PREVPREVPREVPREV } } }
						}
					}
				}
				set_title_flag = nationalist_usurp
			}
			any_de_jure_vassal_title = {
				limit = {
					tier = BARON
					is_nomadic = no
					holder_scope = {
						same_realm = FROM
						OR = {
							character = FROM
							culture = FROM
							NOT = { culture_group = ROOT }
							NOT = { capital_scope = { kingdom = { title = PREVPREVPREVPREV } } }
						}
					}
				}
				log = "----> [Root.GetBestName] usurps the [This.GetFullName] (Liberation Revolt)"
				usurp_title = { target = ROOT type = revolt }
			}
			any_de_jure_vassal_title = {
				limit = {
					tier = COUNT
					holder_scope = {
						same_realm = FROM
						OR = {
							character = FROM
							culture = FROM
							NOT = { culture_group = ROOT }
							NOT = { capital_scope = { kingdom = { title = PREVPREVPREVPREV } } }
						}
					}
				}
				log = "----> [Root.GetBestName] usurps the [This.GetFullName] (Liberation Revolt)"
				usurp_title = { target = ROOT type = revolt }
			}
			any_title = {
				limit = { has_title_flag = nationalist_usurp }
				clr_title_flag = nationalist_usurp
				log = "----> [Root.GetBestName] usurps the [This.GetFullName] (Liberation Revolt)"
				usurp_title = { target = ROOT type = revolt }
			}
		}
		ROOT = {
			#take kingdom title if it is owned by the top liege or a vassal
			if = {
				limit = {
					PREV = {
						has_holder = yes
						OR = {
							holder_scope = { character = FROM }
							holder_scope = { any_liege = { character = FROM } }
						}
					}
				}
				log = "----> [Root.GetBestName] usurps the [Prev.GetFullName] (Liberation Revolt)"
				usurp_title = { target = PREV type = revolt }
			}
			#take kingdom title if nobody holds it (but it was previously created)
			#and at least five counties are held
			if = {
				limit = {
					num_of_count_titles = 5
					PREV = {
						has_holder = no
						any_previous_holder = { always = yes }
					}
				}
				usurp_title = { target = PREV type = revolt }
			}
		}
		hidden_tooltip = {
			#vassalize any lower tier vassals of the same culture group
			any_de_jure_vassal_title = {
				limit = {
					holder_scope = {
						top_liege = { character = FROM }
						lower_real_tier_than = ROOT
						NOT = {
							any_liege = {
								culture_group = ROOT
								NOT = { character = FROM }
							}
						}
					}
				}
				holder_scope = {
					log = "----> [This.GetBestName] is vassalized by [Root.GetBestName] (Liberation Revolt)"
					set_defacto_liege = ROOT
				}
			}
			#usurp any vassals who cannot be vassalized
			any_de_jure_vassal_title = {
				limit = {
					holder_scope = {
						top_liege = { character = FROM }
						NOT = { lower_real_tier_than = ROOT }
					}
				}
				log = "----> [Root.GetBestName] usurps the [This.GetFullName] (Liberation Revolt)"
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = revolt }
			}
		}
		ROOT = {
			set_defacto_liege = THIS
			clr_character_flag = nationalist_rebel
		}
		#vassalize any allies and set opinions
		hidden_tooltip = {
			any_attacker = {
				limit = {
					has_character_flag = will_vassalize
					NOT = { character = ROOT }
					NOT = { is_liege_or_above = ROOT }
				}
				log = "----> [This.GetBestName] is a fellow rebel and is thus vassalized to [Root.GetBestName] (Liberation Revolt)"
				clr_character_flag = will_vassalize
				if = {
					limit = { lower_real_tier_than = ROOT }
					set_defacto_liege = ROOT
				}
				if = {
					limit = { NOT = { lower_real_tier_than = ROOT } }
					opinion = { modifier = in_non_aggression_pact years = 20 who = ROOT origin_description = HELPED_WIN_REVOLT }
					reverse_opinion = { modifier = in_non_aggression_pact years = 20 who = ROOT origin_description = HELPED_WIN_REVOLT }
				}
				reverse_opinion = { who = ROOT modifier = opinion_very_grateful years = 20 }
				opinion = { who = ROOT modifier = opinion_very_grateful years = 20 }
			}
			ROOT = {
				any_realm_lord = {
					limit = { has_character_flag = will_vassalize }
					log = "----> [This.GetBestName] is a fellow rebel and is thus vassalized to [Root.GetBestName] (Liberation Revolt)"
					clr_character_flag = will_vassalize
					if = {
						limit = { lower_real_tier_than = PREV }
						set_defacto_liege = PREV
					}
					if = {
						limit = { NOT = { lower_real_tier_than = PREV } }
						opinion = { modifier = in_non_aggression_pact years = 20 who = PREV origin_description = HELPED_WIN_REVOLT }
						reverse_opinion = { modifier = in_non_aggression_pact years = 20 who = PREV origin_description = HELPED_WIN_REVOLT }
					}
					reverse_opinion = { who = PREV modifier = opinion_very_grateful years = 20 }
					opinion = { who = PREV modifier = opinion_very_grateful years = 20 }
				}
			}
		}

		pf_liege_change_under_title_end_effect = yes

		ROOT = {
			hidden_tooltip = {
				# destroy their revolt title
				any_demesne_title = {
					limit = { temporary = yes }
					unsafe_destroy_landed_title = THIS
				}
				# make sure revolter doesn't have an unacceptable government type
				if = {
					limit = { has_character_flag = began_revolt }
					clr_character_flag = began_revolt
					landless_government_check_effect = yes
				}
			}
		}
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		log = "CB(liberation_revolt): WHITEPEACE: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"

		# re-vassalize rebels
		hidden_tooltip = {
			any_attacker = {
				limit = {
					has_character_flag = nationalist_rebel
					NOT = { has_character_flag = began_revolt }
					NOT = { is_liege_or_above = ROOT }
					NOT = { character = ROOT }
				}
				clr_character_flag = nationalist_rebel
				participation_scaled_prestige = -200
				reverse_opinion = { who = FROM modifier = opinion_civil_war_loser months = 60 }
				opinion = { who = FROM modifier = opinion_coerced_into_leaving_faction months = 60 }
				if = {
					limit = { NOT = { has_any_opinion_modifier = liberation_revolt_against } }
					log = "----> [This.GetBestName] is a rebel who has been re-vasslized to [From.GetBestName] (Liberation Revolt)"
					set_defacto_liege = FROM
				}
				if = {
					limit = { has_any_opinion_modifier = liberation_revolt_against }
					random_opinion_modifier_target = {
						limit = { reverse_has_opinion_modifier = { who = PREV modifier = liberation_revolt_against } }
						log = "----> [Prev.GetBestName] is a rebel who has been re-vasslized to [This.GetBestName] (Liberation Revolt)"
						reverse_remove_opinion = { who = PREV modifier = liberation_revolt_against }
						set_defacto_vassal = PREV
					}
				}
			}
			ROOT = {
				# first re-vassalize vassals
				any_realm_lord = {
					limit = {
						has_character_flag = nationalist_rebel
						NOT = { has_character_flag = began_revolt }
					}
					clr_character_flag = nationalist_rebel
					if = {
						limit = { NOT = { has_any_opinion_modifier = liberation_revolt_against } }
						log = "----> [This.GetBestName] is a rebel who has been re-vasslized to [From.GetBestName] (Liberation Revolt)"
						set_defacto_liege = FROM
					}
					if = {
						limit = { has_any_opinion_modifier = liberation_revolt_against }
						random_opinion_modifier_target = {
							limit = { reverse_has_opinion_modifier = { who = PREV modifier = liberation_revolt_against } }
							log = "----> [Prev.GetBestName] is a rebel who has been re-vasslized to [This.GetBestName] (Liberation Revolt)"
							reverse_remove_opinion = { who = PREV modifier = liberation_revolt_against }
							set_defacto_vassal = PREV
						}
					}
				}
				# then destroy their revolt title
				any_demesne_title = {
					limit = { temporary = yes }
					owner = {
						any_courtier = {
							banish = yes
						}
					}
					unsafe_destroy_landed_title = THIS
				}
				if = {
					limit = {
						has_character_flag = nationalist_rebel
						NOT = { has_character_flag = began_revolt }
					}
					clr_character_flag = nationalist_rebel
					if = {
						limit = { NOT = { has_any_opinion_modifier = liberation_revolt_against } }
						log = "----> [This.GetBestName] is a rebel who has been re-vasslized to [From.GetBestName] (Liberation Revolt)"
						set_defacto_liege = FROM
					}
					if = {
						limit = { has_any_opinion_modifier = liberation_revolt_against }
						random_opinion_modifier_target = {
							limit = { reverse_has_opinion_modifier = { who = PREV modifier = liberation_revolt_against } }
							log = "----> [Prev.GetBestName] is a rebel who has been re-vasslized to [This.GetBestName] (Liberation Revolt)"
							reverse_remove_opinion = { who = PREV modifier = liberation_revolt_against }
							set_defacto_vassal = PREV
						}
					}
				}
			}
		}

		FROM = {
			clr_character_flag = has_current_revolt
			prestige = 200
			hidden_tooltip = {
				opinion = { modifier = opinion_rebel_traitor who = ROOT months = 1200 }
			}
		}

		ROOT = {
			prestige = -200
			hidden_tooltip = {
				disband_event_forces = nationalist_rebels
				disband_event_forces = nationalist_rebels_1
			}
			if = {
				limit = { NOT = { has_character_flag = began_revolt } }
				random_courtier = {
					limit = { has_character_flag = began_revolt }
					clr_character_flag = began_revolt
					imprison = FROM
					hidden_tooltip = {
						reverse_opinion = { modifier = opinion_rebel_traitor who = FROM months = 1200 }
						add_character_modifier = { name = broken_spirit days = 3650 }
						remove_trait = inspiring_leader
					}
				}
			}
			if = {
				limit = { has_character_flag = began_revolt }
				imprison = FROM
				clr_character_flag = nationalist_rebel
				clr_character_flag = began_revolt
				hidden_tooltip = {
					reverse_opinion = { modifier = opinion_rebel_traitor who = FROM months = 1200 }
					add_character_modifier = { name = broken_spirit days = 3650 }
					remove_trait = inspiring_leader
				}
			}
		}
	}

	on_reverse_demand = {
		log = "CB(liberation_revolt): DEFEAT: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"

		FROM = {
			clr_character_flag = has_current_revolt
			prestige = 200
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			hidden_tooltip = {
				opinion = { modifier = opinion_rebel_traitor who = ROOT months = 1200 }
				add_character_modifier = { name = crushed_major_revolt days = 3650 }
			}
		}

		# re-vassalize rebels
		hidden_tooltip = {
			any_attacker = {
				limit = {
					has_character_flag = nationalist_rebel
					NOT = { has_character_flag = began_revolt }
					NOT = { is_liege_or_above = ROOT }
					NOT = { character = ROOT }
				}
				clr_character_flag = nationalist_rebel
				participation_scaled_prestige = -200
				reverse_opinion = { who = FROM modifier = opinion_civil_war_loser months = 60 }
				opinion = { who = FROM modifier = opinion_coerced_into_leaving_faction months = 60 }
				imprison = FROM
				if = {
					limit = { NOT = { has_any_opinion_modifier = liberation_revolt_against } }
					log = "----> [This.GetBestName] is a rebel who has been re-vasslized to [From.GetBestName] (Liberation Revolt)"
					set_defacto_liege = FROM
				}
				if = {
					limit = { has_any_opinion_modifier = liberation_revolt_against }
					random_opinion_modifier_target = {
						limit = { reverse_has_opinion_modifier = { who = PREV modifier = liberation_revolt_against } }
						log = "----> [Prev.GetBestName] is a rebel who has been re-vasslized to [This.GetBestName] (Liberation Revolt)"
						reverse_remove_opinion = { who = PREV modifier = liberation_revolt_against }
						set_defacto_vassal = PREV
					}
				}
			}
			ROOT = {
				# first re-vassalize vassals
				any_realm_lord = {
					limit = {
						has_character_flag = nationalist_rebel
						NOT = { has_character_flag = began_revolt }
					}
					clr_character_flag = nationalist_rebel
					participation_scaled_prestige = -200
					reverse_opinion = { who = FROM modifier = opinion_civil_war_loser months = 60 }
					opinion = { who = FROM modifier = opinion_coerced_into_leaving_faction months = 60 }
					imprison = FROM
					if = {
						limit = { NOT = { has_any_opinion_modifier = liberation_revolt_against } }
						log = "----> [This.GetBestName] is a rebel who has been re-vasslized to [From.GetBestName] (Liberation Revolt)"
						set_defacto_liege = FROM
					}
					if = {
						limit = { has_any_opinion_modifier = liberation_revolt_against }
						random_opinion_modifier_target = {
							limit = { reverse_has_opinion_modifier = { who = PREV modifier = liberation_revolt_against } }
							log = "----> [Prev.GetBestName] is a rebel who has been re-vasslized to [This.GetBestName] (Liberation Revolt)"
							reverse_remove_opinion = { who = PREV modifier = liberation_revolt_against }
							set_defacto_vassal = PREV
						}
					}
				}
				# then destroy their revolt title
				any_demesne_title = {
					limit = { temporary = yes }
					unsafe_destroy_landed_title = THIS
				}
				if = {
					limit = {
						has_character_flag = nationalist_rebel
						NOT = { has_character_flag = began_revolt }
					}
					clr_character_flag = nationalist_rebel
					reverse_opinion = { who = FROM modifier = opinion_civil_war_loser months = 60 }
					opinion = { who = FROM modifier = opinion_coerced_into_leaving_faction months = 60 }
					if = {
						limit = { NOT = { has_any_opinion_modifier = liberation_revolt_against } }
						log = "----> [This.GetBestName] is a rebel who has been re-vasslized to [From.GetBestName] (Liberation Revolt)"
						set_defacto_liege = FROM
					}
					if = {
						limit = { has_any_opinion_modifier = liberation_revolt_against }
						random_opinion_modifier_target = {
							limit = { reverse_has_opinion_modifier = { who = PREV modifier = liberation_revolt_against } }
							log = "----> [Prev.GetBestName] is a rebel who has been re-vasslized to [This.GetBestName] (Liberation Revolt)"
							reverse_remove_opinion = { who = PREV modifier = liberation_revolt_against }
							set_defacto_vassal = PREV
						}
					}
				}
			}
		}

		ROOT = {
			prestige = -200
			hidden_tooltip = {
				disband_event_forces = nationalist_rebels
				disband_event_forces = nationalist_rebels_1
			}
			if = {
				limit = { NOT = { has_character_flag = began_revolt } }
				clr_character_flag = nationalist_rebel
				imprison = FROM
				hidden_tooltip = {
					reverse_opinion = { who = FROM modifier = opinion_rebel_traitor months = 60 }
				}
				random_courtier = {
					limit = { has_character_flag = began_revolt }
					clr_character_flag = began_revolt
					imprison = FROM
					hidden_tooltip = {
						reverse_opinion = { modifier = opinion_rebel_traitor who = FROM months = 1200 }
						add_character_modifier = { name = broken_spirit days = 3650 }
						remove_trait = inspiring_leader
					}
				}
			}
			if = {
				limit = { has_character_flag = began_revolt }
				imprison = FROM
				clr_character_flag = nationalist_rebel
				clr_character_flag = began_revolt
				hidden_tooltip = {
					reverse_opinion = { modifier = opinion_rebel_traitor who = FROM months = 1200 }
					add_character_modifier = { name = broken_spirit days = 3650 }
					remove_trait = inspiring_leader
				}
			}
		}
	}

	on_invalidation = {
		log = "CB(liberation_revolt): INVALIDATED: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"

		# re-vassalize rebels
		hidden_tooltip = {
			any_attacker = {
				limit = {
					has_character_flag = nationalist_rebel
					NOT = { has_character_flag = began_revolt }
					NOT = { is_liege_or_above = ROOT }
					NOT = { character = ROOT }
				}
				clr_character_flag = nationalist_rebel
				participation_scaled_prestige = -200
				reverse_opinion = { who = FROM modifier = opinion_civil_war_loser months = 60 }
				opinion = { who = FROM modifier = opinion_coerced_into_leaving_faction months = 60 }
				if = {
					limit = { NOT = { has_any_opinion_modifier = liberation_revolt_against } }
					log = "----> [This.GetBestName] is a rebel who has been re-vasslized to [From.GetBestName] (Liberation Revolt)"
					set_defacto_liege = FROM
				}
				if = {
					limit = { has_any_opinion_modifier = liberation_revolt_against }
					random_opinion_modifier_target = {
						limit = { reverse_has_opinion_modifier = { who = PREV modifier = liberation_revolt_against } }
						log = "----> [Prev.GetBestName] is a rebel who has been re-vasslized to [This.GetBestName] (Liberation Revolt)"
						reverse_remove_opinion = { who = PREV modifier = liberation_revolt_against }
						set_defacto_vassal = PREV
					}
				}
			}
			ROOT = {
				# first re-vassalize vassals
				any_realm_lord = {
					limit = {
						has_character_flag = nationalist_rebel
						NOT = { has_character_flag = began_revolt }
					}
					clr_character_flag = nationalist_rebel
					if = {
						limit = { NOT = { has_any_opinion_modifier = liberation_revolt_against } }
						log = "----> [This.GetBestName] is a rebel who has been re-vasslized to [From.GetBestName] (Liberation Revolt)"
						set_defacto_liege = FROM
					}
					if = {
						limit = { has_any_opinion_modifier = liberation_revolt_against }
						random_opinion_modifier_target = {
							limit = { reverse_has_opinion_modifier = { who = PREV modifier = liberation_revolt_against } }
							log = "----> [Prev.GetBestName] is a rebel who has been re-vasslized to [This.GetBestName] (Liberation Revolt)"
							reverse_remove_opinion = { who = PREV modifier = liberation_revolt_against }
							set_defacto_vassal = PREV
						}
					}
				}
				# then destroy their revolt title
				any_demesne_title = {
					limit = { temporary = yes }
					unsafe_destroy_landed_title = THIS
				}
				if = {
					limit = {
						has_character_flag = nationalist_rebel
						NOT = { has_character_flag = began_revolt }
					}
					clr_character_flag = nationalist_rebel
					if = {
						limit = { NOT = { has_any_opinion_modifier = liberation_revolt_against } }
						log = "----> [This.GetBestName] is a rebel who has been re-vasslized to [From.GetBestName] (Liberation Revolt)"
						set_defacto_liege = FROM
					}
					if = {
						limit = { has_any_opinion_modifier = liberation_revolt_against }
						random_opinion_modifier_target = {
							limit = { reverse_has_opinion_modifier = { who = PREV modifier = liberation_revolt_against } }
							log = "----> [Prev.GetBestName] is a rebel who has been re-vasslized to [This.GetBestName] (Liberation Revolt)"
							reverse_remove_opinion = { who = PREV modifier = liberation_revolt_against }
							set_defacto_vassal = PREV
						}
					}
				}
			}
		}

		FROM = {
			clr_character_flag = has_current_revolt
		}

		ROOT = {
			hidden_tooltip = {
				disband_event_forces = nationalist_rebels
				disband_event_forces = nationalist_rebels_1
			}
			if = {
				limit = { NOT = { has_character_flag = began_revolt } }
				random_courtier = {
					limit = { has_character_flag = began_revolt }
					clr_character_flag = began_revolt
				}
			}
			if = {
				limit = { has_character_flag = began_revolt }
				clr_character_flag = nationalist_rebel
				clr_character_flag = began_revolt
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 38
duchy_adventure = {
	name = CB_NAME_DUCHY_ADVENTURE
	war_name = WAR_DUCHY_ADVENTURE
	sprite = 9
	truce_days = 3650
	hostile_against_others = yes
	check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character.

	can_use = {
		ROOT = { NOT = { has_character_modifier = holy_truce_timer } }
		FROM = { NOT = { has_character_modifier = holy_truce_timer } }
		ROOT = { has_character_flag = duchy_adventurer }
	}

	is_valid = {
		always = yes
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			prestige = 250
			hidden_tooltip = {
				wealth = 500
				clr_character_flag = duchy_adventurer
			}
		}
		FROM = {
			prestige = -250
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their duchy adventure for the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		empty_province_effect = yes
		pf_liege_change_under_title_begin_effect = yes

		custom_tooltip = {
			text = other_invasion_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						type = host
					}
				}
			}
		}

		pf_liege_change_under_title_end_effect = yes

		ROOT = {
			hidden_tooltip = {
				# Special case: Seljuk succeeds in his first conquest
				if = {
					limit = {
						has_character_flag = seljuk_himself
					}
					narrative_event = {
						id = 60206
						days = 1
					}
				}

				# Special case: Timur succeeds in his first conquest
				if = {
					limit = {
						has_character_flag = timurid_himself
					}
					narrative_event = {
						id = 60306
						days = 1
					}
				}

				# Special case: Sabuktigin succeeds in his first conquest
				if = {
					limit = {
						has_character_flag = sabuktigin_himself
					}
					narrative_event = {
						id = 60406
						days = 1
					}
				}

				# Special case: Rollo succeeds in his invasion of Normandy
				if = {
					limit = {
						has_character_flag = is_rollo
					}
					character_event = {
						id = Plus.2752
						days = 1
					}
				}
				# Special case: Sultanate of Rum creator succeeds in his first conquest
				if = {
					limit = {
						has_character_flag = rum_creator
					}
					character_event = {
						id = 60610
						days = 600
						random = 300
					}
				}
			}
		}

		ROOT = {
			hidden_tooltip = {
				# destroy their revolt title
				any_demesne_title = {
					limit = { temporary = yes }
					unsafe_destroy_landed_title = THIS
				}
				# make sure revolter doesn't have an unacceptable government type
				landless_government_check_effect = yes
			}
		}
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		FROM = {
			prestige = 100
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = {
			imprison = FROM
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = duchy_adventurer
			}
		}

		ROOT = { prestige = -100 }
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}

		FROM = {
			prestige = 250
			wealth = 100
		}

		ROOT = {
			imprison = FROM
			prestige = -250
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = duchy_adventurer
			}
		}
	}

	on_attacker_leader_death = {
		ROOT = {
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = duchy_adventurer
			}
		}
		end_war = invalid
	}

	on_invalidation = {
		log = "CB(duchy_adventure): INVALIDATED: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
		modifier = {
			factor = 0.25
			ROOT = { has_character_flag = is_rollo }
		}
	}
}

# 39
kingdom_adventure = {
	name = CB_NAME_DUCHY_ADVENTURE
	war_name = WAR_DUCHY_ADVENTURE
	sprite = 9
	truce_days = 3650
	hostile_against_others = yes
	check_de_jure_tier = KING # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character

	can_use = {
		ROOT = {
			OR = {
				has_character_flag = duchy_adventurer
				has_character_flag = rum_creator
			}
		}
	}

	is_valid = {
		always = yes
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			prestige = 500
			piety = 250
			hidden_tooltip = {
				clr_character_flag = duchy_adventurer
				remove_do_not_disturb_effect = yes
				if = {
					limit = {
						has_nickname = no
					}
					FROM = {
						save_event_target_as = nickname_target
					}
					ROOT = {
						save_event_target_as = nickname_receiver
					}
					if = {
						limit = {
							NOT = {
								has_character_flag = is_child_of_destiny
							}
						}
						random_list = {
							5 = { give_nickname = nick_the_victorious }
							5 = { give_nickname = nick_the_conqueror }
							5 = { give_nickname = nick_the_dragon }
							10 = { give_nickname = nick_the_rel_group }
							10 = { give_nickname = nick_the_tiger }
							10 = { give_nickname = nick_the_world_burner }
							10 = {
								give_nickname = nick_the_scourge_of_god
								modifier = {
									factor = 0
									event_target:nickname_target = { religion = ROOT }
								}
							}
						}
					}
				}
			}
		}
		FROM = {
			prestige = -500
			piety = -250
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = other_invasion_succ_tip
			hidden_tooltip = {

				if = { # Special stuff for player Child of Destiny (AI Children do not have this flag)
					limit = {
						ROOT = { has_character_flag = child_of_destiny_outwards_focus }
					}
					FROM = { # Ensure that the Child of Destiny always gets one County in the targeted Kingdom (mainly useful when testing with yesmen, but can also happen in rare occurences where the target is imprisoned)
						random_realm_title = {
							limit = {
								tier = COUNT
								de_jure_liege_or_above = PREVPREV
							}
							usurp_title = { target = ROOT type = host }
						}
					}
					ROOT = {
						liege = { save_event_target_as = old_liege_target}
						if = { # Abandon all old titles if you were a vassal
							limit = {
								independent = no
							}
							any_demesne_title = {
								limit = {
									NOR = {
										title = PREVPREV
										de_jure_liege_or_above = PREVPREV
									}
								}
								grant_title = event_target:old_liege_target
							}
							any_vassal = {
								limit = {
									capital_scope = {
										NOR = {
											title = PREVPREVPREV
											de_jure_liege_or_above = PREVPREVPREV
										}
									}
								}
								set_defacto_liege = event_target:old_liege_target
							}
						}
					}
				}

				FROM = { # The adventurer takes ANY demesne title, including the targeted Kingdom, within the area of the targeted kingdom
					any_demesne_title = {
						limit = {
							OR = {
								title = PREVPREV
								de_jure_liege_or_above = PREVPREV
							}
							NOT = { ROOT = { has_character_flag = rum_creator } }
						}
						usurp_title = { target = ROOT type = host }
					}
				}

				if = { # Claim the targeted Kingdom if it isn't held by anyone
					limit = {
						has_holder = no
					}
					usurp_title = { target = ROOT type = host }
				}

				if = { # Create a Kingdom if the adventurer does not have one by this point
					limit = {
						ROOT = {
							NOR = {
								any_demesne_title = {
									tier = KING
								}
								has_character_flag = rum_creator
							}
						}
					}
					if = {
						limit = {
							ROOT = {
								NOT = {
									has_character_flag = is_child_of_destiny
								}
							}
						}
						ROOT = {
							create_title = {
								tier = KING
								landless = no
								temporary = no
								custom_created = yes
								culture = ROOT
								holder = ROOT
								name = "INDIAN_MUSLIM_KINGDOM"
								base_title = PREV
								copy_title_laws = yes
							}
						}
					}
					else = {
						ROOT = {
							save_event_target_as = target_name
							create_title = {
								tier = KING
								landless = no
								temporary = no
								custom_created = yes
								culture = ROOT
								holder = ROOT
								name = "DESTINY_KINGDOM"
								base_title = PREV
								copy_title_laws = yes
							}
							capital_scope = {
								county = {
									save_event_target_as = coa_target
								}
							}
							primary_title = {
								set_coa = event_target:coa_target
							}
						}
					}
				}
				if = {
					limit = {
						ROOT = { has_character_flag = rum_creator }
					}
					k_rum = {
						grant_title = ROOT
					}
				}

				ROOT = { # Preserve Vassals under the targeted kingdom
					vassalize_or_take_under_title = { # Take all vassals held by the target under the title
						title = PREV
						enemy = FROM
						type = host
					}
					set_defacto_liege = ROOT # Always go Independent
				}

				hidden_effect = {
					if = {
						limit = {
							ROOT = {
								has_character_flag = is_child_of_destiny
								NOT = {
									religion_group = muslim
								}
							}
						}
						ROOT = {
							any_demesne_title = {
								limit = {
									higher_tier_than = COUNT
								}
								add_law = succ_primogeniture
							}
						}
					}
				}
			}
		}

		ROOT = {
			hidden_tooltip = {
				if = {
					limit = {
						has_character_flag = rum_creator
					}
					capital_scope = {
						culture = ROOT
					}
				}
				else_if = {
					limit = {
						has_character_flag = is_child_of_destiny
					}
					character_event = { id = HF.303 days = 3 }
				}
				else = {
					capital_scope = {
						reverse_culture = ROOT
					}
					any_child = {
						limit = {
							is_ruler = no
							ai = yes
							#liege = { character = ROOT }
						}
						culture = ROOT
					}
					any_courtier = {
						limit = {
							is_ruler = no
							ai = yes
						}
						culture = ROOT
					}
				}

				if = { # Give bloodline to Child of Destiny
					limit = {
						has_character_flag = is_child_of_destiny
						higher_real_tier_than = DUKE
						NOT = {
							any_owned_bloodline = {
								has_bloodline_flag = created_bloodline
							}
						}
					}
					character_event = { id = HF.304 days = 14 }
				}

				# Special case: Sultanate of Rum might start yet another war
				if = {
					limit = {
						has_character_flag = rum_creator
					}
					character_event = {
						id = 60610
						days = 600
						random = 300
					}
				}
			}
		}

		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_invalidation = {
		ROOT = {
			clr_character_flag = child_of_destiny_made_player_choice
			clr_character_flag = child_of_destiny_adventure
		}
	}

	on_fail = {
		FROM = {
			prestige = 100
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = {
			clear_wealth = yes
			imprison = FROM
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = duchy_adventurer
				if = {
					limit = {
						has_character_flag = is_child_of_destiny
					}
					remove_trait = disinherited
				}
			}
		}

		ROOT = { prestige = -100 }

		if = {
			limit = {
				ROOT = {
					has_character_flag = is_child_of_destiny
				}
			}
			set_global_flag = child_of_destiny_invasion_fail@ROOT
		}
	}

	on_reverse_demand = {
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}

		FROM = {
			prestige = 200
		}

		ROOT = {
			clear_wealth = yes
			imprison = FROM
			prestige = -200
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = duchy_adventurer
				if = {
					limit = {
						has_character_flag = is_child_of_destiny
					}
					remove_trait = disinherited
				}
			}
		}

		if = {
			limit = {
				ROOT = {
					has_character_flag = is_child_of_destiny
				}
			}
			set_global_flag = child_of_destiny_invasion_reverse_demand@ROOT
		}
	}

	on_attacker_leader_death = {
		ROOT = {
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = duchy_adventurer
			}
		}
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 40 Disabled
pagan_holy_war = {
	name = CB_NAME_RELIGIOUS
	war_name = WAR_NAME_RELIGIOUS
	sprite = 9
	truce_days = 1825
	is_permanent = yes
	is_holy_war = yes
	check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	allowed_to_target_tributaries = no

	sort_priority = 800

	can_use_gui = {
		ROOT = {
			piety = 100
		}
	}

	on_add = {
		ROOT = { piety = -100 }
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	can_use = {
		always = no
		ROOT = {
			OR = {
				religion = bon_reformed
				religion = hellenic_pagan_reformed
				religion = norse_pagan_reformed
				religion = tengri_pagan_reformed
				religion = baltic_pagan_reformed
				religion = slavic_pagan_reformed
				religion = finnish_pagan_reformed
				religion = aztec_reformed
				religion = aztec
				religion = west_african_pagan_reformed
				religion = zun_pagan_reformed
			}
			NOT = { has_religion_feature = religion_peaceful }
			NOT = { same_realm = FROM }
			NOT = { religion = FROM }
			top_liege = {
				religion = ROOT
			}
			mercenary = no
		}
	}

	can_use_title = {
		# The attacker needs at least one county in the target kingdom, or a border, or be only two sea zones away from one of your counties
		any_direct_de_jure_vassal_title = {
			OR = {
				holder_scope = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
				location = {
					any_neighbor_province = {
						OR = {
							AND = {
								has_owner = yes
								owner = {
									OR = {
										character = ROOT
										is_liege_or_above = ROOT
									}
								}
							}
							AND = {
								is_land = no
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													character = ROOT
													is_liege_or_above = ROOT
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												owner = {
													OR = {
														character = ROOT
														is_liege_or_above = ROOT
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				religion = bon_reformed
				religion = hellenic_pagan_reformed
				religion = norse_pagan_reformed
				religion = tengri_pagan_reformed
				religion = baltic_pagan_reformed
				religion = slavic_pagan_reformed
				religion = finnish_pagan_reformed
				religion = aztec_reformed
				religion = aztec
				religion = west_african_pagan_reformed
				religion = zun_pagan_reformed
			}
			NOT = { same_realm = FROM }
			NOT = { religion = FROM }
			top_liege = {
				NOT = { religion = FROM }
			}
		}
	}

	on_success = {
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_piety = 100
				participation_scaled_prestige = 50
			}
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
		}

		ROOT = {
			show_scope_change = no
			participation_scaled_piety = 100
			participation_scaled_prestige = 50
			religion_authority = {
				modifier = won_holy_war
				years = 20
			}
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
			hidden_tooltip = {
				if = {
					limit = {
						OR = {
							this_has_lame_nickname_trigger = yes
							has_nickname = no
						}
					}
					random_list = {
						10 = { give_nickname = nick_the_dragon }
						10 = { give_nickname = nick_the_holy }
						10 = { give_nickname = nick_bloodaxe }
						10 = { give_nickname = nick_the_great }
						40 = { give_nickname = nick_the_sword_of_god }
					}
				}
			}
		}

		FROM = {
			religion_authority = {
				modifier = lost_holy_war
				years = 20
			}
		}
		FROM = { show_scope_change = no piety = -100 }
		FROM = { show_scope_change = no prestige = -50 }
	}

	on_success_title = {
		custom_tooltip = {
			text = religious_cb_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						same_religion = yes # Only vassalize rulers of my religion
						is_religious = yes
						type = holy_war
					}
				}
			}
		}
	}

	on_fail = {
		ROOT = { piety = -50 }
		ROOT = { prestige = -100 }
	}

	on_reverse_demand = {
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			participation_scaled_piety = 200
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_piety = 200
				participation_scaled_prestige = 100
			}
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
		}
		ROOT = {
			religion_authority = {
				modifier = lost_holy_war
				years = 20
			}
		}
		FROM = {
			religion_authority = {
				modifier = won_holy_war
				years = 20
			}
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_nomadic = no
				NOT = {
					is_tribal = yes
				}
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_tribal = yes
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = tribal
						}
					}
				}
			}
		}

		modifier = {
			factor = 0.9 # Prefer using CB's without on_add costs
		}

		modifier = {
			factor = 0.1
			ROOT = {
				culture = hungarian
				primary_title = {
					OR = {
						title = k_hungary
						title = e_carpathia
					}
				}
			}
			empire = {
				OR = {
					title = e_tartaria
					title = e_russia
				}
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 41 Disabled
caliphal_subjugation = {
	name = CB_NAME_PAGAN_SUBJUGATION
	war_name = WAR_NAME_PAGAN_SUBJUGATION
	sprite = 8
	truce_days = 365
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	allowed_to_target_tributaries = no

	sort_priority = 1000

	can_use_gui = {
		ROOT = {
			piety = 200
		}
	}

	on_add = {
		ROOT = { piety = -200 }
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	can_use = {
		always = no
		ROOT = {
			OR = {
				ai = yes
				multiplayer = no
				NOT = {
					has_game_rule = {
						name = multiplayer_invasions
						value = off
					}
				}
			}
			religion_group = muslim
			OR = {
				has_landed_title = d_sunni
				has_landed_title = d_shiite
				has_landed_title = d_ibadi
				has_landed_title = d_kharijite
				has_landed_title = d_yazidi
				has_landed_title = d_hurufi
			}
			is_nomadic = no
			OR = {
				has_horde_culture = no # Should use tribal invasion instead
				has_dlc = "Horse Lords"
			}
			NOT = { has_character_modifier = launched_subjugation }
			mercenary = no
		}
		FROM = {
			religion = ROOT
			NOT = { is_offmap_governor = yes }
		}
	}

	can_use_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	is_valid_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_add_title = {
		ROOT = {
			add_character_modifier = {
				name = launched_subjugation
				days = 3650
				hidden = yes
			}
		}
	}

	on_success = {
		ROOT = {
			prestige = 100
			decadence = -5
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		FROM = {
			prestige = -200
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = pagan_subjugation_tip
			hidden_tooltip = {
				ROOT = {
					subjugate_or_take_under_title = { # If the target only has territory within the kingdom, he is simply vassalized
						title = PREV
						enemy = FROM
					}
				}
			}
		}
	}

	on_fail = {
		FROM = {
			prestige = 50
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		ROOT = {
			prestige = -100
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
		}
		FROM = {
			prestige = 100
			if = {
				limit = {
					has_dlc = "Legacy of Rome"
					OR = {
						has_landed_title = e_byzantium
						has_landed_title = e_roman_empire
					}
						OR = {
							religion_group = christian
							religion = hellenic_pagan
							religion = hellenic_pagan_reformed
						}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		modifier = {
			factor = 0.9 # Prefer using CB's without on_add costs
		}
		sufficient_treasury_for_war = yes
	}
}

# 42
muslim_county_conquest = {
	name = CB_NAME_COUNTY_CONQUEST
	war_name = WAR_NAME_COUNTY_CONQUEST
	sprite = 16
	truce_days = 1825
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no

	sort_priority = 700

	can_use_gui = {
		ROOT = {
			piety = 50
		}
	}

	on_add = {
		ROOT = { piety = -50 }
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			mercenary = no
			is_nomadic = no # Use the 'pagan_county_conquest' CB instead
			independent = yes
			religion_group = muslim
			religion = FROM
			NOT = { has_character_modifier = county_conquest_timer }
			NOT = { is_liege_or_above = FROM }
		}
		ROOT = { #Special Cases
			NOR = {
				AND = {
					has_landed_title = e_il-khanate
					religion = tengri_pagan
				}
				AND = {
					has_landed_title = e_golden_horde
					religion = tengri_pagan
				}
				has_character_flag = horde_seljuk
				has_character_flag = horde_seljuk2
				has_character_flag = alp_arslan
				has_landed_title = e_timurids
			}
		}
	}

	can_use_title = {
		tier = count
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
				NOT = { same_realm = ROOT }
			}
		}

		NOT = {
			OR = {
				ROOT = {
					has_landed_title = PREV
				}
				holder_scope = {
					is_liege_or_above = ROOT
				}
			}
		}

		location = {
			any_neighbor_province = {
				owner = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their muslim county conquest for the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}

		if = {
			limit = {
				holder_scope = {
					tier = count
					NOT = { num_of_count_titles = 2 }
					lower_tier_than = ROOT
				}
			}

			holder_scope = {
				set_defacto_liege = ROOT
				pf_liege_change_effect = yes
			}
		}
		if = {
			limit = {
				holder_scope = {
					OR = {
						higher_tier_than = count
						num_of_count_titles = 2
						NOT = { lower_tier_than = ROOT }
					}
				}
			}
			empty_province_effect = yes
			usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
			any_de_jure_vassal_title = { # take all baronies under the one we're fighting for
				limit = {
					has_holder = yes
					NOT = {
						de_facto_liege = PREV
					}
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
				}

				usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
			}
		}

		ROOT = {
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			pf_glory_minus2_effect = yes
		}
	}

	on_fail_title = {
		ROOT = {
			prestige = -100
			hidden_tooltip = { add_character_modifier = { name = "county_conquest_timer" duration = 1825 } }
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}

		ROOT = {
			prestige = -200
			pf_glory_minus2_effect = yes
			if = {
				limit = {
					has_global_flag = hardcore_mode
					ROOT = { ai = no }
				}
				hidden_tooltip = { ROOT = { add_character_modifier = { name = "county_conquest_timer" duration = 3650 } } }
			}
			if = {
				limit = {
					NOT = { has_global_flag = hardcore_mode }
				}
				hidden_tooltip = { ROOT = { add_character_modifier = { name = "county_conquest_timer" duration = 1825 } } }
			}
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		modifier = {
			factor = 0.9 # Prefer using CB's without on_add costs
		}
		modifier = {
			factor = 0
			ROOT = {
				has_character_flag = is_temujin
				has_landed_title = e_mongol_empire
				demesne_size = 1
			}
			FROM = {
				has_landed_title = e_china_west_governor
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 43
pagan_county_conquest = {
	name = CB_NAME_COUNTY_CONQUEST
	war_name = WAR_NAME_COUNTY_CONQUEST
	sprite = 22
	truce_days = 1825
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no

	allow_distant = yes
	allowed_to_target_tributaries = no

	sort_priority = 700

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			mercenary = no
		}
		OR = {
			ROOT = {
				is_nomadic = yes
				NOT = { same_realm = FROM }
				FROM = {
					OR = {
						is_nomadic = yes
						is_tribal = yes
					}
				}
			}
			AND = {
				ROOT = {
					is_pagan_religion = yes
					is_reformed_pagan_religion = no
					NOT = { same_realm = FROM }
				}
				FROM = {
					NOT = { religion = ROOT }
				}
			}
		}
		ROOT = { #Special Cases
			NOR = {
				AND = {
					has_landed_title = e_il-khanate
					religion = tengri_pagan
				}
				AND = {
					has_landed_title = e_golden_horde
					religion = tengri_pagan
				}
				AND = {
					has_landed_title = e_chagatai
					religion = tengri_pagan
				}
				AND = {
					has_landed_title = e_mongol_empire
					religion = tengri_pagan
				}
				has_character_flag = horde_seljuk
				has_character_flag = horde_seljuk2
				has_character_flag = alp_arslan
				has_landed_title = e_timurids
			}
		}
	}

	can_use_title = {
		tier = count
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
				NOT = { same_realm = ROOT }
			}
		}

		NOT = {
			OR = {
				ROOT = {
					has_landed_title = PREV
				}
				holder_scope = {
					is_liege_or_above = ROOT
				}
			}
		}

		OR = {
			#either a seafaring culture targeting a port in the same sea zone area
			AND = {
				ROOT = {
					is_seafarer = yes
					NOT = { has_character_flag = no_invasions }
				}
				location = { port = yes }
				has_global_flag = viking_age_started
				OR = {
					AND = {
						ROOT = { any_realm_province = { region = custom_baltic_sea_zone } }
						location = { region = custom_baltic_sea_zone }
					}
					AND = {
						ROOT = { any_realm_province = { region = custom_north_sea_zone } }
						location = { region = custom_north_sea_zone }
					}
					AND = {
						ROOT = { any_realm_province = { region = custom_atlantic_zone } }
						location = { region = custom_atlantic_zone }
					}
					AND = {
						ROOT = { any_realm_province = { region = custom_west_med_zone } }
						location = { region = custom_west_med_zone }
					}
					AND = {
						ROOT = { any_realm_province = { region = custom_east_med_zone } }
						location = { region = custom_east_med_zone }
					}
					AND = {
						ROOT = { any_realm_province = { region = custom_black_sea_zone } }
						location = { region = custom_black_sea_zone }
					}
				}
			}
			#or it's a port within a fairly close range
			location = {
				port = yes
				ROOT = {
					any_realm_province = {
						NOT = {
							distance = {
								where = PREVPREV
								value = 75
							}
						}
					}
				}
			}
			#or it's neighboring
			location = {
				any_neighbor_province = {
					owner = {
						OR = {
							character = ROOT
							is_liege_or_above = ROOT
						}
					}
				}
			}
		}
	}

	is_valid_title = {
		OR = {
			ROOT = {
				is_nomadic = yes
			}
			AND = {
				ROOT = {
					is_pagan_religion = yes
					is_reformed_pagan_religion = no
					NOT = { same_realm = FROM }
				}
				FROM = {
					NOT = { religion = ROOT }
				}
			}
		}

		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their pagan county conquest of the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			pf_tradition_plus2_effect = yes
		}
		empty_province_effect = yes
		hidden_tooltip = { destroy_tradeposts_effect = yes }

		usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }

		any_de_jure_vassal_title = { # take all baronies too
			limit = {
				has_holder = yes
				holder_scope = {
					OR = {
						character = FROM
						is_liege_or_above = FROM
						is_liege_or_above = ROOT
					}
					OR = {
						NOT = { culture = ROOT }
						NOT = { religion = ROOT }
					}
				}
			}
			usurp_title = ROOT
		}

		ROOT = {
			participation_scaled_prestige = 200
			participation_scaled_piety = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 200
				participation_scaled_piety = 100
			}
		}

		if = {
			limit = {
				NOT = { FROM = { religion = ROOT } }
			}
			ROOT = {
				religion_authority = {
					modifier = won_county_conquest
				}
			}
		}

		FROM = {
			pf_glory_minus2_effect = yes
		}
		#To handle Warrior Lodge mission "Wage War" completion...
		attacker = { save_event_target_as = attacker_target }
		defender = { save_event_target_as = defender_target }

		if = {
			limit = {
				event_target:attacker_target = { has_quest = quest_warrior_lodge_war }
				is_quest_target_of = event_target:attacker_target
			}
			event_target:attacker_target = {
				show_scope_change = no
				tooltip = { clr_quest = quest_warrior_lodge_war }
				set_character_flag = won_war@event_target:defender_target
				#character_event = { id = HF.10514 days = 3 } #Sent from on_action instead
			}
		}
	}

	on_fail_title = {
		ROOT = {
			prestige = -100
			piety = -50
			hidden_tooltip = { add_character_modifier = { name = "county_conquest_timer" duration = 1825 } }
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}

		#To handle Warrior Lodge mission "Wage War" completion...
		attacker = { save_event_target_as = attacker_target }
		defender = { save_event_target_as = defender_target }

		if = {
			limit = {
				event_target:attacker_target = { has_quest = quest_warrior_lodge_war }
				is_quest_target_of = event_target:attacker_target
			}
			event_target:attacker_target = {
				show_scope_change = no
				tooltip = { clr_quest = quest_warrior_lodge_war }
				set_character_flag = white_peace@event_target:defender_target
				#character_event = { id = HF.10514 days = 3 } #Sent from on_action instead
			}
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}

		ROOT = {
			prestige = -200
			piety = -100
			pf_glory_minus2_effect = yes
			pf_tradition_minus2_effect = yes
			if = {
				limit = {
					has_global_flag = hardcore_mode
					ROOT = { ai = no }
				}
				hidden_tooltip = { ROOT = { add_character_modifier = { name = "county_conquest_timer" duration = 3650 } } }
			}
			if = {
				limit = {
					NOT = { has_global_flag = hardcore_mode }
				}
				hidden_tooltip = { ROOT = { add_character_modifier = { name = "county_conquest_timer" duration = 1825 } } }
			}
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		if = {
			limit = {
				NOT = { FROM = { religion = ROOT } }
			}
			ROOT = {
				show_scope_change = no
				religion_authority = {
					modifier = lost_county_conquest
				}
			}
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 200
			participation_scaled_piety = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_prestige = 200
				participation_scaled_piety = 100
			}
		}
	}

	on_reverse_demand_title = {
		#To handle Warrior Lodge mission "Wage War" completion...
		attacker = { save_event_target_as = attacker_target }
		defender = { save_event_target_as = defender_target }

		if = {
			limit = {
				event_target:attacker_target = { has_quest = quest_warrior_lodge_war }
				is_quest_target_of = event_target:attacker_target
			}
			event_target:attacker_target = {
				show_scope_change = no
				tooltip = { clr_quest = quest_warrior_lodge_war }
				set_character_flag = lost_war@event_target:defender_target
				#character_event = { id = HF.10514 days = 3 } #Sent from on_action instead
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 0
			FROM = {
				NOT = {
					any_realm_province = {
						county = { title = PREVPREVPREV }
						any_neighbor_province = { owner = { same_realm = ROOT } }
					}
				}
			}
			ROOT = {
				NOT = {
					any_realm_province = {
						TECH_NAVAL = 1
						port = yes
					}
				}
			}
		}
		modifier = {
			factor = 0
			location = {
				NOT = {
					any_neighbor_province = {
						owner = { same_realm = ROOT }
					}
				}
				OR = {
					region = custom_perm
					duchy = { title = d_kola }
					duchy = { title = d_karelia }
				}
			}
		}
		modifier = {
			factor = 0.1
			ROOT = {
				is_seafarer = yes
				religion_group = FROM
			}
			location = {
				NOR = {
					region = custom_novgorod
					region = custom_muscovy
					region = custom_livonia
					region = custom_rus
					any_neighbor_province = {
						owner = { same_realm = ROOT }
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			ROOT = { is_seafarer = yes }
			location = {
				OR = {
					region = custom_novgorod
					region = custom_livonia
					region = custom_rus
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				culture = hungarian
				has_global_flag = magyar_1066_invasion
			}
		}
		modifier = {
			factor = 2.0
			ROOT = { culture_group = east_slavic }
			capital_scope = {
				OR = {
					region = custom_cuman
					region = custom_volga
					region = custom_alania
					region = custom_crimea
					region = custom_novgorod
					region = custom_muscovy
					region = custom_rus
				}
			}
		}
		modifier = {
			factor = 0.1
			ROOT = { culture = hungarian }
			capital_scope = {
				OR = {
					region = custom_cuman
					region = custom_volga
					region = custom_alania
					region = custom_novgorod
					region = custom_muscovy
					region = custom_rus
				}
			}
		}
		modifier = {
			factor = 2.0
			ROOT = { culture = hungarian }
			capital_scope = {
				OR = {
					region = custom_bulgaria
					region = custom_carpathia
				}
			}
		}
		modifier = {
			factor = 0
			ROOT = {
				has_character_flag = is_temujin
				has_landed_title = e_mongol_empire
				demesne_size = 1
			}
			FROM = {
				has_landed_title = e_china_west_governor
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 44
dejure_county_claim = {
	name = CB_NAME_DEJURECLAIM
	war_name = WAR_NAME_DEJURECLAIM
	sprite = 16
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	#is_holy_war = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = yes

	infamy_modifier = 0.5

	allowed_to_target_tributaries = yes

	sort_priority = 700

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use_gui = {
		FROMFROM = {
			OR = {
				dejure_liege_title = {
					holder = ROOT
				}
				kingdom = {
					holder = ROOT
					custom_tooltip = {
						text = DE_JURE_TOOLTIP1
						hidden_tooltip = {
							OR = {
								has_law = crown_authority_2
								has_law = crown_authority_3
								has_law = crown_authority_4
							}
						}
					}
				}
				empire = {
					holder = ROOT
					custom_tooltip = {
						text = DE_JURE_TOOLTIP1
						hidden_tooltip = {
							OR = {
								has_law = crown_authority_2
								has_law = crown_authority_3
								has_law = crown_authority_4
							}
						}
					}
				}
			}
		}
	}

	can_use = {
		#check to ensure the target is not valid for a holy war
		cb_no_nap_with_suzerain_trigger = yes
		NOT = {
			ROOT = {
				OR = {
					is_pagan_religion = no
					is_reformed_pagan_religion = yes
				}
				OR = {
					NOR = {
						religion = hindu
						religion = buddhist
					}
					FROM = { NOT = { has_dharmic_religion_trigger = yes } }
				}
				OR = {
					NOT = { religion_group = FROM }
					is_heresy_of = FROM
					is_parent_religion = FROM
					AND = {
						OR = {
							religion_group = muslim
							is_pagan_religion = yes
							religion = paulician
						}
						NOT = { religion = FROM }
					}
				}
				NOR = {
					pacifist = yes
					same_realm = FROM
				}
			}
		}
	}

	can_use_title = {
		cb_can_use_preamble = yes
		ROOT = { attacking_religious_head_trigger = no }

		tier = count

		#target owns the county or it belongs to their vassal
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		#attacker holds either the de jure kingdom, empire or liege title
		OR = {
			empire = { holder = ROOT }
			kingdom = { holder = ROOT }
			dejure_liege_title = { holder = ROOT }
		}

		#attacker does not have the county title and the title holder is not their liege
		NOT = {
			OR = {
				ROOT = {
					has_landed_title = PREV
				}
				holder_scope = {
					is_liege_or_above = ROOT
				}
			}
		}
		#AI will only attack a holy order if they are a player, of a different religion or are a king/emperor
		OR = {
			ROOT = { ai = no }
			FROM = {
				OR = {
					holy_order = no
					higher_tier_than = duke
					NOT = { religion = ROOT }
					NOT = { has_dlc = "Sons of Abraham" }
				}
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = {
				FROM = {
					religion = ROOT
					holy_order = yes
				}
			}
			ROOT = { piety = -500 }
		}
		FROM = {
			attacked_tributary_cb_effect = yes
		}
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			pf_glory_minus2_effect = yes
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their de jure county claim on the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		#change imperial decadence
		if = {
			limit = { empire = { ROOT = { has_landed_title = PREV } } }
			ROOT = { imperial_decadence_minus_1_effect = yes }
		}

		empty_province_effect = yes
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
		any_de_jure_vassal_title = { # take all baronies under the one we're fighting for
			limit = {
				has_holder = yes
				NOT = {
					de_facto_liege = PREV
				}
				holder_scope = {
					OR = {
						character = FROM
						is_liege_or_above = FROM
					}
				}
			}
			usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
		}
	}

	on_fail = {
		prestige = -100
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			pf_glory_minus2_effect = yes
		}
		FROM = {
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	on_reverse_demand_title = {
		#change imperial decadence
		if = {
			limit = { empire = { ROOT = { has_landed_title = PREV } } }
			ROOT = { imperial_decadence_plus_1_effect = yes }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 0
			ROOT = {
				culture = mongol
				is_pagan_religion = yes
			}
			FROM = {
				culture = mongol
				is_pagan_religion = yes
			}
		}
		modifier = {
			factor = 0
			ROOT = {
				NOR = {
					trait = cynical
					trait = ambitious
				}
				rightful_religious_head_scope = { character = FROM }
			}
		}
		modifier = { # The AI will never breach a tributary's trust
			factor = 0
			ai_attack_tributary_trigger = yes
		}
		modifier = {
			factor = 0 # AIs will not take the last counties off their liege's direct vassals
			ROOT = {
				same_liege = FROM
			}
			FROM = {
				NOT = {
					any_demesne_title = {
						tier = count
						NOT = { title = PREVPREV }
					}
				}
			}
		}
		modifier = {
			factor = 0
			ROOT = {
				has_character_flag = is_temujin
				has_landed_title = e_mongol_empire
				demesne_size = 1
			}
			FROM = {
				has_landed_title = e_china_west_governor
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 45
dejure_barony_claim = {
	name = CB_NAME_DEJUREBARONYCLAIM
	war_name = WAR_NAME_DEJUREBARONYCLAIM
	sprite = 16
	truce_days = 1825
	hostile_against_others = yes
	is_permanent = yes
	#is_holy_war = yes
	check_de_jure_tier = COUNT
	can_ask_to_join_war = yes

	infamy_modifier = 0.5

	allowed_to_target_tributaries = yes
	sort_priority = 650

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		#check to ensure the target is not valid for a holy war
		NOT = {
			ROOT = {
				OR = {
					is_pagan_religion = no
					is_reformed_pagan_religion = yes
				}
				OR = {
					NOR = {
						religion = hindu
						religion = buddhist
					}
					FROM = { NOT = { has_dharmic_religion_trigger = yes } }
				}
				OR = {
					NOT = { religion_group = FROM }
					is_heresy_of = FROM
					is_parent_religion = FROM
					AND = {
						OR = {
							religion_group = muslim
							is_pagan_religion = yes
							religion = paulician
						}
						NOT = { religion = FROM }
					}
				}
				NOR = {
					pacifist = yes
					same_realm = FROM
				}
			}
		}

		ROOT = { attacking_religious_head_trigger = no }
		OR = {
			ROOT = { ai = no }
			FROM = {
				NOT = { is_vassal_or_below = ROOT }
				OR = {
					ai = no
					holy_order = no
					higher_tier_than = duke
					NOT = { religion = ROOT }
					NOT = { has_dlc = "Sons of Abraham" }
				}
			}
		}
	}

	can_use_title = {
		#de jure liege title belongs to attacker or a vassal
		has_holder = yes
		holder_scope = {
			OR = {
				character = ROOT
				is_liege_or_above = ROOT
			}
		}
		#at least one barony belongs to the target
		any_direct_de_jure_vassal_title = {
			holder_scope = {
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOR = {
					character = ROOT
					is_liege_or_above = ROOT
				}
			}
			#not a pentarch title for my own religion
			can_attack_patriarch_trigger = yes
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = {
				FROM = {
					religion = PREV
					holy_order = yes
				}
			}
			attacker = { piety = -500 }
		}
		FROM = {
			attacked_tributary_cb_effect = yes
		}
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		FROM = {
			pf_glory_minus2_effect = yes
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their de jure barony claim on the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		holder_scope = {
			save_event_target_as = target_taker
		}
		any_direct_de_jure_vassal_title = {
			limit = {
				holder_scope = {
					OR = {
						character = FROM
						is_liege_or_above = FROM
					}
					NOR = {
						character = event_target:target_taker
						is_liege_or_above = event_target:target_taker
						is_liege_or_above = ROOT
					}
				}
			}
			usurp_title_plus_barony_if_unlanded = { target = event_target:target_taker type = claim }
		}
		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_fail = {
		prestige = -50
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			prestige = -100
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			pf_glory_minus2_effect = yes
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 0
			ROOT = {
				NOR = {
					trait = cynical
					trait = ambitious
				}
				rightful_religious_head_scope = { character = FROM }
			}
		}
		modifier = { # The AI will never breach a tributary's trust
			factor = 0
			ai_attack_tributary_trigger = yes
		}
		sufficient_treasury_for_war = yes
	}
}

# 46
other_dejure_county_claim = {
	name = CB_NAME_DEJURECLAIM
	war_name = WAR_NAME_OTHER_DEJURECLAIM
	sprite = 16
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	other_de_jure_claim = yes # Optimization for de jure claims of vassals
	press_claim = yes
	can_ask_to_join_war = yes

	allowed_to_target_tributaries = yes

	infamy_modifier = 0.3

	sort_priority = 700

	can_use_gui = {
		check_if_crusader_trigger = yes
		FROMFROM = {
			OR = {
				dejure_liege_title = {
					holder = ROOT
				}
				kingdom = {
					holder = ROOT
					custom_tooltip = {
						text = DE_JURE_TOOLTIP1
						hidden_tooltip = {
							OR = {
								has_law = crown_authority_2
								has_law = crown_authority_3
								has_law = crown_authority_4
							}
						}
					}
				}
				empire = {
					holder = ROOT
					custom_tooltip = {
						text = DE_JURE_TOOLTIP1
						hidden_tooltip = {
							OR = {
								has_law = crown_authority_2
								has_law = crown_authority_3
								has_law = crown_authority_4
							}
						}
					}
				}
			}
		}
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_other_no_nap_with_suzerain_trigger = yes
		#check to ensure the target is not valid for a holy war
		NOT = {
			AND = {
				OR = {
					is_pagan_religion = no
					is_reformed_pagan_religion = yes
				}
				OR = {
					NOR = {
						religion = hindu
						religion = buddhist
					}
					FROM = { NOT = { has_dharmic_religion_trigger = yes } }
				}
				OR = {
					NOT = { religion_group = FROM }
					is_heresy_of = FROM
					is_parent_religion = FROM
					AND = {
						OR = {
							religion_group = muslim
							is_pagan_religion = yes
							religion = paulician
						}
						NOT = { religion = FROM }
					}
				}
				NOR = {
					pacifist = yes
					same_realm = FROM
				}
			}
		}

		attacking_religious_head_trigger = no

		NOT = {
			character = ROOT
		}

		#supported ruler is a vassal
		ROOT = {
			any_liege = {
				character = PREVPREV
			}
		}
		#AI will only attack a holy order if they are a player, of a different religion or are a king/emperor
		OR = {
			ai = no
			FROM = {
				OR = {
					ai = no
					holy_order = no
					higher_tier_than = duke
					NOT = { religion = PREV }
					NOT = { has_dlc = "Sons of Abraham" }
				}
			}
		}
	}

	can_use_title = {
		tier = count
		#supporter ruler owns the de jure liege kingdom, empire or title of the county
		OR = {
			empire = { holder = ROOT }
			kingdom = { holder = ROOT }
			dejure_liege_title = { holder = ROOT }
		}
		#supporter ruler does not own the county, and it is not owned by their liege
		holder_scope = {
			NOR = {
				character = ROOT
				character = FROMFROM
				is_liege_or_above = ROOT
				is_liege_or_above = FROMFROM # The potential attacker
			}
		}
		#target owns the county or it is owned by their vassal
		OR = {
			FROM = { has_landed_title = PREV }
			holder_scope = { is_liege_or_above = FROM }
		}
		OR = {
			ROOT = {
				NOT = { same_liege = FROM }
			}
			FROM = {
				any_demesne_title = {
					NOT = { title = PREVPREV }
					higher_tier_than = BARON
				}
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = {
				FROM = {
					religion = FROMFROM
					holy_order = yes
				}
			}
			FROMFROM = { piety = -500 }
		}
		FROM = {
			attacked_tributary_cb_effect = yes
		}
		ROOT = {
			set_character_flag = claim_being_pressed
		}
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = { add_character_modifier = { name = new_land_timer duration = 1 hidden = yes } }
		add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
		pf_glory_plus2_effect = yes
		ROOT = {
			opinion = {
				modifier = pressed_my_claim
				who = PREV
			}
			show_scope_change = no
			hidden_tooltip = {
				clr_character_flag = claim_being_pressed
			}
		}
		ROOT = {
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = PREV } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			pf_glory_minus2_effect = yes
		}
	}

	on_success_title = {
		log = "[FromFrom.GetBestName] (ID: [FromFrom.GetID]) succeeded with [Root.GetBestName]'s (ID: [Root.GetID]) de jure county claim for the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		empty_province_effect = yes
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
		any_de_jure_vassal_title = { # take all baronies under the one we're fighting for
			limit = {
				has_holder = yes
				NOT = {
					de_facto_liege = PREV
				}
				holder_scope = {
					OR = {
						character = FROM
						is_liege_or_above = FROM
					}
				}
			}
			usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
		}
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		prestige = -100
		ROOT = {
			show_scope_change = no
			hidden_tooltip = {
				clr_character_flag = claim_being_pressed
			}
		}
	}

	on_invalidation = {
		ROOT = {
			hidden_tooltip = {
				clr_character_flag = claim_being_pressed
			}
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		prestige = -200
		transfer_scaled_wealth = {
			to = FROM
			value = 4.0
		}
		pf_glory_minus2_effect = yes
		ROOT = {
			show_scope_change = no
			prestige = -200
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 0
			ROOT = {
				culture = mongol
				is_pagan_religion = yes
			}
			FROM = {
				culture = mongol
				is_pagan_religion = yes
			}
		}
		modifier = { # The AI will never breach a tributary's trust
			factor = 0
			ai_attack_tributary_trigger = yes
		}
		modifier = {
			factor = 0 # AIs will not take the last counties off their liege's direct vassals
			ROOT = {
				same_liege = FROM
			}
			FROM = {
				NOT = {
					any_demesne_title = {
						tier = count
						NOT = { title = PREVPREV }
					}
				}
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 47
shia_caliphate_rising = {
	name = CB_NAME_SHIA_CALIPHATE_RISING
	war_name = WAR_NAME_SHIA_CALIPHATE_RISING
	sprite = 8
	truce_days = 365
	hostile_against_others = no
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character.
	apply_short_occ_mod = no # Do not apply the 'recently_conquered' modifier to Holdings

	can_use = {
		ROOT = {
			has_character_flag = shia_caliphate_pretender
		}
	}

	is_valid_title = {
		ROOT = {
			has_character_flag = shia_caliphate_pretender
		}
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}
		}
		d_shiite = {
			has_holder = no
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		clr_global_flag = shia_caliphate_revolt_ongoing
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			piety = 500
			religion_authority = {
				modifier = rise_of_the_shia_caliphate
			}
			clr_character_flag = shia_caliphate_pretender
		}
		FROM = {
			piety = -500
			imperial_decadence_plus_2_effect = yes
			religion_authority = {
				modifier = shia_victorious1
			}
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with shia caliphate rising for the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		custom_tooltip = {
			text = other_invasion_succ_tip
			hidden_tooltip = {
				d_shiite = {
					usurp_title = { target = ROOT type = holy_war }
				}
				FROM = {
					random_realm_province = {
						limit = {
							de_jure_liege_or_above = PREVPREV
							NOT = { religion = ROOT }
							religion_group = muslim
						}
						religion = ROOT
					}
					random_realm_province = {
						limit = {
							de_jure_liege_or_above = PREVPREV
							NOT = { religion = ROOT }
							religion_group = muslim
						}
						religion = ROOT
					}
					random_realm_province = {
						limit = {
							de_jure_liege_or_above = PREVPREV
							NOT = { religion = ROOT }
							religion_group = muslim
						}
						religion = ROOT
					}
					random_realm_province = {
						limit = {
							de_jure_liege_or_above = PREVPREV
							NOT = { religion = ROOT }
							religion_group = muslim
						}
						religion = ROOT
					}
					random_realm_province = {
						limit = {
							de_jure_liege_or_above = PREVPREV
							NOT = { religion = ROOT }
							religion_group = muslim
						}
						religion = ROOT
					}
				}
				pf_liege_change_under_title_begin_effect = yes
				ROOT = {
					remove_trait = shiite_claimant
					occupy_minors_of_occupied_settlements = FROM
					gain_all_occupied_titles = { who = FROM type = revolt }
					if = {
						limit = {
							PREV = {
								OR = {
									has_holder = no
									holder_scope = {
										character = FROM
									}
								}
							}
						}
						usurp_title = { target = PREV type = revolt }
					}
					if = {
						limit = {
							NOT = {
								ROOT = {
									any_demesne_title = {
										tier = KING
									}
								}
							}
						}
						create_title = {
							tier = KING
							landless = no
							temporary = no
							custom_created = yes
							culture = ROOT
							holder = ROOT
							name = "SHIA_CUSTOM_FALLBACK"
							base_title = PREV
							copy_title_laws = yes
						}
					}
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						is_religious = yes
						type = revolt
					}

					any_demesne_title = {
						limit = { tier = BARON }
						set_title_flag = refill_levy
					}
					character_event = { id = Plus.352 days = 3 } #Refill the levies
					wealth = 500
				}
				pf_liege_change_under_title_end_effect = yes
				if = {
					limit = {
						FROM = { is_liege_or_above = ROOT }
					}
					FROM = { imprison = ROOT }
				}
			}
		}
	}

	on_fail = {
		clr_global_flag = shia_caliphate_revolt_ongoing
		FROM = {
			piety = 250
		}
		ROOT = {
			piety = -250
			clr_character_flag = shia_caliphate_pretender
		}
	}

	on_reverse_demand = {
		clr_global_flag = shia_caliphate_revolt_ongoing
		ROOT = {
			piety = -500
			clr_character_flag = shia_caliphate_pretender
			imprison = FROM
		}
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			piety = 250
			imperial_decadence_minus_2_effect = yes
			participation_scaled_piety = 250
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_piety = 250 }
		}
	}

	on_attacker_leader_death = {
		clr_global_flag = shia_caliphate_revolt_ongoing
		ROOT = {
			clr_character_flag = shia_caliphate_pretender
		}
		end_war = invalid
	}

	on_invalidation = {
		log = "CB(shia_caliphate_rising): INVALIDATED: [Root.GetTitledFirstName] of [Root.PrimaryTitle.GetBaseName] (ID: [Root.GetID]) vs. [From.GetTitledFirstName] of [From.PrimaryTitle.GetBaseName] (ID: [From.GetID])"
		clr_global_flag = shia_caliphate_revolt_ongoing
		ROOT = {
			clr_character_flag = shia_caliphate_pretender
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 48
depose_antipope = {
	name = CB_NAME_DEPOSE_ANTIPOPE
	war_name = WAR_NAME_DEPOSE_ANTIPOPE
	sprite = 29
	truce_days = 3650
	is_permanent = yes
	can_ask_to_join_war = yes

	defender_unoccupied_warscore = yes

	attacker_rel_head_is_ally = yes # The attacker can call his (main) Pope into the war
	allowed_to_target_tributaries = no

	sort_priority = 750

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		ROOT = {
			religion = FROM
			OR = {
				religion = catholic
				religion = fraticelli
			}
			rightful_religious_head_scope = {
				NOT = { has_claim = k_papal_state }
				NOT = { has_claim = d_fraticelli }
			}
			mercenary = no
			OR = {
				ai = no
				NOT = { trait = cynical }
			}
		}
		FROM = {
			independent = yes
			rightful_religious_head_scope = {
				is_liege_or_above = PREV
				OR = {
					has_claim = k_papal_state
					has_claim = d_fraticelli
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			religion = FROM
			OR = {
				religion = catholic
				religion = fraticelli
			}
			rightful_religious_head_scope = {
				NOT = { has_claim = k_papal_state }
				NOT = { has_claim = d_fraticelli }
			}
		}
		FROM = {
			rightful_religious_head_scope = {
				is_liege_or_above = PREV
				OR = {
					has_claim = k_papal_state
					has_claim = d_fraticelli
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_invalidation = {
		# Coronation request locks cleared on invalidation or loss, to avoid locking the player in the middle of the negotiation forever.
		hidden_tooltip = {
			ROOT = {
				clr_character_flag = flag_antipope_for_coronation
			}
			FROM = {
				clr_character_flag = flag_antipope_for_coronation
			}
		}
	}

	on_success = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their depose antipope CB against [From.GetBestName] (ID: [From.GetID])"
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			participation_scaled_piety = 500
			participation_scaled_prestige = 250
		}
		if = {
			limit = {
				ROOT = {
					has_character_flag = flag_antipope_for_coronation
				}
			}
			ROOT = {
				character_event = { id = HF.20220 } #Papal Coronation may proceed.
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_piety = 500
				participation_scaled_prestige = 250
			}
		}

		ROOT = {
			religion_authority = {
				modifier = deposed_antipope
				years = 50
			}

			if = {
				limit = {
					rightful_religious_head_scope = {
						ROOT = {
							excommunicated_for = PREV
						}
					}
				}
				excommunicate = no
			}

			rightful_religious_head_scope = {
				opinion = {
					who = ROOT
					modifier = opinion_deposed_antipope
				}
			}
		}

		FROM = {
			piety = -500
			prestige = -250
			pf_glory_minus2_effect = yes
			pf_tradition_minus2_effect = yes
			rightful_religious_head_scope = {
				character_event = { id = Plus.350 tooltip = ANTIPOPE_DEPOSED }
			}
		}
	}

	on_fail = {
		hidden_tooltip = {
			FROM = {
				clr_character_flag = flag_antipope_for_coronation
			}
			ROOT = {
				clr_character_flag = flag_antipope_for_coronation
			}
		}
		ROOT = {
			piety = -250
			prestige = -125
		}
		FROM = {
			piety = 100
			prestige = 50
		}
	}

	on_reverse_demand = {
		hidden_tooltip = {
			FROM = {
				clr_character_flag = flag_antipope_for_coronation
			}
			ROOT = {
				clr_character_flag = flag_antipope_for_coronation
			}
		}
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			piety = -500
			prestige = -250
			pf_glory_minus2_effect = yes
		}

		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			piety = 500
			prestige = 250
			pf_glory_plus2_effect = yes
			pf_tradition_plus2_effect = yes
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 5
			ROOT = { trait = zealous }
		}
		sufficient_treasury_for_war = yes
	}
}

# 49
cb_install_antiking = {
	name = CB_NAME_INSTALL_ANTIKING
	war_name = WAR_NAME_INSTALL_ANTIKING
	sprite = 11
	truce_days = 3650
	major_revolt = yes

	attacker_rel_head_is_ally = yes # The attacker can call his (main) Pope into the war

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		ROOT = {
			vassal_of = FROM
			religion = FROM
			OR = {
				religion = catholic
				religion = fraticelli
			}
		}
		FROM = {
			rightful_religious_head_scope = {
				is_liege_or_above = PREV
				OR = {
					has_claim = k_papal_state
					has_claim = d_fraticelli
				}
			}
		}
	}

	is_valid_title = {
		NOT = {
			holder_scope = {
				character = ROOT
			}
		}
	}

	is_valid = {
		ROOT = {
			religion = FROM
			OR = {
				religion = catholic
				religion = fraticelli
			}
		}
		FROM = {
			rightful_religious_head_scope = {
				is_liege_or_above = PREV
				OR = {
					has_claim = k_papal_state
					has_claim = d_fraticelli
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their install antiking CB against [From.GetBestName] (ID: [From.GetID])"
		ROOT = {
			participation_scaled_piety = 500
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_piety = 500
				participation_scaled_prestige = 250
			}
		}

		ROOT = {
			pf_glory_plus2_effect = yes
			pf_tradition_plus4_effect = yes
			religion_authority = {
				modifier = deposed_antipope
				years = 50
			}

			if = {
				limit = {
					religion = catholic
				}
				k_papal_state = {
					holder_scope = {
						opinion = {
							who = ROOT
							modifier = opinion_deposed_antipope
						}
					}
				}
			}
			if = {
				limit = {
					religion = fraticelli
				}
				d_fraticelli = {
					holder_scope = {
						opinion = {
							who = ROOT
							modifier = opinion_deposed_antipope
						}
					}
				}
			}
		}

		FROM = {
			piety = -500
			prestige = -250

			rightful_religious_head_scope = {
				character_event = { id = Plus.350 tooltip = ANTIPOPE_DEPOSED }
			}

			primary_title = {
				usurp_title = { target = ROOT type = revolt }
			}
		}
		if = {
			limit = { primary_title = { has_law = investiture_law_1 } }
			primary_title = { add_law_w_cooldown = investiture_law_0 }
		}
	}

	on_fail = {
		ROOT = {
			piety = -250
			prestige = -125
		}
		FROM = {
			piety = 100
			prestige = 50
		}
	}

	on_reverse_demand = {
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			piety = -500
			prestige = -250
			prisoner = FROM
			pf_glory_minus2_effect = yes
			pf_tradition_minus2_effect = yes
		}

		FROM = {
			piety = 500
			prestige = 250
			imperial_decadence_minus_1_effect = yes
			pf_glory_plus2_effect = yes
			pf_tradition_plus2_effect = yes
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 50 Disabled
buddhist_holy_war = {
	name = CB_NAME_RELIGIOUS_MINOR
	war_name = WAR_NAME_RELIGIOUS
	sprite = 9
	truce_days = 1825
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no

	sort_priority = 800

	can_use = {
		always = no
		ROOT = {
			religion = buddhist
			NOT = { same_realm = FROM }
			OR = {
				NOT = { religion_group = FROM }
				FROM = { religion = taoist }
				AND = {
					religion_group = FROM
					FROM = {
						has_character_modifier = known_satanist
					}
					NOT = {
						has_character_modifier = known_satanist
					}
				}
			}
			top_liege = {
				religion_group = ROOT
				OR = {
					NOT = { religion = FROM }
					FROM = { religion = taoist }
					AND = {
						religion_group = FROM
						FROM = {
							has_character_modifier = known_satanist
						}
						NOT = {
							has_character_modifier = known_satanist
						}
						ROOT = {
							NOT = {
								has_character_modifier = known_satanist
							}
						}
					}
				}
			}
			mercenary = no
			is_nomadic = no
		}
	}

	can_use_title = {
		tier = count

		# The attacker needs a border or be at the most two sea zones away
		location = {
			any_neighbor_province = {
				OR = {
					AND = {
						has_owner = yes
						owner = {
							OR = {
								character = ROOT
								is_liege_or_above = ROOT
							}
						}
					}
					AND = {
						is_land = no
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											character = ROOT
											is_liege_or_above = ROOT
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										owner = {
											OR = {
												character = ROOT
												is_liege_or_above = ROOT
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			religion = buddhist
			NOT = { same_realm = FROM }
			OR = {
				NOT = { religion_group = FROM }
				FROM = { religion = taoist }
				AND = {
					religion_group = FROM
					FROM = {
						has_character_modifier = known_satanist
					}
					NOT = {
						has_character_modifier = known_satanist
					}
				}
			}
			top_liege = {
				OR = {
					NOT = { religion = FROM }
					FROM = { religion = taoist }
					AND = {
						religion_group = FROM
						FROM = {
							has_character_modifier = known_satanist
						}
						NOT = {
							has_character_modifier = known_satanist
						}
						ROOT = {
							NOT = {
								has_character_modifier = known_satanist
							}
						}
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		any_attacker = {
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
		}

		ROOT = {
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
		}
	}

	on_success_title = {
		if = {
			limit = {
				holder_scope = {
					tier = count
					NOT = { num_of_count_titles = 2 }
					lower_tier_than = ROOT
				}
			}

			holder_scope = {
				set_defacto_liege = ROOT
			}
		}

		if = {
			limit = {
				holder_scope = {
					OR = {
						higher_tier_than = count
						num_of_count_titles = 2
						NOT = { lower_tier_than = ROOT }
					}
				}
			}

			usurp_title_plus_barony_if_unlanded = { target = ROOT type = holy_war }
			any_de_jure_vassal_title = { # take all baronies under the one we're fighting for
				limit = {
					has_holder = yes
					NOT = {
						de_facto_liege = PREV
					}
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
				}

				usurp_title_plus_barony_if_unlanded = { target = ROOT type = holy_war }
			}
		}
		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_fail_title = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_nomadic = no
				NOT = {
					is_tribal = yes
				}
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_tribal = yes
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = tribal
						}
					}
				}
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 51 Disabled
indian_subjugation = {
	name = CB_NAME_PAGAN_SUBJUGATION
	war_name = WAR_NAME_PAGAN_SUBJUGATION
	sprite = 8
	truce_days = 365
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	allowed_to_target_tributaries = no

	sort_priority = 1000

	can_use_gui = {
		ROOT = {
			piety = 500
		}
	}

	on_add = {
		ROOT = { piety = -500 }
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	can_use = {
		always = no
		ROOT = {
			has_dharmic_religion_trigger = yes
			NOT = { same_realm = FROM }
			NOT = { is_liege_or_above = FROM }
			has_horde_culture = no # Should use tribal invasion instead
			is_nomadic = no
			mercenary = no
		}
		FROM = {
			NOT = { is_offmap_governor = yes }
			has_dharmic_religion_trigger = yes
			culture_group = ROOT
			NOT = {
				any_war = {
					defender = { character = PREVPREV }
					using_cb = indian_subjugation
				}
			}
		}
	}

	can_use_title = {
		ROOT = {
			OR = {
				NOT = { has_character_modifier = launched_subjugation }
				AND = {
					has_ambition = obj_become_king
					capital_scope = {
						kingdom = {
							title = PREVPREVPREV
						}
					}
				}
			}
		}

		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}

		#OR = { # This ensures that the AI doesn't declare this type of war against someone who only holds a few counties within the targeted title...
		#	ROOT = {
		#		ai = no
		#	}
		#	FROM = {
		#		num_of_realm_counties = {
		#			value = 5
		#			title = PREV
		#		}
		#	}
		#}
	}

	is_valid_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_add_title = {
		ROOT = {
			if = {
				limit = {
					OR = {
						NOT = { has_ambition = obj_become_king }
						capital_scope = {
							kingdom = {
								NOT = { title = PREVPREVPREV }
							}
						}
					}
				}
				add_character_modifier = {
					name = launched_subjugation
					years = 100
					hidden = yes
				}
			}
		}
	}

	on_success = {
		ROOT = {
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			prestige = -200
		}
	}

	on_success_title = {
		# Usurp the target kingdom itself, if the enemy holds it
		if = {
			limit = {
				holder_scope = {
					character = FROM
				}
				NOT = { ROOT = { tier = EMPEROR } }
			}
			ROOT = { usurp_title = { target = PREV type = invasion } }
		}

		if = {
			# Take the enemy's duchies within the target kingdom, if we are the same or lower tier
			limit = {
				ROOT = {
					NOT = { higher_tier_than = FROM }
				}
			}
			FROM = {
				any_demesne_title = {
					limit = {
						tier = DUKE
						OR = {
							title = PREVPREV
							de_jure_liege_or_above = PREVPREV
						}
					}
					ROOT = { usurp_title = { target = PREV type = invasion } }
				}
			}
		}

		# Have I become the vassal of the loser due to taking a duchy or kingdom?
		if = {
			limit = {
				ROOT = {
					is_liege_or_above = FROM
				}
			}
			ROOT = {
				set_defacto_liege = ROOT
			}
		}

		# Vassalize the rest
		custom_tooltip = {
			text = pagan_subjugation_tip
			hidden_tooltip = {
				ROOT = {
					subjugate_or_take_under_title = { # If the target only has territory within the kingdom, he is simply vassalized
						title = PREV
						enemy = FROM
					}
				}
			}
		}
	}

	on_fail = {
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		ROOT = {
			prestige = -100
		}
	}

	on_invalidation = {
		ROOT = {
			remove_character_modifier = launched_subjugation
			piety = 500
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
		}
		FROM = {
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1

		modifier = {
			factor = 0.9 # Prefer using CB's without on_add costs
		}
		modifier = {
			factor = 0
			ROOT = {
				has_character_flag = is_temujin
				has_landed_title = e_mongol_empire
				demesne_size = 1
			}
			FROM = {
				has_landed_title = e_china_west_governor
			}
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				NOT = {
					is_tribal = yes
				}
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_tribal = yes
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = tribal
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_nomadic = no
				NOT = {
					is_tribal = yes
				}
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_tribal = yes
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = tribal
						}
					}
				}
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 52
manifest_destiny_invasion = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_INVASION
	sprite = 8
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	is_holy_war = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			OR = {
				ai = yes
				multiplayer = no
				NOT = {
					has_game_rule = {
						name = multiplayer_invasions
						value = off
					}
				}
			}
			OR = {
				AND = {
					dynasty = 613 # Seljuks
					NOT = { year = 1200 }
					has_regent = no
				}
				AND = {
					dynasty = 800 #Timurids
					has_regent = no
				}
			}
		}

		ROOT = {
			NOT = { is_liege_or_above = FROM }
			mercenary = no
		}
	}

	can_use_title = {
		capital_scope = {
			OR = {
				region = custom_persia
				region = custom_baluchistan
				region = custom_afghanistan
				region = custom_mesopotamia
				region = custom_azerbaijan
				region = custom_armenia
				region = custom_trebizond
				region = custom_nikaea
				region = custom_syria
				region = custom_arabia
				region = custom_jerusalem
				region = custom_egypt
				region = custom_khorasan
			}
		}

		# Target must have at least 3 counties within the target kingdom
		FROM = {
			num_of_realm_counties = {
				value = 3
				title = PREV
			}
		}

		# The attacker needs at least one county in the target kingdom, or a border
		ROOT = {
			any_realm_province = {
				OR = {
					county = { de_jure_liege_or_above  = PREVPREVPREV }
					any_neighbor_province = {
						county = { de_jure_liege_or_above  = PREVPREVPREVPREV }
					}
				}
			}
		}
	}

	is_valid = {
		always = yes
	}

	is_valid_title = {
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			imperial_decadence_minus_1_effect = yes
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			prestige = 200
			hidden_tooltip = {
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_magnificent }
						10 = { give_nickname = nick_the_glorious }
						10 = { give_nickname = nick_the_conqueror }
					}
				}
			}
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 200
				dynasty_head = {
					if = {
						limit = {
							uses_decadence = yes
							FROM = { NOT = { uses_decadence = yes } }
						}
						participation_scaled_decadence = -20
					}
				}
			}
		}
		FROM = {
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their manifest destiny invasion for the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		hidden_tooltip = { destroy_tradeposts_effect = yes }
		empty_province_effect = yes
		pf_liege_change_under_title_begin_effect = yes

		custom_tooltip = {
			text = other_invasion_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title_destroy_duchies = {
						title = PREV
						enemy = FROM
						is_crusade = yes # Even if the kingdom title holder is not participating in the war, gain holdings occupied by all participants
						type = invasion
					}
				}
			}
		}

		pf_liege_change_under_title_end_effect = yes
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		FROM = {
			prestige = 100
		}
		FROM = {
			if = {
				limit = {
					has_dlc = "Legacy of Rome"
					OR = {
						has_landed_title = e_byzantium
						has_landed_title = e_roman_empire
					}
					OR = {
					religion_group = christian
					religion_group = hellenic_pagan_group
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		ROOT = {
			prestige = -100
		}
	}

	on_reverse_demand = {
		FROM = {
			imperial_decadence_minus_1_effect = yes
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}
		FROM = {
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			if = {
				limit = {
					has_dlc = "Legacy of Rome"
					OR = {
						has_landed_title = e_byzantium
						has_landed_title = e_roman_empire

					AND = {
							independent = yes
							higher_tier_than = COUNT
							OR = {
								culture = roman
								religion = roman_pagan
							}
						}
					}
					OR = {
						religion_group = christian
						is_pagan_religion = yes
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = { #Focus on Coronation first.
			factor = 0.1
			has_dlc = "Holy Fury"
			ROOT = {
				is_feudal = yes
				OR = {
					religion = catholic
					religion = fraticelli
				}
				is_crowned_trigger = no
			}
		}
		modifier = {
			factor = 5
			always = yes
		}
		sufficient_treasury_for_war = yes
	}
}

# 53
cb_decadence_usurption = {
	name = CB_NAME_DECADENCE_USURPTION
	war_name = WAR_NAME_DECADENCE_USURPTION
	sprite = 11
	truce_days = 3650
	is_permanent = yes

	allowed_to_target_tributaries = no

	can_use = {
		cb_can_use_preamble = yes
		ROOT = {
			religion_group = muslim
		}

		FROM = {
			religion = ROOT
			trait = decadent
			dynasty = ROOT
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					ROOT = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		ROOT = {
			holy_order = no
			mercenary = no
		}
	}

	is_valid = {
		FROM = {
			trait = decadent
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					ROOT = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}

	is_valid_title = {
		ROOT = { has_landed_title = PREV }
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			participation_scaled_piety = 500
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_piety = 500
				participation_scaled_prestige = 250
			}
		}
		FROM = {
			prisoner = ROOT
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their decadence usurpation against the [This.GetFullName] against [From.GetBestName] (ID: [From.GetID])"
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
	}

	on_fail = {
		ROOT = {
			piety = -250
			prestige = -125
		}
		FROM = {
			piety = 100
			prestige = 50
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
			piety = -500
			prestige = -250
			pf_glory_minus2_effect = yes
		}

		FROM = {
			piety = 500
			prestige = 250
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 54
rivalry_cb = {
	name = CB_NAME_RIVALRY
	war_name = WAR_NAME_RIVALRY
	sprite = 7
	truce_days = 3650
	is_permanent = yes
	can_ask_to_join_war = no

	allowed_to_target_tributaries = no

	defender_unoccupied_warscore = yes

	sort_priority = 900

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = { attacking_religious_head_trigger = no }
		FROM = {
			NOT = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_humiliated_rival
				}
			}
			OR = {
				is_rival = ROOT
				is_foe = ROOT
				AND = {
					OR = {
						has_plot = plot_kill_character
						has_plot = plot_kill_spouse
						has_plot = plot_take_revenge
					}
					plot_is_known_by = ROOT
					plot_target_char = {
						OR = {
							character = ROOT
							is_child_of = ROOT
							is_mother = ROOT
							is_father = ROOT
							is_married = ROOT
						}
					}
				}
			}
		}
	}

	is_valid = {
		FROM = {
			OR = {
				is_rival = ROOT
				is_foe = ROOT
				AND = {
					OR = {
						has_plot = plot_kill_character
						has_plot = plot_kill_spouse
						has_plot = plot_take_revenge
					}
					plot_is_known_by = ROOT
					plot_target_char = {
						OR = {
							character = ROOT
							is_child_of = ROOT
							is_mother = ROOT
							is_father = ROOT
							is_married = ROOT
						}
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 250
			}
		}

		ROOT = {
			remove_opinion = {
				who = FROM
				modifier = opinion_humiliated_rival
			}
		}

		FROM = {
			prestige = -250
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes

			imprison = ROOT
			opinion = {
				modifier = opinion_humiliated_rival
				who = ROOT
				years = 150
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -125
		}
		FROM = {
			prestige = 50
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			participation_scaled_prestige = 250
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_prestige = 250
			}
		}
		ROOT = {
			prestige = -250
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
			imprison = FROM
			opinion = {
				modifier = opinion_humiliated_rival
				who = FROM
				years = 150
			}
		}

		FROM = {
			remove_opinion = {
				who = ROOT
				modifier = opinion_humiliated_rival
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 55
tributary_cb = {
	name = CB_NAME_TRIBUTARY
	war_name = WAR_NAME_TRIBUTARY
	sprite = 1
	truce_days = 365
	is_permanent = no
	hostile_against_others = yes
	can_ask_to_join_war = no
	display_on_map = no
	allowed_to_target_tributaries = no

	defender_unoccupied_warscore = yes

	sort_priority = 810

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		ROOT = {
			has_character_flag = trying_to_gain_tributary
		}
	}

	is_valid = {
		NOT = {
			ROOT = {
				rightful_religious_head_scope = {
					character = FROM
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		FROM = {
			save_event_target_as = target_loser
			prestige = -200
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
			custom_tooltip = {
				text = "REMOVE_PREVIOUS_SUZERAIN"
				hidden_tooltip = {
					any_suzerain = {
						event_target:target_loser = {
							remove_tributary = PREV
						}
					}
				}
			}
		}

		ROOT = {
			prestige = 200
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			if = {
				limit = { is_nomadic = yes}
				make_tributary = { who = FROM tributary_type = nomadic }
			}
			else = {
				make_tributary = { who = FROM tributary_type = forced }
			}
			hidden_tooltip = {
				add_character_modifier = {
					name = tributary_timer
					duration = 1825
					hidden = yes
				}
			}
		}

		if  = {
			limit = {
				ROOT = {
					uses_decadence = yes
				}
			}
			ROOT = {
				decadence = -10
			}
		}
		if  = {
			limit = {
				ROOT = {
					is_nomadic = yes
				}
			}
			ROOT = {
				clan_title = {
					ROOT = {
						any_vassal = {
							limit = { is_nomadic = yes }
							clan_title = {
								clan_opinion = {
									who = PREVPREVPREV
									modifier = won_tributary_war
									years = 5
								}
							}
						}
					}
				}
			}
		}

		if  = {
			limit = {
				ROOT = {
					is_tribal = yes
				}
			}
			ROOT = {
				any_vassal = {
					limit = { is_tribal = yes }
					opinion = {
						who = PREV
						modifier = won_tributary_war
						years = 5
					}
				}
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			prestige = 50
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}

		FROM = {
			prestige = 200
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
	}

	on_attacker_leader_death = {
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100

		modifier = {
			factor = 2
			FROM = {
				trait = proud
			}
		}

		modifier = {
			factor = 2
			FROM = {
				trait = brave
			}
		}

		modifier = {
			factor = 2
			FROM = {
				trait = greedy
			}
		}

		modifier = {
			factor = 3
			FROM = {
				tier = KING
			}
		}

		modifier = {
			factor = 0.85
			ROOT = {
				relative_power = { who = FROM power = 1.2 }
			}
		}

		modifier = {
			factor = 0.85
			ROOT = {
				relative_power = { who = FROM power = 1.5 }
			}
		}

		modifier = {
			factor = 0.8
			ROOT = {
				relative_power = { who = FROM power = 2.0 }
			}
		}

		modifier = {
			factor = 0.8
			ROOT = {
				relative_power = { who = FROM power = 2.5 }
			}
		}

		modifier = {
			factor = 0.8
			ROOT = {
				relative_power = { who = FROM power = 3 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 4 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 5 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 6 }
			}
		}

		modifier = {
			factor = 0.5
			ROOT = {
				relative_power = { who = FROM power = 8 }
			}
		}

		modifier = {
			factor = 0.25
			ROOT = {
				relative_power = { who = FROM power = 10 }
			}
		}

		modifier = {
			factor = 2
			ROOT = {
				distance_from_realm = { who = FROM value = 20 }
			}
		}

		modifier = {
			factor = 2
			ROOT = {
				distance_from_realm = { who = FROM value = 40 }
			}
		}

		modifier = {
			factor = 3
			ROOT = {
				distance_from_realm = { who = FROM value = 80 }
			}
		}

		modifier = {
			factor = 4
			ROOT = {
				distance_from_realm = { who = FROM value = 120 }
			}
		}
	}

	ai_will_do = {
		factor = 0
		modifier = { #Focus on Coronation first.
			factor = 0.1
			has_dlc = "Holy Fury"
			ROOT = {
				is_feudal = yes
				OR = {
					religion = catholic
					religion = fraticelli
				}
				is_crowned_trigger = no
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 56
free_tributary_cb = {
	name = CB_NAME_FREE_TRIBUTARY
	war_name = WAR_NAME_FREE_TRIBUTARY
	sprite = 25
	truce_days = 365
	is_permanent = yes
	hostile_against_others = yes
	can_ask_to_join_war = no
	is_independence = yes

	sort_priority = 1100

	can_use = {
		has_dlc = "Horse Lords"
		cb_can_use_preamble = yes
		ROOT = {
			OR = {
				AND = {
					is_tributary = yes
					suzerain = {
						OR = {
							character = FROM
							any_liege = {
								character = FROM
							}
						}
					}
				}
				any_vassal = {
					is_tributary = yes
					suzerain = {
						OR = {
							character = FROM
							any_liege = {
								character = FROM
							}
						}
					}
				}
			}
		}
	}

	can_use_gui = {
		check_if_crusader_trigger = yes
	}
	is_valid = {
		ROOT = {
			OR = {
				AND = {
					is_tributary = yes
					suzerain = {
						OR = {
							character = FROM
							any_liege = {
								character = FROM
							}
						}
					}
				}
				any_vassal = {
					is_tributary = yes
					suzerain = {
						OR = {
							character = FROM
							any_liege = {
								character = FROM
							}
						}
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		FROM = {
			prestige = -200
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}

		ROOT = {
			prestige = 200
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			if = {
				limit = {
					is_tributary = yes
					suzerain = {
						OR = {
							character = FROM
							any_liege = {
								character = FROM
							}
						}
					}
				}
				suzerain = {
					remove_tributary = PREV
				}
			}
			any_vassal = {
				limit = {
					is_tributary = yes
					suzerain = {
						OR = {
							character = FROM
							any_liege = {
								character = FROM
							}
						}
					}
				}
				suzerain = {
					remove_tributary = PREV
				}
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			prestige = 50
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}

		FROM = {
			prestige = 200
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
	}

	on_attacker_leader_death = {
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100

		modifier = {
			factor = 1.5
			FROM = {
				trait = proud
			}
		}

		modifier = {
			factor = 1.5
			FROM = {
				trait = brave
			}
		}

		modifier = {
			factor = 1.5
			FROM = {
				trait = greedy
			}
		}

		modifier = {
			factor = 2
			FROM = {
				tier = KING
			}
		}

		modifier = {
			factor = 0.80
			ROOT = {
				relative_power = { who = FROM power = 1.2 }
			}
		}

		modifier = {
			factor = 0.80
			ROOT = {
				relative_power = { who = FROM power = 1.5 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 2.0 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 2.5 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 3 }
			}
		}

		modifier = {
			factor = 0.7
			ROOT = {
				relative_power = { who = FROM power = 4 }
			}
		}

		modifier = {
			factor = 0.7
			ROOT = {
				relative_power = { who = FROM power = 5 }
			}
		}

		modifier = {
			factor = 0.7
			ROOT = {
				relative_power = { who = FROM power = 6 }
			}
		}

		modifier = {
			factor = 0.4
			ROOT = {
				relative_power = { who = FROM power = 8 }
			}
		}

		modifier = {
			factor = 0.1
			ROOT = {
				relative_power = { who = FROM power = 10 }
			}
		}

		modifier = {
			factor = 5
			ROOT = {
				distance_from_realm = { who = FROM value = 20 }
			}
		}

		modifier = {
			factor = 5
			ROOT = {
				distance_from_realm = { who = FROM value = 40 }
			}
		}

		modifier = {
			factor = 5
			ROOT = {
				distance_from_realm = { who = FROM value = 80 }
			}
		}

		modifier = {
			factor = 5
			ROOT = {
				distance_from_realm = { who = FROM value = 120 }
			}
		}
		modifier = {
			factor = 0.75
			FROM = {
				is_tributary = { type = voluntary }
			}
		}
	}

	ai_will_do = {
		factor = 1

		modifier = {
			factor = 1.5
		}
		modifier = { #Focus on Coronation first.
			factor = 0.1
			has_dlc = "Holy Fury"
			ROOT = {
				is_feudal = yes
				OR = {
					religion = catholic
					religion = fraticelli
				}
				is_crowned_trigger = no
			}
		}

		modifier = {
			factor = 4
			ROOT = {
				trait = greedy
			}
		}

		modifier = {
			factor = 2
			OR = {
				ROOT = {
					is_nomadic = yes
				}
				FROM = {
					is_nomadic = no
				}
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 57
cb_install_khan = {
	name = CB_NAME_INSTALLKHAN
	war_name = WAR_NAME_INSTALLKHAN
	sprite = 12
	truce_days = 3650

	is_revolt_cb = no
	can_call_vassals = yes
	attacker_can_call_allies = no
	major_revolt = yes

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		has_dlc = "Horse Lords"
		ROOT = {
			is_nomadic = yes
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
			any_demesne_title = {
				tier = count # has some land
			}
		}
		FROM = {
			any_demesne_title = {
				NOT = { lower_tier_than = ROOT }
				temporary = no
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}

		FROM = {
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
			any_demesne_title = {
				limit = { tier = EMPEROR }
				gain_title = { target = ROOT type = faction_demand }
			}
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		ROOT = {
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 250 }
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			prestige = -200
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
			prisoner = FROM
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	on_defender_leader_death = {
		hidden_tooltip = {
			any_attacker = {
				letter_event = {
					id = 251
				}
			}
		}

		end_war = invalid
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 58
nomad_dispute = {
	name = CB_NAME_DISPUTE
	war_name = CB_NAME_DISPUTE
	sprite = 16
	truce_days = 1095
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes
	press_claim = yes
	can_ask_to_join_war = no

	allowed_to_target_tributaries = no

	allow_distant = yes

	sort_priority = 700

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		has_dlc = "Horse Lords"
		cb_can_use_preamble = yes
		FROM = {
			is_nomadic = yes
		}
		ROOT = {
			is_nomadic = yes
			same_realm = FROM
			has_feud_with = FROM
		}

		ROOT = {
			mercenary = no
		}
	}

	can_use_title = {
		tier = count
		location = {
			NOT = { num_of_settlements = 1 }
		}
		FROM = {
			has_landed_title = PREV
		}
	}

	is_valid_title = {
		location = {
			NOT = { num_of_settlements = 1 }
		}
		FROM = {
			has_landed_title = PREV
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success_title = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}

		empty_province_effect = yes
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }

		FROM = {
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}

		ROOT = {
			participation_scaled_prestige = 100
			participation_scaled_piety = 50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				participation_scaled_piety = 50
			}
		}
	}

	on_fail_title = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}

		ROOT = {
			prestige = -200
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
			participation_scaled_piety = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				participation_scaled_piety = 50
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = {
			factor = 2
			always = yes
		}

		modifier = { #Focus on Coronation first.
			factor = 0.1
			has_dlc = "Holy Fury"
			ROOT = {
				is_feudal = yes
				OR = {
					religion = catholic
					religion = fraticelli
				}
				is_crowned_trigger = no
			}
		}
		sufficient_treasury_for_war = yes
	}

}

# 59
cb_liberate_nomad_duchy = {
	name = CB_NAME_LIBERATE_NOMAD
	war_name = WAR_NAME_LIBERATE_NOMAD
	sprite = 8
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes

	infamy_modifier = 0.75

	allowed_to_target_tributaries = no

	sort_priority = 810

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		FROM = {
			is_nomadic = yes
		}
		ROOT = {
			is_nomadic = no
			NOT = { pacifist = yes }
			NOT = { same_realm = FROM }
			mercenary = no
		}
		#use pagan county conquest instead
		NAND = {
			ROOT = {
				NOT = { has_character_modifier = county_conquest_timer }
				is_pagan_religion = yes
				is_reformed_pagan_religion = no
				NOT = { same_realm = FROM }
			}
			FROM = {
				NOT = { religion = ROOT }
			}
		}
		#use muslim county conquest instead
		NOT = {
			ROOT = {
				religion_group = muslim
				religion = FROM
				NOT = { has_character_modifier = county_conquest_timer }
			}
		}
	}

	can_use_title = {
		tier = count
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}

		# Needs a land border
		location = {
			any_neighbor_province = {
				owner = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
			}
		}

		any_de_jure_vassal_title = { # Can only liberate Duchies that are either outside of the Steppe region, or contains a Castle/City/Tribe
			tier = COUNT
			OR = {
				holder_scope = {
					character = FROM
				}
				holder_scope = {
					any_liege = {
						character = FROM
					}
				}
			}
			OR = {
				location = {
					NOT = {
						region = world_steppe
					}
				}
				location = {
					any_province_holding = {
						OR = {
							holding_type = city
							holding_type = castle
							holding_type = tribal
						}
					}
				}
			}
		}
	}

	is_valid = {
		FROM = {
			is_nomadic = yes
		}
		ROOT = {
			is_nomadic = no
			NOT = { pacifist = yes }
			NOT = { same_realm = FROM }
			mercenary = no
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}

		# Needs a land border
		location = {
			any_neighbor_province = {
				owner = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			participation_scaled_prestige = 200
			if = {
				limit = {
					uses_decadence = yes
				}
				participation_scaled_decadence = -10
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 200
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
			}
		}

		FROM = {
			prestige = -200
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}
	}

	on_success_title = {
		check_holy_order_donation_effect = yes
		empty_province_effect = yes
		pf_liege_change_under_title_begin_effect = yes

		ROOT = {
			vassalize_or_take_under_title = {
				title = PREV
				enemy = FROM
				anti_nomad = yes # Vassalize non-nomadic rulers
				type = invasion
			}
		}
		usurp_title = { target = ROOT type = invasion }

		pf_liege_change_under_title_end_effect = yes
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			prestige = -200
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			participation_scaled_prestige = 200
			if = {
				limit = {
					uses_decadence = yes
				}
				participation_scaled_decadence = -10
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_prestige = 200
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		modifier = { #Focus on Coronation first.
			factor = 0.1
			has_dlc = "Holy Fury"
			ROOT = {
				is_feudal = yes
				OR = {
					religion = catholic
					religion = fraticelli
				}
				is_crowned_trigger = no
			}
		}
		modifier = {
			factor = 0
			ROOT = { is_tribal = no }
			NOR = {
				ROOT = { trait = ambitious }
				location = { culture = ROOT }
				any_direct_de_jure_vassal_title = {
					OR = {
						AND = {
							holding_type = temple
							holder_scope = { religion = ROOT }
						}
						holding_type = castle
						holding_type = city
					}
				}
			}
		}
		modifier = {
			factor = 0
			location = { region = world_steppe_west }
			ROOT = {
				OR = {
					has_landed_title = e_byzantium
					any_liege = { has_landed_title = e_byzantium }
				}
			}
		}
		modifier = {
			factor = 0
			e_placeholder = {
				NOT = { had_title_flag = { flag = startup days = 365 } }
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 60
cb_minor_clan_revolt = {
	name = CB_NAME_MINOR_CLAN_REVOLT
	war_name = WAR_NAME_MINOR_CLAN_REVOLT
	sprite = 16
	truce_days = 365
	hostile_against_others = no
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes

	attacker_can_call_allies = no
	defender_can_call_allies = no
	can_ask_to_join_war = no

	is_independence = yes

	can_use = {
		ROOT = {
			primary_title = { temporary = yes } # Revolter or adventurer trigger
			war = no
			NOT = { is_liege_or_above = FROM }
			mercenary = no
		}
	}

	can_use_title = {
		tier = count
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success_title = {
		log = "[Root.GetBestName] (ID: [Root.GetID]) succeeded with their minor clan revolt against [From.GetBestName] (ID: [From.GetID])"
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}

		usurp_title_plus_barony_if_unlanded = { target = ROOT type = revolt }

		ROOT = {
			primary_title = {
				set_title_nomad = { title = THIS status = no }
			}
			switch_to_feudal_effect = yes
		}
		ROOT = {
			set_government_type = nomadic_government
			set_defacto_liege = FROM

			hidden_tooltip = {
				wealth = 100
			}
		}
		FROM = {
			clr_character_flag = has_current_revolt
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
			prestige = -100
		}
	}

	on_fail_title = {
		FROM = {
			clr_character_flag = has_current_revolt
			prestige = 10
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = {
			imprison = FROM
			hidden_tooltip = {
				add_character_modifier = {
					name = broken_spirit
					days = -1
				}
			}
		}
	}

	on_reverse_demand = {
		FROM = {
			clr_character_flag = has_current_revolt
			prestige = 20
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor
					who = ROOT
					months = 1200
				}
				add_character_modifier = {
					name = crushed_revolt
					days = 3650
				}
			}
		}
		ROOT = {
			imprison = FROM
			hidden_tooltip = {
				add_character_modifier = {
					name = broken_spirit
					days = -1
				}
			}
		}
	}

	on_attacker_leader_death = {
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 61
nomad_subjugation = {
	name = CB_NAME_PAGAN_SUBJUGATION
	war_name = WAR_NAME_PAGAN_SUBJUGATION
	sprite = 8
	truce_days = 365
	is_permanent = yes
	can_ask_to_join_war = yes

	allowed_to_target_tributaries = no
	defender_unoccupied_warscore = yes

	sort_priority = 1100

	can_use_gui = {
	#higher_tier_than between ROOT and FROM would be better but its tooltip doesn't say anything about comparing character tiers
		ROOT = {
			independent = yes
			OR = {
				prestige = 500
				has_opinion_modifier = {
					modifier = declared_independence_nomad
					who = FROM
				}
			}
		}
		OR = {
			ROOT = { higher_tier_than = king }
			NOT = { FROM = { tier = emperor } }
		}
		FROM = {
			is_nomadic = no
			OR = {
				AND = {
					is_tribal = yes
					ROOT = { population = 2500 }
				}
				ROOT = { population = 10000 }
				has_opinion_modifier = {
					modifier = declared_independence_nomad
					who = FROM
				}
			}
		}
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			is_nomadic = yes
			NOT = { same_realm = FROM }
			NOT = { is_liege_or_above = FROM }
			mercenary = no
			OR = {
				NOT = { has_character_modifier = launched_subjugation }
				has_opinion_modifier = {
					modifier = declared_independence_nomad
					who = FROM
				}
			}
			OR = {
				ai = yes
				multiplayer = no
				NOT = {
					has_game_rule = {
						name = multiplayer_invasions
						value = off
					}
				}
			}
		}

		FROM = {
			in_revolt = no
			is_nomadic = no # Nomads cannot be subjugated
			NOT = { is_offmap_governor = yes }
			NOT = {
				any_war = {
					defender = { character = PREVPREV }
					OR = {
						using_cb = nomad_subjugation
						using_cb = pagan_subjugation
					}
				}
			}
			OR = {
				NOT = { tier = EMPEROR }
				ROOT = { ai = no }
			}
		}
		OR = {
			ROOT = {
				ai = no
			}
			FROM = {
				any_realm_title = {
					tier = COUNT
					count = 5
				}
			}
		}
	}

	on_add = {
		ROOT = {
			if = {
				limit = {
					NOT = {
						has_opinion_modifier = {
							modifier = declared_independence_nomad
							who = FROM
						}
					}
				}
				prestige = -500
				add_character_modifier = {
					name = launched_subjugation
					years = 100
					hidden = yes
				}
			}
		}
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		hidden_tooltip = {
			ROOT = {
				if = {
					limit = {
						has_nickname = no
					}
					FROM = {
						save_event_target_as = nickname_target
					}
					ROOT = {
						save_event_target_as = nickname_receiver
					}
					random_list = {
						2 = { give_nickname = nick_the_eastern_wind }
						5 = { give_nickname = nick_the_despoiler }
						5 = {
							give_nickname = nick_the_bane_of_realmname
							modifier = {
								factor = 0
								event_target:nickname_target = { is_nomadic = yes }
							}
							modifier = {
								factor = 0
								event_target:nickname_target = { culture = ROOT }
							}
						}
						5 = {
							give_nickname = nick_the_culture_marauder
							modifier = {
								factor = 0
								event_target:nickname_target = { is_nomadic = yes }
							}
							modifier = {
								factor = 0
								event_target:nickname_target = { culture = ROOT }
							}
						}
						100 = { }
					}
				}
			}
		}
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			piety = 100
			prestige = 300
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		FROM = {
			piety = -100
			prestige = -100

			if = {
				limit = {
					ROOT = { is_reformed_pagan_religion = yes }
					controls_religion = no
				}
				religion = ROOT # Reformed pagans are forced to convert back
			}

			custom_tooltip = {
				text = tribal_subjugation_tip
			}

			hidden_tooltip = {
				opinion = {
					modifier = opinion_subjugated
					who = ROOT
				}
				any_vassal = {
					opinion = {
						modifier = opinion_subjugated
						who = ROOT
					}
				}

				any_demesne_title = {
					limit = {
						higher_tier_than = ROOT
						NOT = { controls_religion = yes }
					}
					ROOT = { grant_title_no_opinion = { target = PREV type = invasion } }
					add_pressed_claim = PREV
				}

				any_demesne_title = {
					limit = {
						tier = ROOT
						NOT = { controls_religion = yes }
					}
					ROOT = { grant_title_no_opinion = { target = PREV type = invasion } }
					add_pressed_claim = PREV
				}
				if = {
					limit = {
						NOT = {
							any_demesne_title = {
								controls_religion = yes
							}
						}
					}
					set_defacto_liege = ROOT
					pf_liege_change_effect = yes
					break = yes
				}
				any_vassal = {
					set_defacto_liege = ROOT
					pf_liege_change_effect = yes
				}
				any_demesne_title = {
					limit = {
						NOT = { controls_religion = yes }
					}
					ROOT = {
						grant_title_no_opinion = { target = PREV type = invasion }
					}
				}
			}
		}

		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		FROM = {
			piety = 50
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		ROOT = {
			piety = -100
		}
	}

	on_invalidation = {
		if = {
			limit = {
				NOT = {
					has_opinion_modifier = {
						modifier = declared_independence_nomad
						who = FROM
					}
				}
			}
			ROOT = {
				remove_character_modifier = launched_subjugation
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			piety = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
		}
		FROM = {
			piety = 100
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
		}
		FROM = {
			if = {
				limit = {
					has_dlc = "Legacy of Rome"
					OR = {
						has_landed_title = e_byzantium
						has_landed_title = e_roman_empire
					}
					OR = {
						religion_group = christian
						religion_group = hellenic_pagan_group
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = 200
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 10
		modifier = {
			factor = 0
			ROOT = {
				has_character_flag = is_temujin
				has_landed_title = e_mongol_empire
				demesne_size = 1
			}
			FROM = {
				has_landed_title = e_china_west_governor
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 62
nomad_invasion = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_INVASION
	sprite = 8
	truce_days = 1825
	hostile_against_others = yes
	is_permanent = yes
	is_holy_war = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	allowed_to_target_tributaries = no

	sort_priority = 1000

	can_use_gui = {
		ROOT = {
			prestige = 500
			population = 30000
			conditional_tooltip = { #Mongols can use this CB more easily
				trigger = {
					has_landed_title = e_mongol_empire
				}
				population_factor = 0.50
			}
			conditional_tooltip = {
				trigger = {
					NOT = { has_landed_title = e_mongol_empire }
				}
				population_factor = 0.75 # 75% of max
			}
		}
	}

	on_add = {
		ROOT = { prestige = -500 }
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			is_nomadic = yes
			OR = {
				ai = yes
				multiplayer = no
				NOT = {
					has_game_rule = {
						name = multiplayer_invasions
						value = off
					}
				}
			}
			is_within_diplo_range = FROM
		}

		ROOT = {
			NOT = { same_realm = FROM }
		}

		OR = { # This ensures that the AI doesn't declare this type of war against someone who only holds a few counties within the targeted title...
			ROOT = {
				ai = no
			}
			ROOT = {
				has_landed_title = e_mongol_empire
			}
			FROM = {
				num_of_realm_counties = {
					value = 8
					title = PREV
				}
			}
		}
	}

	is_valid_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			prestige = 500
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 500 }
		}
		FROM = {
			prestige = -250
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}
		hidden_tooltip = {
			ROOT = {
				if = {
					limit = {
						has_nickname = no
					}
					FROM = {
						save_event_target_as = nickname_target
					}
					ROOT = {
						save_event_target_as = nickname_receiver
					}
					random_list = {
						5 = { give_nickname = nick_the_great }
						5 = { give_nickname = nick_the_victorious }
						5 = { give_nickname = nick_the_conqueror }
						5 = { give_nickname = nick_the_brave }
						10 = { give_nickname = nick_the_dragon }
						10 = { give_nickname = nick_the_terrible }
						10 = { give_nickname = nick_the_eastern_wind }
						25 = { give_nickname = nick_the_despoiler }
						25 = {
							give_nickname = nick_the_culture_marauder
							modifier = {
								factor = 0
								event_target:nickname_target = { is_nomadic = yes }
							}
							modifier = {
								factor = 0
								event_target:nickname_target = { culture = ROOT }
							}
						}
						50 = {
							give_nickname = nick_the_bane_of_realmname
							modifier = {
								factor = 0
								event_target:nickname_target = { is_nomadic = yes }
							}
							modifier = {
								factor = 0
								event_target:nickname_target = { culture = ROOT }
							}
						}
						50 = {
							give_nickname = nick_the_slayer_of_culture
							modifier = {
								factor = 0
								event_target:nickname_target = { culture = ROOT }
							}
						}
						50 = {
							give_nickname = nick_the_scourge_of_god
							modifier = {
								factor = 0
								event_target:nickname_target = { religion = ROOT }
							}
						}
					}
				}
			}
		}
	}

	on_success_title = {
		hidden_tooltip = { destroy_tradeposts_effect = yes }
		empty_province_effect = yes
		pf_liege_change_under_title_begin_effect = yes
		hidden_tooltip = {
			ROOT = {
				occupy_minors_of_occupied_settlements = FROM
				gain_all_occupied_titles = { who = FROM type = invasion }
			}
		}
		custom_tooltip = {
			text = tribal_invasion_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title_destroy_duchies = {
						title = PREV
						enemy = FROM
						is_crusade = yes # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
						type = invasion
					}
				}
			}
		}
		pf_liege_change_under_title_end_effect = yes

		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		FROM = {
			prestige = 100

			hidden_tooltip = {
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_hammer }
						10 = { give_nickname = nick_the_avenger }
						10 = { give_nickname = nick_the_lion }
						10 = { give_nickname = nick_the_bold }
					}
				}
			}
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		ROOT = {
			prestige = -250
		}
		log = "Nomad Invasion Failed [Root.GetTitledName]"
	}

	on_invalidation = {
		log = "Nomad Invasion Invalidated [Root.GetTitledName]"
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -250
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			prestige = 250
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			hidden_tooltip = {
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_hammer }
						10 = { give_nickname = nick_the_avenger }
						10 = { give_nickname = nick_the_lion }
						10 = { give_nickname = nick_the_bold }
					}
				}
			}

			if = {
				limit = {
					has_dlc = "Legacy of Rome"
					OR = {
						has_landed_title = e_byzantium
						has_landed_title = e_roman_empire
					}
						OR = {
							religion_group = christian
							religion_group = hellenic_pagan_group
						}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
			participation_scaled_prestige = 250
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 250 }
		}
	}

	attacker_ai_victory_worth = {
		factor = 200
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 8

		modifier = {
			factor = 0.9 # Prefer using CB's without on_add costs
		}

		# Try to guide the Hordes in the right direction
		modifier = {
			factor = 0.1
			ROOT = {
				OR = {
					dynasty = 613 # Seljuks
					dynasty = 800 # Timurids
					primary_title = { title = e_il-khanate }
				}
			}
			OR = {
				capital_scope = {
					NOR = {
						region = world_europe_south_east
						region = world_asia_minor
						region = world_middle_east
						region = world_persia
					}
				}
				FROM = {
					primary_title = { title = e_golden_horde }
					NOT = { year = 1300 }
				}
			}
		}
		modifier = {
			factor = 0.1
			ROOT = {
				primary_title = { title = e_golden_horde }
			}
			OR = {
				capital_scope = {
					OR = {
						region = world_europe_south_east
						region = world_asia_minor
						region = world_middle_east
						region = world_persia
					}
				}
				FROM = {
					primary_title = { title = e_il-khanate }
					NOT = { year = 1300 }
				}
			}
		}
		modifier = {
			factor = 0
			ROOT = { culture = hungarian }
			capital_scope = {
				OR = {
					region = custom_cuman
					region = custom_volga
					region = custom_alania
					region = custom_novgorod
					region = custom_muscovy
					region = custom_rus
				}
			}
		}
		modifier = {
			factor = 0
			ROOT = { culture = khazar }
			capital_scope = {
				OR = {
					region = world_steppe_tarim
					region = world_steppe_east
					region = custom_cuman
					region = custom_perm
					region = custom_volga
				}
			}
		}
		modifier = {
			factor = 2.0
			ROOT = { culture = hungarian }
			capital_scope = {
				OR = {
					region = custom_bulgaria
					region = custom_carpathia
				}
			}
		}
		modifier = {
			factor = 0
			ROOT = {
				has_character_flag = is_temujin
				has_landed_title = e_mongol_empire
				demesne_size = 1
			}
			FROM = {
				has_landed_title = e_china_west_governor
			}
		}
		modifier = {
			factor = 5
			ROOT = { trait = bloodlust }
		}
		sufficient_treasury_for_war = yes
	}
}

# 63
nomad_expansion = {
	name = CB_NAME_NOMAD_EXPANSION
	war_name = WAR_NAME_NOMAD_EXPANSION
	sprite = 8
	truce_days = 1825
	is_permanent = yes
	is_holy_war = yes
	check_de_jure_tier = DUKE # this scans all de jure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes

	allowed_to_target_tributaries = no

	sort_priority = 800

	can_use_gui = {
		ROOT = {
			prestige = 250
			population_factor = 0.5
		}
		FROM = {
			OR = {
				is_nomadic = yes # Nomads no population requirement
				AND = {
					is_tribal = yes
					ROOT = { population = 5000 } # Tribals need 5k
				}
				ROOT = { population = 15000 } # Everyone else needs 15k
			}
		}
	}

	on_add = {
		ROOT = { prestige = -250 }
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	can_use = {
		cb_can_use_preamble = yes
		cb_no_nap_with_suzerain_trigger = yes
		ROOT = {
			is_nomadic = yes
			NOT = { same_realm = FROM }
			mercenary = no
		}
	}

	can_use_title = {
		# The attacker needs at least one county in the target duchy, or a border
		any_direct_de_jure_vassal_title = {
			OR = {
				holder_scope = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
				location = {
					any_neighbor_province = {
						has_owner = yes
						owner = {
							OR = {
								character = ROOT
								is_liege_or_above = ROOT
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			NOR = {
				pays_tribute_to = FROM
				any_liege = {
					OR = {
						pays_tribute_to = FROM
						FROM = {
							pays_tribute_to = PREV
						}
					}
				}
			}
			is_nomadic = yes
			NOT = { same_realm = FROM }
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			if = {
				limit = {
					has_nickname = no
				}
				FROM = {
						save_event_target_as = nickname_target
					}
				ROOT = {
					save_event_target_as = nickname_receiver
				}
				random_list = {
					5 = { give_nickname = nick_the_eastern_wind }
					5 = { give_nickname = nick_the_despoiler }
					5 = {
						give_nickname = nick_the_culture_marauder
						modifier = {
							factor = 0
							event_target:nickname_target = { is_nomadic = yes }
						}
						modifier = {
							factor = 0
							event_target:nickname_target = { culture = ROOT }
						}
					}
					5 = {
						give_nickname = nick_the_bane_of_realmname
						modifier = {
							factor = 0
							event_target:nickname_target = { is_nomadic = yes }
						}
						modifier = {
							factor = 0
							event_target:nickname_target = { culture = ROOT }
						}
					}
					5 = {
						give_nickname = nick_the_slayer_of_culture
						modifier = {
							factor = 0
							event_target:nickname_target = { culture = ROOT }
						}
					}
					5 = {
						give_nickname = nick_the_scourge_of_god
						modifier = {
							factor = 0
							event_target:nickname_target = { religion = ROOT }
						}
					}
					100 = { }
				}
			}
			participation_scaled_prestige = 250
			if = {
				limit = {
					uses_decadence = yes
				}
				participation_scaled_decadence = -10
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 250
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
			}
		}
		FROM = {
			prestige = -250
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}
	}

	on_success_title = {
		hidden_tooltip = { destroy_tradeposts_effect = yes }
		empty_province_effect = yes

		pf_liege_change_under_title_begin_effect = yes

		custom_tooltip = {
			text = pagan_subjugation_tip
			hidden_tooltip = {
				ROOT = {
					subjugate_or_take_under_title = {
						title = PREV
						enemy = FROM
#						same_religion = yes # Only vassalize rulers of my religion
					}
				}
			}
		}

		pf_liege_change_under_title_end_effect = yes
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
	}

	on_reverse_demand = {
		FROM = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
		}
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			prestige = -200
			imperial_decadence_plus_1_effect = yes
			pf_glory_minus2_effect = yes
		}
		FROM = {
			participation_scaled_prestige = 200
			if = {
				limit = {
					uses_decadence = yes
				}
				participation_scaled_decadence = -10
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_prestige = 200
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 2

		# Try to guide the Hordes in the right direction
		modifier = {
			factor = 0.1
			ROOT = {
				OR = {
					dynasty = 613 # Seljuks
					dynasty = 800 # Timurids
					primary_title = { title = e_il-khanate }
				}
			}
			OR = {
				capital_scope = {
					NOR = {
						region = world_europe_south_east
						region = world_asia_minor
						region = world_middle_east
						region = world_persia
					}
				}
				FROM = {
					primary_title = { title = e_golden_horde }
					NOT = { year = 1300 }
				}
			}
		}
		modifier = { # Temujin should prefer bigger targets
			factor = 0.1
			ROOT = {
				has_character_flag = is_temujin
			}
		}
		modifier = { # Temujin's heir should prefer bigger targets
			factor = 0.5
			ROOT = {
				father_even_if_dead = { has_character_flag = is_temujin }
			}
		}
		modifier = {
			factor = 0.1
			ROOT = {
				primary_title = { title = e_golden_horde }
			}
			OR = {
				capital_scope = {
					OR = {
						region = world_europe_south_east
						region = world_asia_minor
						region = world_middle_east
						region = world_persia
					}
				}
				FROM = {
					primary_title = { title = e_il-khanate }
					NOT = { year = 1300 }
				}
			}
		}
		modifier = {
			factor = 2.0
			OR = {
				culture = persian
				culture = baloch
				culture = afghan
				culture = turkish
			}
			capital_scope = {
				OR = {
					region = world_persia
					region = world_india_rajastan
				}
			}
		}
		modifier = {
			factor = 0.1
			ROOT = { culture = hungarian }
			capital_scope = {
				OR = {
					region = custom_cuman
					region = custom_volga
					region = custom_alania
					region = custom_novgorod
					region = custom_muscovy
					region = custom_rus
				}
			}
		}
		modifier = {
			factor = 0.1
			ROOT = { culture = khazar }
			capital_scope = {
				OR = {
					region = world_steppe_tarim
					region = world_steppe_east
					region = custom_cuman
					region = custom_perm
					region = custom_volga
				}
			}
		}
		modifier = {
			factor = 2.0
			ROOT = { culture = hungarian }
			capital_scope = {
				OR = {
					region = custom_bulgaria
					region = custom_carpathia
				}
			}
		}
		modifier = {
			factor = 0
			ROOT = {
				has_character_flag = is_temujin
				has_landed_title = e_mongol_empire
				demesne_size = 1
			}
			FROM = {
				has_landed_title = e_china_west_governor
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 64
increase_council_power_war = {
	name = CB_NAME_INCREASE_COUNCIL_POWER
	war_name = WAR_NAME_INCREASE_COUNCIL_POWER
	sprite = 6
	truce_days = 3650
	can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		ROOT = {
			vassal_of = FROM
		}
	}

	can_use_title = {
		higher_tier_than = BARON
		OR = {
			has_law = law_voting_power_0
			has_law = banish_voting_power_0
			has_law = execution_voting_power_0
			has_law = revoke_title_voting_power_0
			has_law = grant_title_voting_power_0
			has_law = imprison_voting_power_0
			has_law = war_voting_power_0
		}
		is_primary_holder_title = yes
	}

	is_valid = {
		FROM = {
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			opinion = {
				modifier = opinion_increased_council_power
				who = FROM
				months = 12
			}
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_success_title = {
		if = {
			limit = { has_law = law_voting_power_0 }
			add_law_w_cooldown = law_voting_power_1
			break = yes
		}
		if = {
			limit = { has_law = war_voting_power_0 }
			add_law_w_cooldown = war_voting_power_1
			break = yes
		}
		if = {
			limit = { has_law = revoke_title_voting_power_0 }
			add_law_w_cooldown = revoke_title_voting_power_1
			break = yes
		}
		if = {
			limit = { has_law = imprison_voting_power_0 }
			add_law_w_cooldown = imprison_voting_power_1
			break = yes
		}
		if = {
			limit = { has_law = grant_title_voting_power_0 }
			add_law_w_cooldown = grant_title_voting_power_1
			break = yes
		}
		if = {
			limit = { has_law = banish_voting_power_0 }
			add_law_w_cooldown = banish_voting_power_1
			break = yes
		}
		if = {
			limit = { has_law = execution_voting_power_0 }
			add_law_w_cooldown = execution_voting_power_1
			break = yes
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}

		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}

		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_council_power_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			prisoner = FROM
		}

		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_council_power_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 65
nomad_humiliate_cb = {
	name = CB_NAME_HUMILIATE
	war_name = WAR_NAME_HUMILIATE
	sprite = 1
	truce_days = 3650
	is_permanent = yes
	hostile_against_others = yes
	can_ask_to_join_war = no
	display_on_map = no
	allowed_to_target_tributaries = no

	defender_unoccupied_warscore = yes

	sort_priority = 815

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		has_dlc = "Horse Lords"

		FROM = {
			is_nomadic = yes
		}

		ROOT = {
			is_nomadic = yes
			mercenary = no
			OR = {
				AND = {
					same_realm = FROM
					has_feud_with = FROM
				}
				FROM = {
					is_nomadic = yes
					independent = yes
				}
			}
		}

		# The attacker needs a border, or be at most two sea zones away from one of the target's counties
		FROM = {
			any_realm_province = {
				any_neighbor_province = {
					OR = {
						AND = {
							has_owner = yes
							owner = {
								OR = {
									character = ROOT
									is_liege_or_above = ROOT
								}
							}
						}
						AND = {
							is_land = no
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												character = ROOT
												is_liege_or_above = ROOT
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											owner = {
												OR = {
													character = ROOT
													is_liege_or_above = ROOT
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		ROOT = {
			add_character_modifier = { name = victory_timer duration = 1 hidden = yes }
			pf_glory_plus2_effect = yes
			prestige = 300
			steal_population_scaled = {
				target = FROM
				percentage = 0.25
			}
		}
		FROM = {
			prestige = -300
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			prestige = 100
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}

		FROM = {
			prestige = 200
		}
	}

	on_attacker_leader_death = {
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100

		modifier = {
			factor = 2
			FROM = {
				trait = proud
			}
		}

		modifier = {
			factor = 2
			FROM = {
				trait = brave
			}
		}

		modifier = {
			factor = 2
			FROM = {
				trait = greedy
			}
		}

		modifier = {
			factor = 3
			FROM = {
				tier = KING
			}
		}

		modifier = {
			factor = 0.85
			ROOT = {
				relative_power = { who = FROM power = 1.2 }
			}
		}

		modifier = {
			factor = 0.85
			ROOT = {
				relative_power = { who = FROM power = 1.5 }
			}
		}

		modifier = {
			factor = 0.8
			ROOT = {
				relative_power = { who = FROM power = 2.0 }
			}
		}

		modifier = {
			factor = 0.8
			ROOT = {
				relative_power = { who = FROM power = 2.5 }
			}
		}

		modifier = {
			factor = 0.8
			ROOT = {
				relative_power = { who = FROM power = 3 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 4 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 5 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 6 }
			}
		}

		modifier = {
			factor = 0.5
			ROOT = {
				relative_power = { who = FROM power = 8 }
			}
		}

		modifier = {
			factor = 0.25
			ROOT = {
				relative_power = { who = FROM power = 10 }
			}
		}

		modifier = {
			factor = 2
			ROOT = {
				distance_from_realm = { who = FROM value = 20 }
			}
		}

		modifier = {
			factor = 2
			ROOT = {
				distance_from_realm = { who = FROM value = 40 }
			}
		}

		modifier = {
			factor = 3
			ROOT = {
				distance_from_realm = { who = FROM value = 80 }
			}
		}

		modifier = {
			factor = 4
			ROOT = {
				distance_from_realm = { who = FROM value = 120 }
			}
		}
	}

	ai_will_do = {
		factor = 1

		modifier = {
			factor = 0.1 # Low prio CB
		}

		modifier = {
			factor = 0.1 # Target has almost no money
			FROM = {
				OR = {
					is_nomadic = yes
					is_tribal = yes
				}
			}
		}

		modifier = {
			factor = 4
			ROOT = {
				trait = greedy
			}
		}
		sufficient_treasury_for_war = yes
	}
}

# 64
powerful_vassal_takeover_war = {
	name = CB_NAME_POWERFUL_VASSAL_TAKEOVER
	war_name = WAR_NAME_POWERFUL_VASSAL_TAKEOVER
	sprite = 6
	truce_days = 3650
	can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes

	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		ROOT = {
			vassal_of = FROM
		}
	}

	can_use_title = {
		higher_tier_than = BARON
		is_primary_holder_title = yes
	}

	is_valid = {
		FROM = {
			in_revolt = no
			has_character_flag = powerful_vassal_takeover_target
		}
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = {
					FROM = {
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { defender = { is_offmap_governor = offmap_china } }
			attacker = {
				sound_effect = china_angered_emperor
				detract_grace_super_huge_effect = yes
			}
		}
	}

	on_success = {
		any_attacker = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_success_title = { #This is the target title of the faction
		if = {
			limit = { has_law = law_voting_power_0 }
			add_law_w_cooldown = law_voting_power_1
		}
		if = {
			limit = { has_law = war_voting_power_0 }
			add_law_w_cooldown = war_voting_power_1
		}
		if = {
			limit = {
				NOR = {
					has_law = succ_feudal_elective
					has_law = succ_hre_elective
					has_law = succ_byzantine_elective
				}
			}
			if = {
				limit = {
					OR = {
						title = e_hre
						has_title_flag = alternate_hre
					}
				}
				add_law_w_cooldown = succ_hre_elective
			}
			else_if = {
				limit = {
					OR = {
						title = e_byzantium
						title = e_roman_empire
					}
				}
				add_law_w_cooldown = succ_byzantine_elective
			}
			else = {
				add_law_w_cooldown = succ_feudal_elective
			}
		}
		holder_scope = {
			clr_character_flag = powerful_vassal_takeover_target
			most_popular_vassal = {
				limit = {
					higher_tier_than = BARON
					is_feudal = yes
					prisoner = no
					NOR = {
						is_inaccessible_trigger = yes
						trait = incapable
						trait = eunuch
					}
					age = 16
					#can_hold_title = PREVPREV
					OR = {
						is_female = no
						AND = {
							is_female = yes
							ROOT = { has_law = true_cognatic_succession }
						}
					}
				}
				usurp_title = {
					target = PREVPREV
					type = faction_demand
				}
				save_event_target_as = new_title_holder
				hidden_tooltip = {
					any_attacker = {
						limit = { NOT = { character = PREV } }
						set_character_flag = helped_win_war
					}
				}
				character_event = { id = 8226 days = 1 }
			}
		}
		hidden_tooltip = {
			check_if_reconquista_finished_effect = yes
			FROM = {
				landless_pope_effect = yes
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}

		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}

		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_powerful_vassal_takeover_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = {
			hidden_tooltip = {
				disband_event_forces = faction_loyalists
				clr_character_flag = powerful_vassal_takeover_target
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			prisoner = FROM
		}

		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_powerful_vassal_takeover_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = {
			hidden_tooltip = {
				disband_event_forces = faction_loyalists
				clr_character_flag = powerful_vassal_takeover_target
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 65 Disabled
reconquista_leon = {
	name = CB_NAME_RECONQUISTA_LEON
	war_name = WAR_NAME_RECONQUISTA_LEON
	diplo_view_region = custom_leon
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	battle_warscore_mult = 0.5
	#max_defender_occupation_score = 85
	allow_whitepeace = no

	allowed_to_target_tributaries = yes
	can_ask_to_join_war = yes

	sort_priority = 10000

	can_use_gui = {
		ROOT = {
			prisoner = no
			is_adult = yes
		}
	}

	can_use = {
		always = no
		ROOT = {
			has_character_flag = currently_reconquering_iberia
			not_reconquista_check_trigger = yes

			any_realm_province = {
				OR = {
					AND = {
						any_neighbor_province = {
							region = custom_leon
						}
					}
					AND = {
						NOT = {
							any_neighbor_province = {
								region = custom_leon
							}
						}
						NOT = {
							any_neighbor_province = {
								region = world_europe_west_iberia
								owner = {
									OR = {
										AND = {
											independent = yes
											NOT = {
												religion_group = christian
											}
										}
										top_liege = {
											NOT = {
												religion_group = christian
											}
										}
									}
								}
							}
						}
						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								region = custom_leon
							}
						}
					}
					AND = {
						NOR = {
							any_neighbor_province = {
								region = custom_leon
							}
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_leon
								}
							}
						}
						NOT = {
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = world_europe_west_iberia
									owner = {
										OR = {
											AND = {
												independent = yes
												NOT = {
													religion_group = christian
												}
											}
											top_liege = {
												NOT = {
													religion_group = christian
												}
											}
										}
									}
								}
							}
						}
						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_leon
								}
							}
						}
					}
				}
			}

			conditional_tooltip = {
				trigger = {
					ai = yes
				}

				NOT = {
					has_character_modifier = reconquista_preparation_duration
				}
			}
		}

		FROM = {
			any_realm_province = {
				region = custom_leon
			}
			NOT = {
				religion_group = ROOT
			}
		}
	}

	is_valid = {
		ROOT = {
			show_scope_change = no
			custom_tooltip = {
				text = reconquista_valid_TT

				has_character_flag = currently_reconquering_iberia
			}
		}
		custom_tooltip = {
			text = reconquista_valid_2_TT

			FROM = {
				NOT = {
					religion_group = ROOT
				}
			}
		}
	}

	on_add = {
		custom_tooltip = { text = add_allies_reconquista_TT }
		ROOT = {
			character_event = { id = HF.49210 }
		}
	}

	on_success = {

		d_leon = {
			save_event_target_as = first_duchy_title
		}

		d_asturias = {
			save_event_target_as = second_duchy_title
		}
		if = {
			limit = {
				k_asturias = {
					is_titular = yes
				}
			}
			k_leon = {
				save_event_target_as = reconquista_kingdom_title
			}
		}
		else = {
			k_asturias = {
				save_event_target_as = reconquista_kingdom_title
			}
		}


		reconquista_win_effect = yes
	}

	on_reverse_demand = {
		reconquista_lose_effect = yes
	}

	on_invalidation = {
		ROOT = {
			character_event = { id = HF.49200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 66 Disabled
reconquista_castille = {
	name = CB_NAME_RECONQUISTA_CASTILLE
	war_name = WAR_NAME_RECONQUISTA_CASTILLE
	diplo_view_region = custom_castille
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	battle_warscore_mult = 0.5
	#max_defender_occupation_score = 85
	allow_whitepeace = no

	allowed_to_target_tributaries = yes
	can_ask_to_join_war = yes

	sort_priority = 10000

	can_use_gui = {
		ROOT = {
			prisoner = no
			is_adult = yes
		}
	}

	can_use = {
		always = no
		ROOT = {
			has_character_flag = currently_reconquering_iberia
			not_reconquista_check_trigger = yes

			any_realm_province = {
				OR = {
					AND = {
						any_neighbor_province = {
							region = custom_castille
						}
					}
					AND = {
						NOT = {
							any_neighbor_province = {
								region = custom_castille
							}
						}
						NOT = {
							any_neighbor_province = {
								region = world_europe_west_iberia
								owner = {
									OR = {
										AND = {
											independent = yes
											NOT = {
												religion_group = christian
											}
										}
										top_liege = {
											NOT = {
												religion_group = christian
											}
										}
									}
								}
							}
						}
						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								region = custom_castille
							}
						}
					}
					AND = {
						NOR = {
							any_neighbor_province = {
								region = custom_castille
							}
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_castille
								}
							}
						}
						NOT = {
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = world_europe_west_iberia
									owner = {
										OR = {
											AND = {
												independent = yes
												NOT = {
													religion_group = christian
												}
											}
											top_liege = {
												NOT = {
													religion_group = christian
												}
											}
										}
									}
								}
							}
						}
						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_castille
								}
							}
						}
					}
				}
			}

			conditional_tooltip = {
				trigger = {
					ai = yes
				}

				NOT = {
					has_character_modifier = reconquista_preparation_duration
				}
			}
		}

		FROM = {
			any_realm_province = {
				region = custom_castille
			}
			NOT = {
				religion_group = ROOT
			}
		}
	}

	is_valid = {
		ROOT = {
			show_scope_change = no
			custom_tooltip = {
				text = reconquista_valid_TT

				has_character_flag = currently_reconquering_iberia
			}
		}
		custom_tooltip = {
			text = reconquista_valid_2_TT

			FROM = {
				NOT = {
					religion_group = ROOT
				}
			}
		}
	}

	on_add = {
		custom_tooltip = { text = add_allies_reconquista_TT }
		ROOT = {
			character_event = { id = HF.49210 }
		}
	}

	on_success = {

		d_castilla = {
			save_event_target_as = first_duchy_title
		}

		d_toledo = {
			save_event_target_as = second_duchy_title
		}
		k_castille = {
			save_event_target_as = reconquista_kingdom_title
		}

		reconquista_win_effect = yes
	}

	on_reverse_demand = {
		reconquista_lose_effect = yes
	}

	on_invalidation = {
		ROOT = {
			character_event = { id = HF.49200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 67 Disabled
reconquista_aragon = {
	name = CB_NAME_RECONQUISTA_ARAGON
	war_name = WAR_NAME_RECONQUISTA_ARAGON
	diplo_view_region = custom_aragon
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	battle_warscore_mult = 0.5
	#max_defender_occupation_score = 85
	allow_whitepeace = no

	allowed_to_target_tributaries = yes
	can_ask_to_join_war = yes

	sort_priority = 10000

	can_use_gui = {
		ROOT = {
			prisoner = no
			is_adult = yes
		}
	}

	can_use = {
		always = no
		ROOT = {
			has_character_flag = currently_reconquering_iberia
			not_reconquista_check_trigger = yes

			any_realm_province = {
				OR = {
					AND = {
						any_neighbor_province = {
							region = custom_aragon
						}
					}
					AND = {
						NOT = {
							any_neighbor_province = {
								region = custom_aragon
							}
						}
						NOT = {
							any_neighbor_province = {
								region = world_europe_west_iberia
								owner = {
									OR = {
										AND = {
											independent = yes
											NOT = {
												religion_group = christian
											}
										}
										top_liege = {
											NOT = {
												religion_group = christian
											}
										}
									}
								}
							}
						}
						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								region = custom_aragon
							}
						}
					}
					AND = {
						NOR = {
							any_neighbor_province = {
								region = custom_aragon
							}
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_aragon
								}
							}
						}
						NOT = {
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = world_europe_west_iberia
									owner = {
										OR = {
											AND = {
												independent = yes
												NOT = {
													religion_group = christian
												}
											}
											top_liege = {
												NOT = {
													religion_group = christian
												}
											}
										}
									}
								}
							}
						}
						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_aragon
								}
							}
						}
					}
				}
			}

			conditional_tooltip = {
				trigger = {
					ai = yes
				}

				NOT = {
					has_character_modifier = reconquista_preparation_duration
				}
			}
		}

		FROM = {
			any_realm_province = {
				region = custom_aragon
			}
			NOT = {
				religion_group = ROOT
			}
		}
	}

	is_valid = {
		ROOT = {
			show_scope_change = no
			custom_tooltip = {
				text = reconquista_valid_TT

				has_character_flag = currently_reconquering_iberia
			}
		}
		custom_tooltip = {
			text = reconquista_valid_2_TT

			FROM = {
				NOT = {
					religion_group = ROOT
				}
			}
		}
	}

	on_add = {
		custom_tooltip = { text = add_allies_reconquista_TT }
		ROOT = {
			character_event = { id = HF.49210 }
		}
	}

	on_success = {

		d_aragon = {
			save_event_target_as = first_duchy_title
		}

		d_barcelona = {
			save_event_target_as = second_duchy_title
		}
		k_aragon = {
			save_event_target_as = reconquista_kingdom_title
		}

		reconquista_win_effect = yes
	}

	on_reverse_demand = {
		reconquista_lose_effect = yes
	}

	on_invalidation = {
		ROOT = {
			character_event = { id = HF.49200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 68 Disabled
reconquista_galicia = {
	name = CB_NAME_RECONQUISTA_GALICIA
	war_name = WAR_NAME_RECONQUISTA_GALICIA
	diplo_view_region = custom_galicia
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	battle_warscore_mult = 0.5
	#max_defender_occupation_score = 85
	allow_whitepeace = no

	allowed_to_target_tributaries = yes
	can_ask_to_join_war = yes

	sort_priority = 10000

	can_use_gui = {
		ROOT = {
			prisoner = no
			is_adult = yes
		}
	}
	can_use = {
		always = no
		ROOT = {
			has_character_flag = currently_reconquering_iberia
			not_reconquista_check_trigger = yes

			any_realm_province = {
				OR = {
					AND = {
						any_neighbor_province = {
							region = custom_galicia
						}
					}
					AND = {
						NOT = {
							any_neighbor_province = {
								region = custom_galicia
							}
						}
						NOT = {
							any_neighbor_province = {
								region = world_europe_west_iberia
								owner = {
									OR = {
										AND = {
											independent = yes
											NOT = {
												religion_group = christian
											}
										}
										top_liege = {
											NOT = {
												religion_group = christian
											}
										}
									}
								}
							}
						}
						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								region = custom_galicia
							}
						}
					}
					AND = {
						NOR = {
							any_neighbor_province = {
								region = custom_galicia
							}
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_galicia
								}
							}
						}
						NOT = {
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = world_europe_west_iberia
									owner = {
										OR = {
											AND = {
												independent = yes
												NOT = {
													religion_group = christian
												}
											}
											top_liege = {
												NOT = {
													religion_group = christian
												}
											}
										}
									}
								}
							}
						}

						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_galicia
								}
							}
						}
					}
				}
			}

			conditional_tooltip = {
				trigger = {
					ai = yes
				}

				NOT = {
					has_character_modifier = reconquista_preparation_duration
				}
			}
		}

		FROM = {
			any_realm_province = {
				region = custom_galicia
			}
			NOT = {
				religion_group = ROOT
			}
		}
	}

	is_valid = {
		ROOT = {
			show_scope_change = no
			custom_tooltip = {
				text = reconquista_valid_TT

				has_character_flag = currently_reconquering_iberia
			}
		}
		custom_tooltip = {
			text = reconquista_valid_2_TT

			FROM = {
				NOT = {
					religion_group = ROOT
				}
			}
		}
	}

	on_add = {
		custom_tooltip = { text = add_allies_reconquista_TT }
		ROOT = {
			character_event = { id = HF.49210 }
		}
	}

	on_success = {

		d_galicia = {
			save_event_target_as = first_duchy_title
		}

		d_porto = {
			save_event_target_as = second_duchy_title
		}
		if = {
			limit = {
				k_spanish_galicia = {
					is_titular = no
				}
			}
			k_spanish_galicia = {
				save_event_target_as = reconquista_kingdom_title
			}
		}

		reconquista_win_effect = yes
	}

	on_reverse_demand = {
		reconquista_lose_effect = yes
	}

	on_invalidation = {
		ROOT = {
			character_event = { id = HF.49200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 69 Disabled
reconquista_beja = {
	name = CB_NAME_RECONQUISTA_BEJA
	war_name = WAR_NAME_RECONQUISTA_BEJA
	diplo_view_region = custom_beja
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	battle_warscore_mult = 0.5
	#max_defender_occupation_score = 85
	allow_whitepeace = no

	allowed_to_target_tributaries = yes
	can_ask_to_join_war = yes

	sort_priority = 10000

	can_use_gui = {
		ROOT = {
			prisoner = no
			is_adult = yes
		}
	}

	can_use = {
		always = no
		ROOT = {
			has_character_flag = currently_reconquering_iberia
			not_reconquista_check_trigger = yes

			any_realm_province = {
				OR = {
					AND = {
						any_neighbor_province = {
							region = custom_beja
						}
					}
					AND = {
						NOT = {
							any_neighbor_province = {
								region = custom_beja
							}
						}
						NOT = {
							any_neighbor_province = {
								region = world_europe_west_iberia
								owner = {
									OR = {
										AND = {
											independent = yes
											NOT = {
												religion_group = christian
											}
										}
										top_liege = {
											NOT = {
												religion_group = christian
											}
										}
									}
								}
							}
						}
						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								region = custom_beja
							}
						}
					}
					AND = {
						NOR = {
							any_neighbor_province = {
								region = custom_beja
							}
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_beja
								}
							}
						}
						NOT = {
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = world_europe_west_iberia
									owner = {
										OR = {
											AND = {
												independent = yes
												NOT = {
													religion_group = christian
												}
											}
											top_liege = {
												NOT = {
													religion_group = christian
												}
											}
										}
									}
								}
							}
						}

						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_beja
								}
							}
						}
					}
				}
			}

			conditional_tooltip = {
				trigger = {
					ai = yes
				}

				NOT = {
					has_character_modifier = reconquista_preparation_duration
				}
			}
		}

		FROM = {
			any_realm_province = {
				region = custom_beja
			}
			NOT = {
				religion_group = ROOT
			}
		}
	}

	is_valid = {
		ROOT = {
			show_scope_change = no
			custom_tooltip = {
				text = reconquista_valid_TT

				has_character_flag = currently_reconquering_iberia
			}
		}
		custom_tooltip = {
			text = reconquista_valid_2_TT

			FROM = {
				NOT = {
					religion_group = ROOT
				}
			}
		}
	}

	on_add = {
		custom_tooltip = { text = add_allies_reconquista_TT }
		ROOT = {
			character_event = { id = HF.49210 }
		}
	}

	on_success = {

		d_beja = {
			save_event_target_as = first_duchy_title
		}

		d_algarve = {
			save_event_target_as = second_duchy_title
		}

		reconquista_win_effect = yes
	}

	on_reverse_demand = {
		reconquista_lose_effect = yes
	}

	on_invalidation = {
		ROOT = {
			character_event = { id = HF.49200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 70 Disabled
reconquista_granada = {
	name = CB_NAME_RECONQUISTA_GRANADA
	war_name = WAR_NAME_RECONQUISTA_GRANADA
	diplo_view_region = custom_granada
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	battle_warscore_mult = 0.5
	#max_defender_occupation_score = 85
	allow_whitepeace = no

	allowed_to_target_tributaries = yes
	can_ask_to_join_war = yes

	sort_priority = 10000

	can_use_gui = {
		ROOT = {
			prisoner = no
			is_adult = yes
		}
	}

	can_use = {
		always = no
		ROOT = {
			has_character_flag = currently_reconquering_iberia
			not_reconquista_check_trigger = yes

			any_realm_province = {
				OR = {
					AND = {
						any_neighbor_province = {
							region = custom_granada
						}
					}
					AND = {
						NOT = {
							any_neighbor_province = {
								region = custom_granada
							}
						}
						NOT = {
							any_neighbor_province = {
								region = world_europe_west_iberia
								owner = {
									OR = {
										AND = {
											independent = yes
											NOT = {
												religion_group = christian
											}
										}
										top_liege = {
											NOT = {
												religion_group = christian
											}
										}
									}
								}
							}
						}
						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								region = custom_granada
							}
						}
					}
					AND = {
						NOR = {
							any_neighbor_province = {
								region = custom_granada
							}
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_granada
								}
							}
						}
						NOT = {
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = world_europe_west_iberia
									owner = {
										OR = {
											AND = {
												independent = yes
												NOT = {
													religion_group = christian
												}
											}
											top_liege = {
												NOT = {
													religion_group = christian
												}
											}
										}
									}
								}
							}
						}

						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_granada
								}
							}
						}
					}
				}
			}

			conditional_tooltip = {
				trigger = {
					ai = yes
				}

				NOT = {
					has_character_modifier = reconquista_preparation_duration
				}
			}
		}

		FROM = {
			any_realm_province = {
				region = custom_granada
			}
			NOT = {
				religion_group = ROOT
			}
		}
	}

	is_valid = {
		ROOT = {
			show_scope_change = no
			custom_tooltip = {
				text = reconquista_valid_TT

				has_character_flag = currently_reconquering_iberia
			}
		}
		custom_tooltip = {
			text = reconquista_valid_2_TT

			FROM = {
				NOT = {
					religion_group = ROOT
				}
			}
		}
	}

	on_add = {
		custom_tooltip = { text = add_allies_reconquista_TT }
		ROOT = {
			character_event = { id = HF.49210 }
		}
	}

	on_success = {

		d_granada = {
			save_event_target_as = first_duchy_title
		}

		d_sevilla = {
			save_event_target_as = second_duchy_title
		}

		reconquista_win_effect = yes
	}

	on_reverse_demand = {
		reconquista_lose_effect = yes
	}

	on_invalidation = {
		ROOT = {
			character_event = { id = HF.49200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 71 Disabled
reconquista_cordoba = {
	name = CB_NAME_RECONQUISTA_CORDOBA
	war_name = WAR_NAME_RECONQUISTA_CORDOBA
	diplo_view_region = custom_cordoba
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	battle_warscore_mult = 0.5
	#max_defender_occupation_score = 85
	allow_whitepeace = no

	allowed_to_target_tributaries = yes
	can_ask_to_join_war = yes

	sort_priority = 10000

	can_use_gui = {
		ROOT = {
			prisoner = no
			is_adult = yes
		}
	}

	can_use = {
		always = no
		ROOT = {
			has_character_flag = currently_reconquering_iberia
			not_reconquista_check_trigger = yes

			any_realm_province = {
				OR = {
					AND = {
						any_neighbor_province = {
							region = custom_cordoba
						}
					}
					AND = {
						NOT = {
							any_neighbor_province = {
								region = custom_cordoba
							}
						}
						NOT = {
							any_neighbor_province = {
								region = world_europe_west_iberia
								owner = {
									OR = {
										AND = {
											independent = yes
											NOT = {
												religion_group = christian
											}
										}
										top_liege = {
											NOT = {
												religion_group = christian
											}
										}
									}
								}
							}
						}
						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								region = custom_cordoba
							}
						}
					}
					AND = {
						NOR = {
							any_neighbor_province = {
								region = custom_cordoba
							}
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_cordoba
								}
							}
						}
						NOT = {
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = world_europe_west_iberia
									owner = {
										OR = {
											AND = {
												independent = yes
												NOT = {
													religion_group = christian
												}
											}
											top_liege = {
												NOT = {
													religion_group = christian
												}
											}
										}
									}
								}
							}
						}

						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_cordoba
								}
							}
						}
					}
				}
			}

			conditional_tooltip = {
				trigger = {
					ai = yes
				}

				NOT = {
					has_character_modifier = reconquista_preparation_duration
				}
			}
		}

		FROM = {
			any_realm_province = {
				region = custom_cordoba
			}
			NOT = {
				religion_group = ROOT
			}
		}
	}

	is_valid = {
		ROOT = {
			show_scope_change = no
			custom_tooltip = {
				text = reconquista_valid_TT

				has_character_flag = currently_reconquering_iberia
			}
		}
		custom_tooltip = {
			text = reconquista_valid_2_TT

			FROM = {
				NOT = {
					religion_group = ROOT
				}
			}
		}
	}

	on_add = {
		custom_tooltip = { text = add_allies_reconquista_TT }
		ROOT = {
			character_event = { id = HF.49210 }
		}
	}

	on_success = {

		d_cordoba = {
			save_event_target_as = first_duchy_title
		}

		d_badajoz = {
			save_event_target_as = second_duchy_title
		}

		reconquista_win_effect = yes
	}

	on_reverse_demand = {
		reconquista_lose_effect = yes
	}

	on_invalidation = {
		ROOT = {
			character_event = { id = HF.49200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 72 Disabled
reconquista_valencia = {
	name = CB_NAME_RECONQUISTA_VALENCIA
	war_name = WAR_NAME_RECONQUISTA_VALENCIA
	diplo_view_region = custom_valencia
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	battle_warscore_mult = 0.5
	#max_defender_occupation_score = 85
	allow_whitepeace = no

	allowed_to_target_tributaries = yes
	can_ask_to_join_war = yes

	sort_priority = 10000

	can_use_gui = {
		ROOT = {
			prisoner = no
			is_adult = yes
		}
	}

	can_use = {
		always = no
		ROOT = {
			has_character_flag = currently_reconquering_iberia
			not_reconquista_check_trigger = yes

			any_realm_province = {
				OR = {
					AND = {
						any_neighbor_province = {
							region = custom_valencia
						}
					}
					AND = {
						NOT = {
							any_neighbor_province = {
								region = custom_valencia
							}
						}
						NOT = {
							any_neighbor_province = {
								region = world_europe_west_iberia
								owner = {
									OR = {
										AND = {
											independent = yes
											NOT = {
												religion_group = christian
											}
										}
										top_liege = {
											NOT = {
												religion_group = christian
											}
										}
									}
								}
							}
						}
						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								region = custom_valencia
							}
						}
					}
					AND = {
						NOR = {
							any_neighbor_province = {
								region = custom_valencia
							}
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_valencia
								}
							}
						}
						NOT = {
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = world_europe_west_iberia
									owner = {
										OR = {
											AND = {
												independent = yes
												NOT = {
													religion_group = christian
												}
											}
											top_liege = {
												NOT = {
													religion_group = christian
												}
											}
										}
									}
								}
							}
						}

						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_valencia
								}
							}
						}
					}
				}
			}

			conditional_tooltip = {
				trigger = {
					ai = yes
				}

				NOT = {
					has_character_modifier = reconquista_preparation_duration
				}
			}
		}

		FROM = {
			any_realm_province = {
				region = custom_valencia
			}
			NOT = {
				religion_group = ROOT
			}
		}
	}

	is_valid = {
		ROOT = {
			show_scope_change = no
			custom_tooltip = {
				text = reconquista_valid_TT

				has_character_flag = currently_reconquering_iberia
			}
		}
		custom_tooltip = {
			text = reconquista_valid_2_TT

			FROM = {
				NOT = {
					religion_group = ROOT
				}
			}
		}
	}

	on_add = {
		custom_tooltip = { text = add_allies_reconquista_TT }
		ROOT = {
			character_event = { id = HF.49210 }
		}
	}

	on_success = {

		d_valencia = {
			save_event_target_as = first_duchy_title
		}

		d_murcia = {
			save_event_target_as = second_duchy_title
		}

		reconquista_win_effect = yes
	}

	on_reverse_demand = {
		reconquista_lose_effect = yes
	}

	on_invalidation = {
		ROOT = {
			character_event = { id = HF.49200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 73 Disabled
reconquista_navarra = {
	name = CB_NAME_RECONQUISTA_NAVARRA
	war_name = WAR_NAME_RECONQUISTA_NAVARRA
	diplo_view_region = custom_navarra
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	battle_warscore_mult = 0.5
	#max_defender_occupation_score = 85
	allow_whitepeace = no

	allowed_to_target_tributaries = yes
	can_ask_to_join_war = yes

	sort_priority = 10000

	can_use_gui = {
		ROOT = {
			prisoner = no
			is_adult = yes
		}
	}

	can_use = {
		always = no
		ROOT = {
			has_character_flag = currently_reconquering_iberia
			not_reconquista_check_trigger = yes

			any_realm_province = {
				OR = {
					AND = {
						any_neighbor_province = {
							region = custom_navarra
						}
					}
					AND = {
						NOT = {
							any_neighbor_province = {
								region = custom_navarra
							}
						}
						NOT = {
							any_neighbor_province = {
								region = world_europe_west_iberia
								owner = {
									OR = {
										AND = {
											independent = yes
											NOT = {
												religion_group = christian
											}
										}
										top_liege = {
											NOT = {
												religion_group = christian
											}
										}
									}
								}
							}
						}
						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								region = custom_navarra
							}
						}
					}
					AND = {
						NOR = {
							any_neighbor_province = {
								region = custom_navarra
							}
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_navarra
								}
							}
						}
						NOT = {
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = world_europe_west_iberia
									owner = {
										OR = {
											AND = {
												independent = yes
												NOT = {
													religion_group = christian
												}
											}
											top_liege = {
												NOT = {
													religion_group = christian
												}
											}
										}
									}
								}
							}
						}

						any_neighbor_province = {
							is_land = yes
							any_neighbor_province = {
								is_land = yes
								any_neighbor_province = {
									region = custom_navarra
								}
							}
						}
					}
				}
			}

			conditional_tooltip = {
				trigger = {
					ai = yes
				}

				NOT = {
					has_character_modifier = reconquista_preparation_duration
				}
			}
		}

		FROM = {
			any_realm_province = {
				region = custom_navarra
			}
			NOT = {
				religion_group = ROOT
			}
		}
	}

	is_valid = {
		ROOT = {
			show_scope_change = no
			custom_tooltip = {
				text = reconquista_valid_TT

				has_character_flag = currently_reconquering_iberia
			}
		}
		custom_tooltip = {
			text = reconquista_valid_2_TT

			FROM = {
				NOT = {
					religion_group = ROOT
				}
			}
		}
	}

	on_add = {
		custom_tooltip = { text = add_allies_reconquista_TT }
		ROOT = {
			character_event = { id = HF.49210 }
		}
	}

	on_success = {

		d_navarra = {
			save_event_target_as = first_duchy_title
		}
		k_navarra = {
			save_event_target_as = reconquista_kingdom_title
		}

		reconquista_win_effect = yes
	}

	on_reverse_demand = {
		reconquista_lose_effect = yes
	}

	on_invalidation = {
		ROOT = {
			character_event = { id = HF.49200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 74 Disabled
reconquista_balearic = {
	name = CB_NAME_RECONQUISTA_BALEARIC
	war_name = WAR_NAME_RECONQUISTA_BALEARIC
	diplo_view_region = custom_balearic
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	battle_warscore_mult = 0.5
	#max_defender_occupation_score = 85
	allow_whitepeace = no

	allowed_to_target_tributaries = yes
	can_ask_to_join_war = yes

	sort_priority = 10000

	can_use_gui = {
		ROOT = {
			prisoner = no
			is_adult = yes
		}
	}

	can_use = {
		always = no
		ROOT = {
			has_character_flag = currently_reconquering_iberia
			not_reconquista_check_trigger = yes

			any_realm_province = {
				OR = {
					AND = {
						any_neighbor_province = {
							region = custom_balearic
						}
					}
					AND = {
						NOT = {
							any_neighbor_province = {
								region = custom_balearic
							}
						}
						NOT = {
							any_neighbor_province = {
								region = world_europe_west_iberia
								owner = {
									OR = {
										AND = {
											independent = yes
											NOT = {
												religion_group = christian
											}
										}
										top_liege = {
											NOT = {
												religion_group = christian
											}
										}
									}
								}
							}
						}
						any_neighbor_province = {
							any_neighbor_province = {
								region = custom_balearic
							}
						}
					}
					AND = {
						NOR = {
							any_neighbor_province = {
								region = custom_balearic
							}
							any_neighbor_province = {
								any_neighbor_province = {
									region = custom_balearic
								}
							}
						}
						NOT = {
							any_neighbor_province = {
								any_neighbor_province = {
									region = world_europe_west_iberia
									owner = {
										OR = {
											AND = {
												independent = yes
												NOT = {
													religion_group = christian
												}
											}
											top_liege = {
												NOT = {
													religion_group = christian
												}
											}
										}
									}
								}
							}
						}

						any_neighbor_province = {
							any_neighbor_province = {
								any_neighbor_province = {
									region = custom_balearic
								}
							}
						}
					}
				}
			}

			conditional_tooltip = {
				trigger = {
					ai = yes
				}

				NOT = {
					has_character_modifier = reconquista_preparation_duration
				}
			}
		}

		FROM = {
			any_realm_province = {
				region = custom_balearic
			}
			NOT = {
				religion_group = ROOT
			}
		}
	}

	is_valid = {
		ROOT = {
			show_scope_change = no
			custom_tooltip = {
				text = reconquista_valid_TT

				has_character_flag = currently_reconquering_iberia
			}
		}
		custom_tooltip = {
			text = reconquista_valid_2_TT

			FROM = {
				NOT = {
					religion_group = ROOT
				}
			}
		}
	}

	on_add = {
		custom_tooltip = { text = add_allies_reconquista_TT }
		ROOT = {
			character_event = { id = HF.49210 }
		}
	}

	on_success = {

		d_mallorca = {
			save_event_target_as = first_duchy_title
		}

		reconquista_win_effect = yes
	}

	on_reverse_demand = {
		reconquista_lose_effect = yes
	}

	on_invalidation = {
		ROOT = {
			character_event = { id = HF.49200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}
